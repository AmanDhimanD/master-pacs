
"undefined"==typeof cornerstone&&(cornerstone={internal:{},rendering:{}}),function(e){"use strict";e.disable=function(t){if(void 0===t)throw"disable: element element must not be undefined";for(var n=e.getEnabledElements(),o=0;o<n.length;o++)if(n[o].element===t){var r={element:t};return $(t).trigger("CornerstoneElementDisabled",r),n[o].element.removeChild(n[o].canvas),void n.splice(o,1)}}}(cornerstone),function(e,t){"use strict";t.displayImage=function(n,o,r){if(void 0===n)throw"displayImage: parameter element cannot be undefined";if(void 0===o)throw"displayImage: parameter image cannot be undefined";var a=t.getEnabledElement(n);if(a.image=o,void 0===a.viewport&&(a.viewport=t.internal.getDefaultViewport(a.canvas,o)),r)for(var i in r)null!==r[i]&&(a.viewport[i]=r[i]);var s,l=new Date;void 0!==a.lastImageTimeStamp&&(s=(1e3/(l.getTime()-a.lastImageTimeStamp)).toFixed()),a.lastImageTimeStamp=l.getTime();var c={viewport:a.viewport,element:a.element,image:a.image,enabledElement:a,frameRate:s};e(a.element).trigger("CornerstoneNewImage",c),t.updateImage(n)}}($,cornerstone),function(e,t){"use strict";t.draw=function(e){var n=t.getEnabledElement(e);if(void 0===n.image)throw"draw: image has not been loaded yet";t.drawImage(n)}}($,cornerstone),function(e,t){"use strict";t.drawInvalidated=function(){for(var e=t.getEnabledElements(),n=0;n<e.length;n++){var o=e[n];!0===o.invalid&&t.drawImage(o)}}}($,cornerstone),function(e){"use strict";e.enable=function(t){if(void 0===t)throw"enable: parameter element cannot be undefined";var n=document.createElement("canvas");t.appendChild(n);var o={element:t,canvas:n,image:void 0,invalid:!1,data:{}};return e.addEnabledElement(o),e.resize(t,!0),t}}(cornerstone),function(e){"use strict";e.getElementData=function(t,n){var o=e.getEnabledElement(t);return!1===o.data.hasOwnProperty(n)&&(o.data[n]={}),o.data[n]},e.removeElementData=function(t,n){delete e.getEnabledElement(t).data[n]}}(cornerstone),function(e){"use strict";var t=[];e.getEnabledElement=function(e){if(void 0===e)throw"getEnabledElement: parameter element must not be undefined";for(var n=0;n<t.length;n++)if(t[n].element==e)return t[n];throw"element not enabled"},e.addEnabledElement=function(e){if(void 0===e)throw"getEnabledElement: enabledElement element must not be undefined";t.push(e)},e.getEnabledElementsByImageId=function(e){var n=[];return t.forEach(function(t){t.image&&t.image.imageId===e&&n.push(t)}),n},e.getEnabledElements=function(){return t}}(cornerstone),function(e){"use strict";e.fitToWindow=function(t){var n=e.getEnabledElement(t),o=e.internal.getDefaultViewport(n.canvas,n.image);n.viewport.scale=o.scale,n.viewport.translation.x=o.translation.x,n.viewport.translation.y=o.translation.y,n.viewport.rotation=o.rotation,n.viewport.hflip=o.hflip,n.viewport.vflip=o.vflip,e.updateImage(t)}}(cornerstone),function(e,t){"use strict";t.getDefaultViewportForImage=function(e,n){var o=t.getEnabledElement(e);return t.internal.getDefaultViewport(o.canvas,n)}}($,cornerstone),function(e,t){"use strict";t.getImage=function(e){return t.getEnabledElement(e).image}}($,cornerstone),function(e){"use strict";e.getPixels=function(t,n,o,r,a){var i=e.getStoredPixels(t,n,o,r,a),s=e.getEnabledElement(t),l=s.image.slope,c=s.image.intercept;return i.map(function(e){return e*l+c})}}(cornerstone),function(e){"use strict";e.getStoredPixels=function(t,n,o,r,a){if(void 0===t)throw"getStoredPixels: parameter element must not be undefined";n=Math.round(n),o=Math.round(o);for(var i=e.getEnabledElement(t),s=[],l=0,c=i.image.getPixelData(),u=0;u<a;u++)for(var d=0;d<r;d++){var h=(u+o)*i.image.columns+(d+n);s[l++]=c[h]}return s}}(cornerstone),function(e){"use strict";e.getViewport=function(t){var n=e.getEnabledElement(t).viewport;if(void 0!==n)return{scale:n.scale,translation:{x:n.translation.x,y:n.translation.y},voi:{windowWidth:n.voi.windowWidth,windowCenter:n.voi.windowCenter},invert:n.invert,pixelReplication:n.pixelReplication,rotation:n.rotation,hflip:n.hflip,vflip:n.vflip}}}(cornerstone),function(e){"use strict";var t={},n=[],o=1073741824,r=0;function a(){if(!(r<=o))for(n.sort(function(e,t){return e.timeStamp>t.timeStamp?-1:e.timeStamp<t.timeStamp?1:0});r>o;){var e=n[n.length-1];r-=e.sizeInBytes,delete t[e.imageId],e.imagePromise.reject(),n.pop()}}e.imageCache={putImagePromise:function(e,o){if(void 0===e)throw"getImagePromise: imageId must not be undefined";if(void 0===o)throw"getImagePromise: imagePromise must not be undefined";if(!0===t.hasOwnProperty(e))throw"putImagePromise: imageId already in cache";var i={loaded:!1,imageId:e,imagePromise:o,timeStamp:new Date,sizeInBytes:0};t[e]=i,n.push(i),o.then(function(e){if(i.loaded=!0,void 0===e.sizeInBytes)throw"putImagePromise: image does not have sizeInBytes property or";if(void 0===e.sizeInBytes.toFixed)throw"putImagePromise: image.sizeInBytes is not a number";i.sizeInBytes=e.sizeInBytes,r+=i.sizeInBytes,a()})},getImagePromise:function(e){if(void 0===e)throw"getImagePromise: imageId must not be undefined";var n=t[e];if(void 0!==n)return n.timeStamp=new Date,n.imagePromise},removeImagePromise:function(e){if(void 0===e)throw"removeImagePromise: imageId must not be undefined";var o=t[e];if(void 0===o)throw"removeImagePromise: imageId must not be undefined";return n.splice(n.indexOf(o),1),r-=o.sizeInBytes,delete t[e],o.imagePromise},setMaximumSizeBytes:function(e){if(void 0===e)throw"setMaximumSizeBytes: parameter numBytes must not be undefined";if(void 0===e.toFixed)throw"setMaximumSizeBytes: parameter numBytes must be a number";o=e,a()},getCacheInfo:function(){return{maximumSizeInBytes:o,cacheSizeInBytes:r,numberOfImagesCached:n.length}},purgeCache:function(){for(;n.length>0;){var e=n.pop();delete t[e.imageId],e.imagePromise.reject()}r=0}}}(cornerstone),function(e,t){"use strict";var n,o={};function r(r){var a,i=r.indexOf(":"),s=r.substring(0,i),l=o[s];return null==l?void 0!==n?a=n(r):void 0:((a=l(r)).then(function(n){e(t).trigger("CornerstoneImageLoaded",{image:n})}),a)}t.loadImage=function(e){if(void 0===e)throw"loadImage: parameter imageId must not be undefined";var n=t.imageCache.getImagePromise(e);if(void 0!==n)return n;if(void 0===(n=r(e)))throw"loadImage: no image loader for imageId";return n},t.loadAndCacheImage=function(e){if(void 0===e)throw"loadAndCacheImage: parameter imageId must not be undefined";var n=t.imageCache.getImagePromise(e);if(void 0!==n)return n;if(void 0===(n=r(e)))throw"loadAndCacheImage: no image loader for imageId";return t.imageCache.putImagePromise(e,n),n},t.registerImageLoader=function(e,t){o[e]=t},t.registerUnknownImageLoader=function(e){var t=n;return n=e,t}}($,cornerstone),function(e){"use strict";e.internal.calculateTransform=function(t,n){var o=new e.internal.Transform;o.translate(t.canvas.width/2,t.canvas.height/2);var r=t.viewport.rotation;0!==r&&o.rotate(r*Math.PI/180);var a=t.viewport.scale,i=t.viewport.scale;return t.image.rowPixelSpacing<t.image.columnPixelSpacing?a*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(i*=t.image.rowPixelSpacing/t.image.columnPixelSpacing),o.scale(a,i),0!==r&&o.rotate(-r*Math.PI/180),o.translate(t.viewport.translation.x,t.viewport.translation.y),0!==r&&o.rotate(r*Math.PI/180),void 0!==n&&o.scale(n,n),t.viewport.hflip&&o.scale(-1,1),t.viewport.vflip&&o.scale(1,-1),o.translate(-t.image.width/2,-t.image.height/2),o}}(cornerstone),function(e,t){"use strict";function n(t,n){var o=new Date;t.image.render(t,n);var r=t.canvas.getContext("2d"),a=new Date-o,i={viewport:t.viewport,element:t.element,image:t.image,enabledElement:t,canvasContext:r,renderTimeInMs:a};e(t.element).trigger("CornerstoneImageRendered",i),t.invalid=!1}t.internal.drawImage=n,t.drawImage=n}($,cornerstone),function(e){"use strict";function t(e,t,n,o){void 0===e.lut&&(e.lut=new Int16Array(e.maxPixelValue-Math.min(e.minPixelValue,0)+1));var r,a,i,s=e.lut,l=e.maxPixelValue,c=e.minPixelValue,u=e.slope,d=e.intercept,h=t,f=n,m=0;if(c<0&&(m=c),!0===o)for(i=e.minPixelValue;i<=l;i++)r=255*((i*u+d-f)/h+.5),a=Math.min(Math.max(r,0),255),s[i+-m]=Math.round(255-a);else for(i=e.minPixelValue;i<=l;i++)r=255*((i*u+d-f)/h+.5),a=Math.min(Math.max(r,0),255),s[i+-m]=Math.round(a)}e.internal.generateLut=t,e.generateLut=t}(cornerstone),function(e){"use strict";function t(e,t){if(void 0===e)throw"getDefaultViewport: parameter canvas must not be undefined";if(void 0===t)throw"getDefaultViewport: parameter image must not be undefined";var n={scale:1,translation:{x:0,y:0},voi:{windowWidth:t.windowWidth,windowCenter:t.windowCenter},invert:t.invert,pixelReplication:!1,rotation:0,hflip:!1,vflip:!1},o=e.height/t.rows,r=e.width/t.columns;return n.scale=r<o?r:o,n}e.internal.getDefaultViewport=t,e.getDefaultViewport=t}(cornerstone),function(e){"use strict";e.internal.getTransform=function(t){return e.internal.calculateTransform(t)}}(cornerstone),function(e,t){"use strict";t.drawImage=t.internal.drawImage,t.generateLut=t.internal.generateLut,t.storedPixelDataToCanvasImageData=t.internal.storedPixelDataToCanvasImageData,t.storedColorPixelDataToCanvasImageData=t.internal.storedColorPixelDataToCanvasImageData}($,cornerstone),function(e){"use strict";function t(e,t,n){var o=e.minPixelValue,r=0,a=0,i=e.width*e.height*4,s=e.getPixelData(),l=t,c=n;if(o<0)for(;a<i;)c[r++]=l[s[a++]+-o],c[r++]=l[s[a++]+-o],c[r]=l[s[a]+-o],a+=2,r+=2;else for(;a<i;)c[r++]=l[s[a++]],c[r++]=l[s[a++]],c[r]=l[s[a]],a+=2,r+=2}e.internal.storedColorPixelDataToCanvasImageData=t,e.storedColorPixelDataToCanvasImageData=t}(cornerstone),function(e){"use strict";function t(e,t,n){var o=e.getPixelData(),r=e.minPixelValue,a=3,i=0,s=o.length,l=o,c=t,u=n;if(r<0)for(;i<s;)u[a]=c[l[i++]+-r],a+=4;else for(;i<s;)u[a]=c[l[i++]],a+=4}e.internal.storedPixelDataToCanvasImageData=t,e.storedPixelDataToCanvasImageData=t}(cornerstone),function(e){"use strict";function t(){this.reset()}t.prototype.reset=function(){this.m=[1,0,0,1,0,0]},t.prototype.clone=function(){var e=new t;return e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5],e},t.prototype.multiply=function(e){var t=this.m[0]*e.m[0]+this.m[2]*e.m[1],n=this.m[1]*e.m[0]+this.m[3]*e.m[1],o=this.m[0]*e.m[2]+this.m[2]*e.m[3],r=this.m[1]*e.m[2]+this.m[3]*e.m[3],a=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],i=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=r,this.m[4]=a,this.m[5]=i},t.prototype.invert=function(){var e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,n=-this.m[1]*e,o=-this.m[2]*e,r=this.m[0]*e,a=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),i=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=t,this.m[1]=n,this.m[2]=o,this.m[3]=r,this.m[4]=a,this.m[5]=i},t.prototype.rotate=function(e){var t=Math.cos(e),n=Math.sin(e),o=this.m[0]*t+this.m[2]*n,r=this.m[1]*t+this.m[3]*n,a=this.m[0]*-n+this.m[2]*t,i=this.m[1]*-n+this.m[3]*t;this.m[0]=o,this.m[1]=r,this.m[2]=a,this.m[3]=i},t.prototype.translate=function(e,t){this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t},t.prototype.scale=function(e,t){this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t},t.prototype.transformPoint=function(e,t){var n=e,o=t;return{x:e=n*this.m[0]+o*this.m[2]+this.m[4],y:t=n*this.m[1]+o*this.m[3]+this.m[5]}},e.internal.Transform=t}(cornerstone),function(e){"use strict";e.invalidate=function(t){var n=e.getEnabledElement(t);n.invalid=!0;var o={element:t};$(n.element).trigger("CornerstoneInvalidated",o)}}(cornerstone),function(e){"use strict";e.invalidateImageId=function(t){e.getEnabledElementsByImageId(t).forEach(function(t){e.drawImage(t,!0)})}}(cornerstone),function(e){"use strict";e.pageToPixel=function(t,n,o){var r=e.getEnabledElement(t);if(void 0===r.image)throw"image has not been loaded yet";r.image;var a=t.getBoundingClientRect(),i={x:n-a.left-window.pageXOffset,y:o-a.top-window.pageYOffset},s=e.internal.getTransform(r);return s.invert(),s.transformPoint(i.x,i.y)}}(cornerstone),function(e){"use strict";e.pixelToCanvas=function(t,n){var o=e.getEnabledElement(t);return e.internal.getTransform(o).transformPoint(n.x,n.y)}}(cornerstone),function(e){"use strict";var t,n,o,r=document.createElement("canvas"),a={};function i(i,s,l){if(i.viewport.voi.windowWidth===i.image.windowWidth&&i.viewport.voi.windowCenter===i.image.windowCenter&&!1===i.viewport.invert)return s.getCanvas();if(!1===function(e,t){return t.imageId!==o||a.windowCenter!==e.viewport.voi.windowCenter||a.windowWidth!==e.viewport.voi.windowWidth||a.invert!==e.viewport.invert||a.rotation!==e.viewport.rotation||a.hflip!==e.viewport.hflip||a.vflip!==e.viewport.vflip}(i,s)&&!0!==l)return r;r.width===s.width&&r.height==s.height||function(e){r.width=e.width,r.height=e.height,(t=r.getContext("2d")).fillStyle="white",t.fillRect(0,0,r.width,r.height),n=t.getImageData(0,0,e.width,e.height)}(s);var c=function(t,n){return void 0!==t.lut&&t.lut.windowCenter===n.voi.windowCenter&&t.lut.windowWidth===n.voi.windowWidth&&t.lut.invert===n.invert?t.lut:(e.generateLut(t,n.voi.windowWidth,n.voi.windowCenter,n.invert),t.lut.windowWidth=n.voi.windowWidth,t.lut.windowCenter=n.voi.windowCenter,t.lut.invert=n.invert,t.lut)}(s,i.viewport);return e.storedColorPixelDataToCanvasImageData(s,c,n.data),t.putImageData(n,0,0),r}function s(t,n){if(void 0===t)throw"drawImage: enabledElement parameter must not be undefined";var r=t.image;if(void 0===r)throw"drawImage: image must be loaded before it can be drawn";var s=t.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0),s.fillStyle="black",s.fillRect(0,0,t.canvas.width,t.canvas.height),!0===t.viewport.pixelReplication?(s.imageSmoothingEnabled=!1,s.mozImageSmoothingEnabled=!1):(s.imageSmoothingEnabled=!0,s.mozImageSmoothingEnabled=!0),s.save(),e.setToPixelCoordinateSystem(t,s);var l=i(t,r,n);s.drawImage(l,0,0,r.width,r.height,0,0,r.width,r.height),s.restore(),o=r.imageId,a.windowCenter=t.viewport.voi.windowCenter,a.windowWidth=t.viewport.voi.windowWidth,a.invert=t.viewport.invert,a.rotation=t.viewport.rotation,a.hflip=t.viewport.hflip,a.vflip=t.viewport.vflip}e.rendering.colorImage=s,e.renderColorImage=s}(cornerstone),function(e){"use strict";var t,n,o,r=document.createElement("canvas"),a={};function i(i,s,l){if(!1===function(e,t){return t.imageId!==o||a.windowCenter!==e.viewport.voi.windowCenter||a.windowWidth!==e.viewport.voi.windowWidth||a.invert!==e.viewport.invert||a.rotation!==e.viewport.rotation||a.hflip!==e.viewport.hflip||a.vflip!==e.viewport.vflip}(i,s)&&!0!==l)return r;r.width===s.width&&r.height==s.height||function(e){r.width=e.width,r.height=e.height,(t=r.getContext("2d")).fillStyle="white",t.fillRect(0,0,r.width,r.height),n=t.getImageData(0,0,e.width,e.height)}(s);var c=function(t,n,o){return void 0!==t.lut&&t.lut.windowCenter===n.voi.windowCenter&&t.lut.windowWidth===n.voi.windowWidth&&t.lut.invert===n.invert&&!0!==o?t.lut:(e.generateLut(t,n.voi.windowWidth,n.voi.windowCenter,n.invert),t.lut.windowWidth=n.voi.windowWidth,t.lut.windowCenter=n.voi.windowCenter,t.lut.invert=n.invert,t.lut)}(s,i.viewport,l);return e.storedPixelDataToCanvasImageData(s,c,n.data),t.putImageData(n,0,0),r}function s(t,n){if(void 0===t)throw"drawImage: enabledElement parameter must not be undefined";var r=t.image;if(void 0===r)throw"drawImage: image must be loaded before it can be drawn";var s=t.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0),s.fillStyle="black",s.fillRect(0,0,t.canvas.width,t.canvas.height),!0===t.viewport.pixelReplication?(s.imageSmoothingEnabled=!1,s.mozImageSmoothingEnabled=!1):(s.imageSmoothingEnabled=!0,s.mozImageSmoothingEnabled=!0),e.setToPixelCoordinateSystem(t,s);var l=i(t,r,n);s.drawImage(l,0,0,r.width,r.height,0,0,r.width,r.height),o=r.imageId,a.windowCenter=t.viewport.voi.windowCenter,a.windowWidth=t.viewport.voi.windowWidth,a.invert=t.viewport.invert,a.rotation=t.viewport.rotation,a.hflip=t.viewport.hflip,a.vflip=t.viewport.vflip}e.rendering.grayscaleImage=s,e.renderGrayscaleImage=s}(cornerstone),function(e){"use strict";function t(t,n){if(void 0===t)throw"drawImage: enabledElement parameter must not be undefined";var o=t.image;if(void 0===o)throw"drawImage: image must be loaded before it can be drawn";var r=t.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.fillStyle="black",r.fillRect(0,0,t.canvas.width,t.canvas.height),!0===t.viewport.pixelReplication?(r.imageSmoothingEnabled=!1,r.mozImageSmoothingEnabled=!1):(r.imageSmoothingEnabled=!0,r.mozImageSmoothingEnabled=!0),e.setToPixelCoordinateSystem(t,r),t.viewport.voi.windowWidth===t.image.windowWidth&&t.viewport.voi.windowCenter===t.image.windowCenter&&!1===t.viewport.invert?r.drawImage(o.getImage(),0,0,o.width,o.height,0,0,o.width,o.height):e.renderColorImage(t,n)}e.rendering.webImage=t,e.renderWebImage=t}(cornerstone),function(e){"use strict";e.resize=function(t,n){var o=e.getEnabledElement(t);!function(e,t){t.width=e.clientWidth,t.height=e.clientHeight,t.style.width=e.clientWidth+"px",t.style.height=e.clientHeight+"px"}(t,o.canvas),void 0!==o.image&&(!0===n?e.fitToWindow(t):e.updateImage(t))}}(cornerstone),function(e){"use strict";e.setToPixelCoordinateSystem=function(t,n,o){if(void 0===t)throw"setToPixelCoordinateSystem: parameter enabledElement must not be undefined";if(void 0===n)throw"setToPixelCoordinateSystem: parameter context must not be undefined";var r=e.internal.calculateTransform(t,o);n.setTransform(r.m[0],r.m[1],r.m[2],r.m[3],r.m[4],r.m[5],r.m[6])}}(cornerstone),function(e){"use strict";e.setViewport=function(t,n){var o=e.getEnabledElement(t);o.viewport.scale=n.scale,o.viewport.translation.x=n.translation.x,o.viewport.translation.y=n.translation.y,o.viewport.voi.windowWidth=n.voi.windowWidth,o.viewport.voi.windowCenter=n.voi.windowCenter,o.viewport.invert=n.invert,o.viewport.pixelReplication=n.pixelReplication,o.viewport.rotation=n.rotation,o.viewport.hflip=n.hflip,o.viewport.vflip=n.vflip,o.viewport.voi.windowWidth<1&&(o.viewport.voi.windowWidth=1),o.viewport.scale<1e-4&&(o.viewport.scale=.25),360!==o.viewport.rotation&&-360!==o.viewport.rotation||(o.viewport.rotation=0),e.updateImage(t)}}(cornerstone),function(e){"use strict";e.updateImage=function(t,n){var o=e.getEnabledElement(t);if(void 0===o.image)throw"updateImage: image has not been loaded yet";e.drawImage(o,n)}}(cornerstone);
/*! cornerstoneMath - v0.1.2 - 2015-08-31 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneMath */
var cornerstoneMath=function(e){"use strict";return void 0===e&&(e={}),e.rect={distanceToPoint:function(t,n){var o=655535;return function(e){return[{start:{x:e.left,y:e.top},end:{x:e.left+e.width,y:e.top}},{start:{x:e.left+e.width,y:e.top},end:{x:e.left+e.width,y:e.top+e.height}},{start:{x:e.left+e.width,y:e.top+e.height},end:{x:e.left,y:e.top+e.height}},{start:{x:e.left,y:e.top+e.height},end:{x:e.left,y:e.top}}]}(t).forEach(function(t){var r=e.lineSegment.distanceToPoint(t,n);r<o&&(o=r)}),o}},e}(cornerstoneMath=function(e){"use strict";return void 0===e&&(e={}),e.Quaternion=function(e,t,n,o){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==o?o:1},e.Quaternion.prototype.setFromAxisAngle=function(e,t){var n=t/2,o=Math.sin(n);return this.x=e.x*o,this.y=e.y*o,this.z=e.z*o,this.w=Math.cos(n),this},e.Quaternion.prototype.multiplyQuaternions=function(e,t){var n=e.x,o=e.y,r=e.z,a=e.w,i=t.x,s=t.y,l=t.z,c=t.w;return this.x=n*c+a*i+o*l-r*s,this.y=o*c+a*s+r*i-n*l,this.z=r*c+a*l+n*s-o*i,this.w=a*c-n*i-o*s-r*l,this},e.Quaternion.prototype.setFromRotationMatrix=function(e){var t,n=e.elements,o=n[0],r=n[4],a=n[8],i=n[1],s=n[5],l=n[9],c=n[2],u=n[6],d=n[10],h=o+s+d;return h>0?(t=.5/Math.sqrt(h+1),this.w=.25/t,this.x=(u-l)*t,this.y=(a-c)*t,this.z=(i-r)*t):o>s&&o>d?(t=2*Math.sqrt(1+o-s-d),this.w=(u-l)/t,this.x=.25*t,this.y=(r+i)/t,this.z=(a+c)/t):s>d?(t=2*Math.sqrt(1+s-o-d),this.w=(a-c)/t,this.x=(r+i)/t,this.y=.25*t,this.z=(l+u)/t):(t=2*Math.sqrt(1+d-o-s),this.w=(i-r)/t,this.x=(a+c)/t,this.y=(l+u)/t,this.z=.25*t),this},e}(cornerstoneMath=function(e){"use strict";function t(e,t){return{x:e.x-t.x,y:e.y-t.y}}function n(e,n){var o=t(e,n);return o.x*o.x+o.y*o.y}return void 0===e&&(e={}),e.point={subtract:t,copy:function(e){return{x:e.x,y:e.y}},pageToPoint:function(e){return{x:e.pageX,y:e.pageY}},distance:function(e,t){return Math.sqrt(n(e,t))},distanceSquared:n,insideRect:function(e,t){return!(e.x<t.left||e.x>t.left+t.width||e.y<t.top||e.y>t.top+t.height)}},e}(cornerstoneMath=function(e){"use strict";var t,n;return void 0===e&&(e={}),e.Plane=function(t,n){this.normal=void 0!==t?t:new e.Vector3(1,0,0),this.constant=void 0!==n?n:0},e.Plane.prototype={constructor:e.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,o){return this.normal.set(e,t,n),this.constant=o,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:(t=new e.Vector3,n=new e.Vector3,function(e,o,r){var a=t.subVectors(r,o).cross(n.subVectors(e,o)).normalize();return this.setFromNormalAndCoplanarPoint(a,e),this}),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(t,n){var o=this.distanceToPoint(t);return(n||new e.Vector3).copy(this.normal).multiplyScalar(o)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectLine:function(){var t=new e.Vector3;return function(n,o){var r=o||new e.Vector3,a=n.delta(t),i=this.normal.dot(a);if(0===i)return 0===this.distanceToPoint(n.start)?r.copy(n.start):void 0;var s=-(n.start.dot(this.normal)+this.constant)/i;return s<0||s>1?void 0:r.copy(a).multiplyScalar(s).add(n.start)}}(),intersectPlane:function(t){var n=this.normal.clone().cross(t.normal),o={origin:new e.Vector3,direction:n};if(this.normal.clone().cross(t.normal).length<1e-10)return o.direction=new e.Vector3,o;var r=this.constant,a=t.constant,i=this.normal.clone().dot(t.normal),s=-(r-a*i)/(1-i*i),l=-(a-r*i)/(1-i*i);return o.origin=this.normal.clone().multiplyScalar(s).add(t.normal.clone().multiplyScalar(l)),o},coplanarPoint:function(t){return(t||new e.Vector3).copy(this.normal).multiplyScalar(-this.constant)},translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new e.Plane).copy(this)}},e}(cornerstoneMath=function(e){"use strict";return void 0===e&&(e={}),e.Matrix4=function(e,t,n,o,r,a,i,s,l,c,u,d,h,f,m,g){this.elements=new Float32Array(16);var p=this.elements;p[0]=void 0!==e?e:1,p[4]=t||0,p[8]=n||0,p[12]=o||0,p[1]=r||0,p[5]=void 0!==a?a:1,p[9]=i||0,p[13]=s||0,p[2]=l||0,p[6]=c||0,p[10]=void 0!==u?u:1,p[14]=d||0,p[3]=h||0,p[7]=f||0,p[11]=m||0,p[15]=void 0!==g?g:1},e.Matrix4.prototype.makeRotationFromQuaternion=function(e){var t=this.elements,n=e.x,o=e.y,r=e.z,a=e.w,i=n+n,s=o+o,l=r+r,c=n*i,u=n*s,d=n*l,h=o*s,f=o*l,m=r*l,g=a*i,p=a*s,v=a*l;return t[0]=1-(h+m),t[4]=u-v,t[8]=d+p,t[1]=u+v,t[5]=1-(c+m),t[9]=f-g,t[2]=d-p,t[6]=f+g,t[10]=1-(c+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},e.Matrix4.prototype.multiplyMatrices=function(e,t){var n=e.elements,o=t.elements,r=this.elements,a=n[0],i=n[4],s=n[8],l=n[12],c=n[1],u=n[5],d=n[9],h=n[13],f=n[2],m=n[6],g=n[10],p=n[14],v=n[3],y=n[7],w=n[11],T=n[15],x=o[0],b=o[4],C=o[8],P=o[12],S=o[1],M=o[5],I=o[9],D=o[13],k=o[2],E=o[6],A=o[10],R=o[14],O=o[3],L=o[7],B=o[11],U=o[15];return r[0]=a*x+i*S+s*k+l*O,r[4]=a*b+i*M+s*E+l*L,r[8]=a*C+i*I+s*A+l*B,r[12]=a*P+i*D+s*R+l*U,r[1]=c*x+u*S+d*k+h*O,r[5]=c*b+u*M+d*E+h*L,r[9]=c*C+u*I+d*A+h*B,r[13]=c*P+u*D+d*R+h*U,r[2]=f*x+m*S+g*k+p*O,r[6]=f*b+m*M+g*E+p*L,r[10]=f*C+m*I+g*A+p*B,r[14]=f*P+m*D+g*R+p*U,r[3]=v*x+y*S+w*k+T*O,r[7]=v*b+y*M+w*E+T*L,r[11]=v*C+y*I+w*A+T*B,r[15]=v*P+y*D+w*R+T*U,this},e.Matrix4.prototype.multiply=function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},e.Matrix4.prototype.getInverse=function(e,t){var n=this.elements,o=e.elements,r=o[0],a=o[4],i=o[8],s=o[12],l=o[1],c=o[5],u=o[9],d=o[13],h=o[2],f=o[6],m=o[10],g=o[14],p=o[3],v=o[7],y=o[11],w=o[15];n[0]=u*g*v-d*m*v+d*f*y-c*g*y-u*f*w+c*m*w,n[4]=s*m*v-i*g*v-s*f*y+a*g*y+i*f*w-a*m*w,n[8]=i*d*v-s*u*v+s*c*y-a*d*y-i*c*w+a*u*w,n[12]=s*u*f-i*d*f-s*c*m+a*d*m+i*c*g-a*u*g,n[1]=d*m*p-u*g*p-d*h*y+l*g*y+u*h*w-l*m*w,n[5]=i*g*p-s*m*p+s*h*y-r*g*y-i*h*w+r*m*w,n[9]=s*u*p-i*d*p-s*l*y+r*d*y+i*l*w-r*u*w,n[13]=i*d*h-s*u*h+s*l*m-r*d*m-i*l*g+r*u*g,n[2]=c*g*p-d*f*p+d*h*v-l*g*v-c*h*w+l*f*w,n[6]=s*f*p-a*g*p-s*h*v+r*g*v+a*h*w-r*f*w,n[10]=a*d*p-s*c*p+s*l*v-r*d*v-a*l*w+r*c*w,n[14]=s*c*h-a*d*h-s*l*f+r*d*f+a*l*g-r*c*g,n[3]=u*f*p-c*m*p-u*h*v+l*m*v+c*h*y-l*f*y,n[7]=a*m*p-i*f*p+i*h*v-r*m*v-a*h*y+r*f*y,n[11]=i*c*p-a*u*p-i*l*v+r*u*v+a*l*y-r*c*y,n[15]=a*u*h-i*c*h+i*l*f-r*u*f-a*l*m+r*c*m;var T=r*n[0]+l*n[4]+h*n[8]+p*n[12];if(0===T){var x="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(x);return console.warn(x),this.identity(),this}return this.multiplyScalar(1/T),this},e.Matrix4.prototype.applyToVector3Array=function(){var t=new e.Vector3;return function(e,n,o){void 0===n&&(n=0),void 0===o&&(o=e.length);for(var r=0,a=n;r<o;r+=3,a+=3)t.x=e[a],t.y=e[a+1],t.z=e[a+2],t.applyMatrix4(this),e[a]=t.x,e[a+1]=t.y,e[a+2]=t.z;return e}},e.Matrix4.prototype.makeTranslation=function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},e.Matrix4.prototype.multiplyScalar=function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},e.Matrix4.prototype.set=function(e,t,n,o,r,a,i,s,l,c,u,d,h,f,m,g){var p=this.elements;return p[0]=e,p[4]=t,p[8]=n,p[12]=o,p[1]=r,p[5]=a,p[9]=i,p[13]=s,p[2]=l,p[6]=c,p[10]=u,p[14]=d,p[3]=h,p[7]=f,p[11]=m,p[15]=g,this},e.Matrix4.prototype.makeScale=function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},e}(cornerstoneMath=function(e){"use strict";return void 0===e&&(e={}),e.clamp=function(e,t,n){return e<t?t:e>n?n:e},e.degToRad=function(e){return e*(Math.PI/180)},e.radToDeg=function(e){return e*(180/Math.PI)},e}(cornerstoneMath=function(e){"use strict";function t(e){return e*e}function n(e,n){return t(e.x-n.x)+t(e.y-n.y)}return void 0===e&&(e={}),e.lineSegment={distanceToPoint:function(e,t){return Math.sqrt(function(e,t){var o=n(e.start,e.end);if(0===o)return n(t,e.start);var r=((t.x-e.start.x)*(e.end.x-e.start.x)+(t.y-e.start.y)*(e.end.y-e.start.y))/o;return n(t,r<0?e.start:r>1?e.end:{x:e.start.x+r*(e.end.x-e.start.x),y:e.start.y+r*(e.end.y-e.start.y)})}(e,t))}},e}(cornerstoneMath=function(e){"use strict";var t,n;return void 0===e&&(e={}),e.Line3=function(t,n){this.start=void 0!==t?t:new e.Vector3,this.end=void 0!==n?n:new e.Vector3},e.Line3.prototype={constructor:e.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(t){return(t||new e.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new e.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,n){var o=n||new e.Vector3;return this.delta(o).multiplyScalar(t).add(this.start)},closestPointToPointParameter:(t=new e.Vector3,n=new e.Vector3,function(o,r){t.subVectors(o,this.start),n.subVectors(this.end,this.start);var a=n.dot(n),i=n.dot(t)/a;return r&&(i=e.Math.clamp(i,0,1)),i}),closestPointToPoint:function(t,n,o){var r=this.closestPointToPointParameter(t,n),a=o||new e.Vector3;return this.delta(a).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new e.Line3).copy(this)},intersectLine:function(e){var t=this.end.clone().sub(this.start),n=e.end.clone().sub(e.start),o=e.start.clone().sub(this.start),r=t.clone().cross(n),a=o.clone().cross(n);if(0!==o.dot(t)){var i=a.dot(r)/r.lengthSq();if(!(i>1||isNaN(i))){var s=this.start.clone().add(t.clone().multiplyScalar(i));return s.clone().sub(e.start).lengthSq()+s.clone().sub(e.end).lengthSq()<=e.distanceSq()?s:void 0}}}},e}(cornerstoneMath=function(e){"use strict";var t,n,o,r,a;return void 0===e&&(e={}),e.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},e.Vector3.prototype={constructor:e.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyAxisAngle:function(t,n){return void 0===a&&(a=new e.Quaternion),this.applyQuaternion(a.setFromAxisAngle(t,n)),this},applyMatrix3:function(e){var t=this.x,n=this.y,o=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*o,this.y=r[1]*t+r[4]*n+r[7]*o,this.z=r[2]*t+r[5]*n+r[8]*o,this},applyMatrix4:function(e){var t=this.x,n=this.y,o=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*o+r[12],this.y=r[1]*t+r[5]*n+r[9]*o+r[13],this.z=r[2]*t+r[6]*n+r[10]*o+r[14],this},applyProjection:function(e){var t=this.x,n=this.y,o=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*o+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*o+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*o+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*o+r[14])*a,this},applyQuaternion:function(e){var t=this.x,n=this.y,o=this.z,r=e.x,a=e.y,i=e.z,s=e.w,l=s*t+a*o-i*n,c=s*n+i*t-r*o,u=s*o+r*n-a*t,d=-r*t-a*n-i*o;return this.x=l*s+d*-r+c*-i-u*-a,this.y=c*s+d*-a+u*-r-l*-i,this.z=u*s+d*-i+l*-a-c*-r,this},transformDirection:function(e){var t=this.x,n=this.y,o=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*o,this.y=r[1]*t+r[5]*n+r[9]*o,this.z=r[2]*t+r[6]*n+r[10]*o,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(t,n){return void 0===o&&(o=new e.Vector3,r=new e.Vector3),o.set(t,t,t),r.set(n,n,n),this.clamp(o,r)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,o=this.y,r=this.z;return this.x=o*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-o*e.x,this},crossVectors:function(e,t){var n=e.x,o=e.y,r=e.z,a=t.x,i=t.y,s=t.z;return this.x=o*s-r*i,this.y=r*a-n*s,this.z=n*i-o*a,this},projectOnVector:function(o){return void 0===t&&(t=new e.Vector3),t.copy(o).normalize(),n=this.dot(t),this.copy(t).multiplyScalar(n)},projectOnPlane:function(){var t;return function(n){return void 0===t&&(t=new e.Vector3),t.copy(this).projectOnVector(n),this.sub(t)}}(),reflect:function(){var t;return function(n){return void 0===t&&(t=new e.Vector3),this.sub(t.copy(n).multiplyScalar(2*this.dot(n)))}}(),angleTo:function(t){var n=this.dot(t)/(this.length()*t.length());return Math.acos(e.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,o=this.z-e.z;return t*t+n*n+o*o},setEulerFromRotationMatrix:function(e,t){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(e,t){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),o=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=o,this},setFromMatrixColumn:function(e,t){var n=4*e,o=t.elements;return this.x=o[n],this.y=o[n+1],this.z=o[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new e.Vector3(this.x,this.y,this.z)}},e}(cornerstoneMath)))))))));
/*! cornerstoneTools - v0.7.2 - 2015-09-07 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneTools */
"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneTools&&(cornerstoneTools={referenceLines:{},orientation:{}}),function(e,t,n){"use strict";function o(n){if(!("mousewheel"===n.originalEvent.type&&0===n.originalEvent.wheelDeltaY||"DOMMouseScroll"===n.originalEvent.type&&1===n.originalEvent.axis)){var o=n.currentTarget,r=t.pageToPixel(o,n.pageX||n.originalEvent.pageX,n.pageY||n.originalEvent.pageY),a=(n=window.event||n).wheelDelta||-n.detail||-n.originalEvent.detail,i=Math.max(-1,Math.min(1,a)),s={element:o,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,direction:i,pageX:n.pageX||n.originalEvent.pageX,pageY:n.pageY||n.originalEvent.pageY,imageX:r.x,imageY:r.y};e(o).trigger("CornerstoneToolsMouseWheel",s)}}var r="mousewheel DOMMouseScroll";n.mouseWheelInput={enable:function(t){e(t).on(r,o)},disable:function(t){e(t).unbind(r,o)}}}($,cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";var r,a,i=200;function s(){r=!1}function l(r){var a=r.currentTarget,i={page:n.point.pageToPoint(r),image:t.pageToPixel(a,r.pageX,r.pageY),client:{x:r.clientX,y:r.clientY}};i.canvas=t.pixelToCanvas(a,i.image);var s=o.copyPoints(i),l={event:r,which:r.which,viewport:t.getViewport(a),image:t.getEnabledElement(a).image,element:a,startPoints:i,lastPoints:s,currentPoints:i,deltaPoints:{x:0,y:0}},c=e.Event("CornerstoneToolsMouseDoubleClick",l);e(l.element).trigger(c,l)}function c(l){a=setTimeout(s,i);var c=l.currentTarget;e(c).off("mousemove",u);var d={page:n.point.pageToPoint(l),image:t.pageToPixel(c,l.pageX,l.pageY),client:{x:l.clientX,y:l.clientY}};d.canvas=t.pixelToCanvas(c,d.image);var h=o.copyPoints(d),f={event:l,which:l.which,viewport:t.getViewport(c),image:t.getEnabledElement(c).image,element:c,startPoints:d,lastPoints:h,currentPoints:d,deltaPoints:{x:0,y:0}},m=e.Event("CornerstoneToolsMouseDown",f);if(e(f.element).trigger(m,f),!1===m.isImmediatePropagationStopped()&&!0===function(t){e(t.element).trigger("CornerstoneToolsMouseDownActivate",t)}(f))return o.pauseEvent(l);var g=l.which;function p(r){var a={page:n.point.pageToPoint(r),image:t.pageToPixel(c,r.pageX,r.pageY),client:{x:r.clientX,y:r.clientY}};a.canvas=t.pixelToCanvas(c,a.image);var i={page:n.point.subtract(a.page,h.page),image:n.point.subtract(a.image,h.image),client:n.point.subtract(a.client,h.client),canvas:n.point.subtract(a.canvas,h.canvas)},s={which:g,viewport:t.getViewport(c),image:t.getEnabledElement(c).image,element:c,startPoints:d,lastPoints:h,currentPoints:a,deltaPoints:i};return e(f.element).trigger("CornerstoneToolsMouseDrag",s),h=o.copyPoints(a),o.pauseEvent(r)}return e(document).on("mousemove",p),e(document).on("mouseup",function o(i){clearTimeout(a);var s="CornerstoneToolsMouseUp";r&&(s="CornerstoneToolsMouseClick");var l={page:n.point.pageToPoint(i),image:t.pageToPixel(c,i.pageX,i.pageY),client:{x:i.clientX,y:i.clientY}};l.canvas=t.pixelToCanvas(c,l.image);var m={page:n.point.subtract(l.page,h.page),image:n.point.subtract(l.image,h.image),client:n.point.subtract(l.client,h.client),canvas:n.point.subtract(l.canvas,h.canvas)},v={event:i,which:g,viewport:t.getViewport(c),image:t.getEnabledElement(c).image,element:c,startPoints:d,lastPoints:h,currentPoints:l,deltaPoints:m},y=e.Event(s,v);e(f.element).trigger(y,v),e(document).off("mousemove",p),e(document).off("mouseup",o),e(f.element).on("mousemove",u),r=!0}),o.pauseEvent(l)}function u(r){var a=r.currentTarget,i={page:n.point.pageToPoint(r),image:t.pageToPixel(a,r.pageX,r.pageY),client:{x:r.clientX,y:r.clientY}};i.canvas=t.pixelToCanvas(a,i.image);var s=o.copyPoints(i),l=r.which,c={page:n.point.pageToPoint(r),image:t.pageToPixel(a,r.pageX,r.pageY),client:{x:r.clientX,y:r.clientY}};c.canvas=t.pixelToCanvas(a,c.image);var u={page:n.point.subtract(c.page,s.page),image:n.point.subtract(c.image,s.image),client:n.point.subtract(c.client,s.client),canvas:n.point.subtract(c.canvas,s.canvas)},d={which:l,viewport:t.getViewport(a),image:t.getEnabledElement(a).image,element:a,startPoints:i,lastPoints:s,currentPoints:c,deltaPoints:u};e(a).trigger("CornerstoneToolsMouseMove",d),s=o.copyPoints(c)}function d(t){e(t).off("mousedown",c),e(t).off("mousemove",u),e(t).off("dblclick",l)}o.mouseInput={enable:function(t){d(t),e(t).on("mousedown",c),e(t).on("mousemove",u),e(t).on("dblclick",l)},disable:d}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n,o){"use strict";var r,a,i,s,l,c=1,u=0;function d(d){var h,f,m=d.target.parentNode;switch(d.preventDefault(),d.type){case"tap":(a={page:n.point.pageToPoint(d.pointers[0]),image:t.pageToPixel(m,d.pointers[0].pageX,d.pointers[0].pageY),client:{x:d.pointers[0].clientX,y:d.pointers[0].clientY}}).canvas=t.pixelToCanvas(m,a.image),f="CornerstoneToolsTap",l={event:d,viewport:t.getViewport(m),image:t.getEnabledElement(m).image,element:m,currentPoints:a,type:f},h=e.Event(f,l),e(m).trigger(h,l);break;case"doubletap":(a={page:n.point.pageToPoint(d.pointers[0]),image:t.pageToPixel(m,d.pointers[0].pageX,d.pointers[0].pageY),client:{x:d.pointers[0].clientX,y:d.pointers[0].clientY}}).canvas=t.pixelToCanvas(m,a.image),f="CornerstoneToolsDoubleTap",l={event:d,viewport:t.getViewport(m),image:t.getEnabledElement(m).image,element:m,currentPoints:a,type:f},h=e.Event(f,l),e(m).trigger(h,l);break;case"press":(a={page:n.point.pageToPoint(d.pointers[0]),image:t.pageToPixel(m,d.pointers[0].pageX,d.pointers[0].pageY),client:{x:d.pointers[0].clientX,y:d.pointers[0].clientY}}).canvas=t.pixelToCanvas(m,a.image),f="CornerstoneToolsTouchPress",l={event:d,viewport:t.getViewport(m),image:t.getEnabledElement(m).image,element:m,currentPoints:a,type:f},h=e.Event(f,l),e(m).trigger(h,l);break;case"pinch":var g=c-d.scale;c=d.scale,f="CornerstoneToolsTouchPinch",l={event:d,viewport:t.getViewport(m),image:t.getEnabledElement(m).image,element:m,direction:g<0?1:-1,type:f},h=e.Event(f,l),e(m).trigger(h,l);break;case"panstart":(r={page:n.point.pageToPoint(d.pointers[0]),image:t.pageToPixel(m,d.pointers[0].pageX,d.pointers[0].pageY),client:{x:d.pointers[0].clientX,y:d.pointers[0].clientY}}).canvas=t.pixelToCanvas(m,r.image),f=1===d.pointers.length?"CornerstoneToolsDragStart":"CornerstoneToolsMultiTouchDragStart",l={event:d.srcEvent,viewport:t.getViewport(m),image:t.getEnabledElement(m).image,element:m,startPoints:r,lastPoints:i,currentPoints:r,deltaPoints:{x:0,y:0},type:f},h=e.Event(f,l),e(l.element).trigger(h,l),i=o.copyPoints(r),!1===h.isImmediatePropagationStopped()&&function(t){e(t.element).trigger("CornerstoneToolsDragStartActive",t)}(l);break;case"panmove":(a={page:n.point.pageToPoint(d.pointers[0]),image:t.pageToPixel(m,d.pointers[0].pageX,d.pointers[0].pageY),client:{x:d.pointers[0].clientX,y:d.pointers[0].clientY}}).canvas=t.pixelToCanvas(m,a.image),s={page:n.point.subtract(a.page,i.page),image:n.point.subtract(a.image,i.image),client:n.point.subtract(a.client,i.client),canvas:n.point.subtract(a.canvas,i.canvas)},f="CornerstoneToolsTouchDrag",d.pointers.length>1&&(f="CornerstoneToolsMultiTouchDrag"),l={viewport:t.getViewport(m),image:t.getEnabledElement(m).image,element:m,startPoints:r,lastPoints:i,currentPoints:a,deltaPoints:s,type:f},h=e.Event(f,l),e(m).trigger(h,l),i=o.copyPoints(a);break;case"panend":return!!i&&((a={page:n.point.pageToPoint(d.pointers[0]),image:t.pageToPixel(m,d.pointers[0].pageX,d.pointers[0].pageY),client:{x:d.pointers[0].clientX,y:d.pointers[0].clientY}}).canvas=t.pixelToCanvas(m,a.image),s={page:n.point.subtract(a.page,i.page),image:n.point.subtract(a.image,i.image),client:n.point.subtract(a.client,i.client),canvas:n.point.subtract(a.canvas,i.canvas)},f="CornerstoneToolsDragEnd",d.pointers.length>1&&(f="CornerstoneToolsMultiTouchDragEnd"),l={event:d.srcEvent,viewport:t.getViewport(m),image:t.getEnabledElement(m).image,element:m,startPoints:r,lastPoints:i,currentPoints:a,deltaPoints:s,type:f},h=e.Event(f,l),e(m).trigger(h,l),o.pauseEvent(d));case"rotate":var p=d.rotation-u;u=d.rotation,f="CornerstoneToolsTouchRotate",l={event:d.srcEvent,viewport:t.getViewport(m),image:t.getEnabledElement(m).image,element:m,rotation:p,type:f},h=e.Event(f,l),e(m).trigger(h,l)}return!1}function h(t){var n=e(t).data("hammer");n&&n.off("press tap doubletap panstart panmove panend pinch rotate",d)}o.touchInput={enable:function(t){h(t);var n=new Hammer(t,{inputClass:Hammer.SUPPORT_POINTER_EVENTS?Hammer.PointerEventInput:Hammer.TouchInput});n.set({transform_always_block:!0,transform_min_scale:.01,drag_block_horizontal:!0,drag_block_vertical:!0,drag_min_distance:0});var r={pointers:0,direction:Hammer.DIRECTION_ALL},a=new Hammer.Pan(r),i=new Hammer.Pinch({threshold:.25}),s=new Hammer.Rotate({threshold:.05}),l=new Hammer.Press({threshold:10});i.recognizeWith(a),i.recognizeWith(s),n.add([l,a,i,s]),n.on("press tap doubletap panstart panmove panend pinch rotate",d),e(t).data("hammer",n),o.preventGhostClick(t)},disable:h}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n){"use strict";n.simpleMouseButtonTool=function(t){var n={};return{activate:function(n,o,r){e(n).off("CornerstoneToolsMouseDownActivate",t);var a={mouseButtonMask:o,options:r};e(n).on("CornerstoneToolsMouseDownActivate",a,t)},disable:function(n){e(n).off("CornerstoneToolsMouseDownActivate",t)},enable:function(n){e(n).off("CornerstoneToolsMouseDownActivate",t)},deactivate:function(n){e(n).off("CornerstoneToolsMouseDownActivate",t)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}}}($,cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";o.mouseButtonTool=function(n){var r={};function a(r,l){if(o.isMouseButtonEnabled(l.which,r.data.mouseButtonMask))return n.addNewMeasurement?n.addNewMeasurement(l):function(r){var l=r.element,c=n.createNewMeasurement(r);if(c){var u={mouseButtonMask:r.which};o.addToolState(r.element,n.toolType,c),e(l).off("CornerstoneToolsMouseMove",n.mouseMoveCallback||i),e(l).off("CornerstoneToolsMouseDown",n.mouseDownCallback||s),e(l).off("CornerstoneToolsMouseDownActivate",n.mouseDownActivateCallback||a),n.mouseDoubleClickCallback&&e(l).off("CornerstoneToolsMouseDoubleClick",n.mouseDoubleClickCallback),t.updateImage(l),o.moveNewHandle(r,c.handles.end,function(){c.active=!1,c.invalidated=!0,o.anyHandlesOutsideImage(r,c.handles)&&o.removeToolState(l,n.toolType,c),e(l).on("CornerstoneToolsMouseMove",u,n.mouseMoveCallback||i),e(l).on("CornerstoneToolsMouseDown",u,n.mouseDownCallback||s),e(l).on("CornerstoneToolsMouseDownActivate",u,n.mouseDownActivateCallback||a),n.mouseDoubleClickCallback&&e(l).on("CornerstoneToolsMouseDoubleClick",u,n.mouseDoubleClickCallback),t.updateImage(l)})}}(l),!1}function i(e,r){if(o.toolCoordinates.setCoords(r),0===r.which){var a=o.getToolState(r.element,n.toolType);if(void 0!==a){for(var i=!1,s=0;s<a.data.length;s++){var l=r.currentPoints.canvas,c=a.data[s];!0===o.handleActivator(r.element,c.handles,l)&&(i=!0),(n.pointNearTool(r.element,c,l)&&!c.active||!n.pointNearTool(r.element,c,l)&&c.active)&&(c.active=!c.active,i=!0)}!0===i&&t.updateImage(r.element)}}}function s(r,a){var s;function l(){s.active=!1,s.invalidated=!0,o.anyHandlesOutsideImage(a,s.handles)&&o.removeToolState(a.element,n.toolType,s),t.updateImage(a.element),e(a.element).on("CornerstoneToolsMouseMove",a,i)}if(o.isMouseButtonEnabled(a.which,r.data.mouseButtonMask)){var c,u=a.startPoints.canvas,d=o.getToolState(r.currentTarget,n.toolType);if(void 0!==d)for(c=0;c<d.data.length;c++){s=d.data[c];var h=o.getHandleNearImagePoint(a.element,s,u,25);if(void 0!==h)return e(a.element).off("CornerstoneToolsMouseMove",n.mouseMoveCallback||i),s.active=!0,o.moveHandle(a,h,l),r.stopImmediatePropagation(),!1}if(void 0!==d&&void 0!==n.pointNearTool)for(c=0;c<d.data.length;c++)if(s=d.data[c],n.pointNearTool(a.element,s,u))return e(a.element).off("CornerstoneToolsMouseMove",n.mouseMoveCallback||i),o.moveAllHandles(r,s,d,!0),e(a.element).on("CornerstoneToolsMouseMove",a,n.mouseMoveCallback||i),r.stopImmediatePropagation(),!1}}var l={enable:function(o){e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsMouseMove",n.mouseMoveCallback||i),e(o).off("CornerstoneToolsMouseDown",n.mouseDownCallback||s),e(o).off("CornerstoneToolsMouseDownActivate",n.mouseDownActivateCallback||a),n.mouseDoubleClickCallback&&e(o).off("CornerstoneToolsMouseDoubleClick",n.mouseDoubleClickCallback),e(o).on("CornerstoneImageRendered",n.onImageRendered),t.updateImage(o)},disable:function(o){e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsMouseMove",n.mouseMoveCallback||i),e(o).off("CornerstoneToolsMouseDown",n.mouseDownCallback||s),e(o).off("CornerstoneToolsMouseDownActivate",n.mouseDownActivateCallback||a),n.mouseDoubleClickCallback&&e(o).off("CornerstoneToolsMouseDoubleClick",n.mouseDoubleClickCallback),t.updateImage(o)},activate:function(o,r){var l={mouseButtonMask:r};e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsMouseMove",n.mouseMoveCallback||i),e(o).off("CornerstoneToolsMouseDown",n.mouseDownCallback||s),e(o).off("CornerstoneToolsMouseDownActivate",n.mouseDownActivateCallback||a),e(o).on("CornerstoneImageRendered",n.onImageRendered),e(o).on("CornerstoneToolsMouseMove",l,n.mouseMoveCallback||i),e(o).on("CornerstoneToolsMouseDown",l,n.mouseDownCallback||s),e(o).on("CornerstoneToolsMouseDownActivate",l,n.mouseDownActivateCallback||a),n.mouseDoubleClickCallback&&(e(o).off("CornerstoneToolsMouseDoubleClick",n.mouseDoubleClickCallback),e(o).on("CornerstoneToolsMouseDoubleClick",l,n.mouseDoubleClickCallback)),t.updateImage(o)},deactivate:function(o,r){var l={mouseButtonMask:r};e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsMouseMove",n.mouseMoveCallback||i),e(o).off("CornerstoneToolsMouseDown",n.mouseDownCallback||s),e(o).off("CornerstoneToolsMouseDownActivate",n.mouseDownActivateCallback||a),e(o).on("CornerstoneImageRendered",n.onImageRendered),e(o).on("CornerstoneToolsMouseMove",l,n.mouseMoveCallback||i),e(o).on("CornerstoneToolsMouseDown",l,n.mouseDownCallback||s),n.mouseDoubleClickCallback&&(e(o).off("CornerstoneToolsMouseDoubleClick",n.mouseDoubleClickCallback),e(o).on("CornerstoneToolsMouseDoubleClick",l,n.mouseDoubleClickCallback)),t.updateImage(o)},getConfiguration:function(){return r},setConfiguration:function(e){r=e},mouseDownCallback:s,mouseMoveCallback:i,mouseDownActivateCallback:a};return n.pointNearTool&&(l.pointNearTool=n.pointNearTool),n.mouseDoubleClickCallback&&(l.mouseDoubleClickCallback=n.mouseDoubleClickCallback),n.addNewMeasurement&&(l.addNewMeasurement=n.addNewMeasurement),l}}($,cornerstone,0,cornerstoneTools),function(e,t,n,o){"use strict";o.mouseButtonRectangleTool=function(n,r){function a(t,a){if(o.isMouseButtonEnabled(a.which,t.data.mouseButtonMask))return s=a,(l=n.createNewMeasurement(s))&&(o.addToolState(s.element,n.toolType,l),e(s.element).off("CornerstoneToolsMouseMove",i),o.moveHandle(s,l.handles.end,function(){l.active=!1,o.anyHandlesOutsideImage(s,l.handles)&&o.removeToolState(s.element,n.toolType,l),e(s.element).on("CornerstoneToolsMouseMove",i)},r)),!1;var s,l}function i(e,r){if(o.toolCoordinates.setCoords(r),0===r.which){var a=o.getToolState(r.element,n.toolType);if(void 0!==a){for(var i=!1,s=r.currentPoints.canvas,l=0;l<a.data.length;l++){var c=a.data[l];!0===o.handleActivator(r.element,c.handles,s)&&(i=!0),(n.pointInsideRect(r.element,c,s)&&!c.active||!n.pointInsideRect(r.element,c,s)&&c.active)&&(c.active=!c.active,i=!0)}!0===i&&t.updateImage(r.element)}}}function s(a,s){var l;function c(){l.active=!1,o.anyHandlesOutsideImage(s,l.handles)&&o.removeToolState(s.element,n.toolType,l),t.updateImage(s.element),e(s.element).on("CornerstoneToolsMouseMove",i)}if(o.isMouseButtonEnabled(s.which,a.data.mouseButtonMask)){var u,d=s.startPoints.canvas,h=o.getToolState(a.currentTarget,n.toolType);if(void 0!==h)for(u=0;u<h.data.length;u++){l=h.data[u];var f=o.getHandleNearImagePoint(s.element,l,d);if(void 0!==f)return e(s.element).off("CornerstoneToolsMouseMove",i),l.active=!0,o.moveHandle(s,f,c,r),a.stopImmediatePropagation(),!1}if(void 0!==h&&void 0!==n.pointInsideRect)for(u=0;u<h.data.length;u++)if(l=h.data[u],n.pointInsideRect(s.element,l,d))return e(s.element).off("CornerstoneToolsMouseMove",i),o.moveAllHandles(a,l,h,!1,r),e(s.element).on("CornerstoneToolsMouseMove",i),a.stopImmediatePropagation(),!1}}return{enable:function(o){e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsMouseMove",i),e(o).off("CornerstoneToolsMouseDown",s),e(o).off("CornerstoneToolsMouseDownActivate",a),e(o).on("CornerstoneImageRendered",n.onImageRendered),t.updateImage(o)},disable:function(o){e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsMouseMove",i),e(o).off("CornerstoneToolsMouseDown",s),e(o).off("CornerstoneToolsMouseDownActivate",a),t.updateImage(o)},activate:function(o,r){var l={mouseButtonMask:r};e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsMouseMove",i),e(o).off("CornerstoneToolsMouseDown",s),e(o).off("CornerstoneToolsMouseDownActivate",a),e(o).on("CornerstoneImageRendered",n.onImageRendered),e(o).on("CornerstoneToolsMouseMove",l,i),e(o).on("CornerstoneToolsMouseDown",l,s),e(o).on("CornerstoneToolsMouseDownActivate",l,a),t.updateImage(o)},deactivate:function(o,r){var l={mouseButtonMask:r};e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsMouseMove",i),e(o).off("CornerstoneToolsMouseDown",s),e(o).off("CornerstoneToolsMouseDownActivate",a),e(o).on("CornerstoneImageRendered",n.onImageRendered),e(o).on("CornerstoneToolsMouseMove",l,i),e(o).on("CornerstoneToolsMouseDown",l,s),t.updateImage(o)}}}}($,cornerstone,0,cornerstoneTools),function(e,t,n){"use strict";n.mouseWheelTool=function(t){return{activate:function(n){e(n).off("CornerstoneToolsMouseWheel",t),e(n).on("CornerstoneToolsMouseWheel",{},t)},disable:function(n){e(n).off("CornerstoneToolsMouseWheel",t)},enable:function(n){e(n).off("CornerstoneToolsMouseWheel",t)},deactivate:function(n){e(n).off("CornerstoneToolsMouseWheel",t)}}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.touchDragTool=function(t){return{activate:function(n){e(n).off("CornerstoneToolsTouchDrag",t),e(n).on("CornerstoneToolsTouchDrag",t)},disable:function(n){e(n).off("CornerstoneToolsTouchDrag",t)},enable:function(n){e(n).off("CornerstoneToolsTouchDrag",t)},deactivate:function(n){e(n).off("CornerstoneToolsTouchDrag",t)}}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.touchPinchTool=function(t){return{activate:function(n){e(n).off("CornerstoneToolsTouchPinch",t),e(n).on("CornerstoneToolsTouchPinch",{},t)},disable:function(n){e(n).off("CornerstoneToolsTouchPinch",t)},enable:function(n){e(n).off("CornerstoneToolsTouchPinch",t)},deactivate:function(n){e(n).off("CornerstoneToolsTouchPinch",t)}}}}($,cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";function r(e){Object.keys(e).forEach(function(t){e[t].active=!1})}function a(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&r(n.handles)}}o.touchTool=function(n){function r(a,l){return n.addNewMeasurement?n.addNewMeasurement(l):function(a){var l=a.element,c=n.createNewMeasurement(a);if(c){if(o.addToolState(l,n.toolType,c),1===Object.keys(c.handles).length&&"CornerstoneToolsTap"===a.type)return c.active=!1,c.handles.end.active=!1,c.handles.end.highlight=!1,c.invalidated=!0,o.anyHandlesOutsideImage(a,c.handles)&&o.removeToolState(l,n.toolType,c),void t.updateImage(l);e(l).off("CornerstoneToolsDragStartActive",n.touchDownActivateCallback||r),e(l).off("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),e(l).off("CornerstoneToolsTap",n.tapCallback||s),t.updateImage(l),o.moveNewHandleTouch(a,c.handles.end,function(){c.active=!1,c.invalidated=!0,o.anyHandlesOutsideImage(a,c.handles)&&o.removeToolState(l,n.toolType,c),e(l).on("CornerstoneToolsDragStartActive",n.touchDownActivateCallback||r),e(l).on("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),e(l).on("CornerstoneToolsTap",n.tapCallback||s),t.updateImage(l)})}}(l),!1}function i(e,r){o.toolCoordinates.setCoords(r);var a=o.getToolState(r.element,n.toolType);if(void 0!==a){for(var i=!1,s=0;s<a.data.length;s++){var l=r.currentPoints.canvas,c=a.data[s];!0===o.handleActivator(r.element,c.handles,l)&&(i=!0)}return!0===i&&t.updateImage(r.element),!1}}function s(l,c){var u,d,h=c.element,f=c.currentPoints.canvas,m=o.getToolState(l.currentTarget,n.toolType);function g(){a(m),o.anyHandlesOutsideImage(c,u.handles)&&o.removeToolState(h,n.toolType,u),t.updateImage(h),e(h).on("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),e(h).on("CornerstoneToolsDragStartActive",n.touchDownActivateCallback||r),e(h).on("CornerstoneToolsTap",n.tapCallback||s)}if(a(m),m)for(d=0;d<m.data.length;d++){u=m.data[d];var p=o.getHandleNearImagePoint(h,u,f,75);if(p)return e(h).off("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),e(h).off("CornerstoneToolsDragStartActive",n.touchDownActivateCallback||r),e(h).off("CornerstoneToolsTap",n.tapCallback||s),u.active=!0,p.active=!0,t.updateImage(h),o.touchMoveHandle(l,p,g),l.stopImmediatePropagation(),!1}if(m&&n.pointNearTool)for(d=0;d<m.data.length;d++)if(u=m.data[d],n.pointNearTool(h,u,f))return e(h).off("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),e(h).off("CornerstoneToolsDragStartActive",n.touchDownActivateCallback||r),e(h).off("CornerstoneToolsTap",n.tapCallback||s),u.active=!0,t.updateImage(h),o.touchMoveAllHandles(l,u,m,!0,g),l.stopImmediatePropagation(),!1;return n.touchDownActivateCallback?n.touchDownActivateCallback(l,c):r(0,c),!1}var l={enable:function(o){e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),e(o).off("CornerstoneToolsDragStartActive",n.touchDownActivateCallback||r),e(o).off("CornerstoneToolsTap",n.tapCallback||s),e(o).on("CornerstoneImageRendered",n.onImageRendered),n.doubleTapCallback&&e(o).off("CornerstoneToolsDoubleTap",n.doubleTapCallback),n.pressCallback&&e(o).off("CornerstoneToolsTouchPress",n.pressCallback),t.updateImage(o)},disable:function(o){e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),e(o).off("CornerstoneToolsDragStartActive",n.touchDownActivateCallback||r),e(o).off("CornerstoneToolsTap",n.tapCallback||s),n.doubleTapCallback&&e(o).off("CornerstoneToolsDoubleTap",n.doubleTapCallback),n.pressCallback&&e(o).off("CornerstoneToolsTouchPress",n.pressCallback),t.updateImage(o)},activate:function(o){e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),e(o).off("CornerstoneToolsDragStartActive",n.touchDownActivateCallback||r),e(o).off("CornerstoneToolsTap",n.tapCallback||s),e(o).on("CornerstoneImageRendered",n.onImageRendered),e(o).on("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),e(o).on("CornerstoneToolsDragStartActive",n.touchDownActivateCallback||r),e(o).on("CornerstoneToolsTap",n.tapCallback||s),n.doubleTapCallback&&(e(o).off("CornerstoneToolsDoubleTap",n.doubleTapCallback),e(o).on("CornerstoneToolsDoubleTap",n.doubleTapCallback)),n.pressCallback&&(e(o).off("CornerstoneToolsTouchPress",n.pressCallback),e(o).on("CornerstoneToolsTouchPress",n.pressCallback)),t.updateImage(o)},deactivate:function(o){e(o).off("CornerstoneImageRendered",n.onImageRendered),e(o).off("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),e(o).off("CornerstoneToolsDragStartActive",n.touchDownActivateCallback||r),e(o).off("CornerstoneToolsTap",n.tapCallback||s),e(o).on("CornerstoneImageRendered",n.onImageRendered),e(o).on("CornerstoneToolsTouchDrag",n.touchMoveCallback||i),n.doubleTapCallback&&(e(o).off("CornerstoneToolsDoubleTap",n.doubleTapCallback),e(o).on("CornerstoneToolsDoubleTap",n.doubleTapCallback)),n.pressCallback&&(e(o).off("CornerstoneToolsTouchPress",n.pressCallback),e(o).on("CornerstoneToolsTouchPress",n.pressCallback)),t.updateImage(o)},touchMoveCallback:i,touchDownActivateCallback:r,tapCallback:s};return n.doubleTapCallback&&(l.doubleTapCallback=n.doubleTapCallback),n.pressCallback&&(l.pressCallback=n.pressCallback),n.addNewMeasurement&&(l.addNewMeasurement=n.addNewMeasurement),n.touchStartCallback&&(l.touchStartCallback=n.touchStartCallback),l}}($,cornerstone,0,cornerstoneTools),function(e,t,n,o){"use strict";var r="angle";function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y+20,highlight:!0,active:!1}}}}function i(e,o,r){var a={start:t.pixelToCanvas(e,o.handles.start),end:t.pixelToCanvas(e,o.handles.end)},i=n.lineSegment.distanceToPoint(a,r);return i<5||(a.start=t.pixelToCanvas(e,o.handles.start2),a.end=t.pixelToCanvas(e,o.handles.end2),(i=n.lineSegment.distanceToPoint(a,r))<5)}function s(e,n){var a=o.getToolState(e.currentTarget,r);if(void 0!==a){var i,s=n.canvasContext.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0);for(var l=o.toolStyle.getToolWidth(),c=o.textStyle.getFont(),u=o.angle.getConfiguration(),d=0;d<a.data.length;d++){s.save(),u&&u.shadow&&(s.shadowColor="#000000",s.shadowOffsetX=1,s.shadowOffsetY=1);var h=a.data[d];i=h.active?o.toolColors.getActiveColor():o.toolColors.getToolColor(),s.beginPath(),s.strokeStyle=i,s.lineWidth=l;var f=t.pixelToCanvas(n.element,h.handles.start),m=t.pixelToCanvas(n.element,h.handles.end);s.moveTo(f.x,f.y),s.lineTo(m.x,m.y),f=t.pixelToCanvas(n.element,h.handles.start2),m=t.pixelToCanvas(n.element,h.handles.end2),s.moveTo(f.x,f.y),s.lineTo(m.x,m.y),s.stroke(),o.drawHandles(s,n,h.handles),s.fillStyle=i;var g=(Math.ceil(h.handles.start.x)-Math.ceil(h.handles.end.x))*n.image.columnPixelSpacing,p=(Math.ceil(h.handles.start.y)-Math.ceil(h.handles.end.y))*n.image.rowPixelSpacing,v=(Math.ceil(h.handles.start2.x)-Math.ceil(h.handles.end2.x))*n.image.columnPixelSpacing,y=(Math.ceil(h.handles.start2.y)-Math.ceil(h.handles.end2.y))*n.image.rowPixelSpacing,w=Math.acos(Math.abs((g*v+p*y)/(Math.sqrt(g*g+p*p)*Math.sqrt(v*v+y*y))));w*=180/Math.PI;var T=o.roundToDecimal(w,2).toString()+String.fromCharCode(parseInt("00B0",16)),x=(f.x+m.x)/2,b=(f.y+m.y)/2;s.font=c,o.drawTextBox(s,T,x,b,i),s.restore()}}}o.angle=o.mouseButtonTool({createNewMeasurement:a,onImageRendered:s,pointNearTool:i,toolType:r}),o.angleTouch=o.touchTool({createNewMeasurement:a,onImageRendered:s,pointNearTool:i,toolType:r})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n,o){"use strict";var r="arrowAnnotate";var a={getTextCallback:function(e){e(prompt("Enter your annotation:"))},drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0};function i(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1}}}}function s(e,o,r){var a={start:t.pixelToCanvas(e,o.handles.start),end:t.pixelToCanvas(e,o.handles.end)};return n.lineSegment.distanceToPoint(a,r)<25}function l(e,t,n,o,r){var a=Math.atan2(n.y-t.y,n.x-t.x);e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.strokeStyle=o,e.lineWidth=r,e.stroke(),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(n.x-10*Math.cos(a-Math.PI/7),n.y-10*Math.sin(a-Math.PI/7)),e.lineTo(n.x-10*Math.cos(a+Math.PI/7),n.y-10*Math.sin(a+Math.PI/7)),e.lineTo(n.x,n.y),e.lineTo(n.x-10*Math.cos(a-Math.PI/7),n.y-10*Math.sin(a-Math.PI/7)),e.strokeStyle=o,e.lineWidth=r,e.stroke(),e.fillStyle=o,e.fill()}function c(e,n){var a=o.getToolState(e.currentTarget,r);if(void 0!==a){var i,s=n.canvasContext.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0);for(var c=o.toolStyle.getToolWidth(),u=o.textStyle.getFont(),d=o.arrowAnnotate.getConfiguration(),h=0;h<a.data.length;h++){s.save();var f=a.data[h];i=f.active?o.toolColors.getActiveColor():o.toolColors.getToolColor();var m=t.pixelToCanvas(n.element,f.handles.start),g=t.pixelToCanvas(n.element,f.handles.end);if(d.arrowFirst?l(s,g,m,i,c):l(s,m,g,i,c),d.drawHandles?o.drawHandles(s,n,f.handles,i):d.drawHandlesOnHover&&f.handles.start.active?o.drawHandles(s,n,[f.handles.start],i):d.drawHandlesOnHover&&f.handles.end.active&&o.drawHandles(s,n,[f.handles.end],i),f.annotationText&&""!==f.annotationText){s.font=u;var p,v,y={x:13,y:6.5};p={x:g.x-m.x,y:g.y-m.y},d.arrowFirst?(p.x<0&&(y.x=-y.x-s.measureText(f.annotationText).width),v={x:p.x+m.x+y.x,y:p.y+m.y+y.y}):(p.x>0&&(y.x=-y.x-s.measureText(f.annotationText).width),v={x:-p.x+g.x+y.x,y:-p.y+g.y+y.y}),o.drawTextBox(s,f.annotationText,v.x,v.y,i)}s.restore()}}}o.arrowAnnotate=o.mouseButtonTool({addNewMeasurement:function(n){function a(e){null!==e?s.annotationText=e:o.removeToolState(n.element,r,s),s.active=!1,t.updateImage(n.element)}var s=i(n),l={mouseButtonMask:n.which};o.addToolState(n.element,r,s),e(n.element).off("CornerstoneToolsMouseMove",o.arrowAnnotate.mouseMoveCallback),e(n.element).off("CornerstoneToolsMouseDown",o.arrowAnnotate.mouseDownCallback),e(n.element).off("CornerstoneToolsMouseDownActivate",o.arrowAnnotate.mouseDownActivateCallback),t.updateImage(n.element),o.moveNewHandle(n,s.handles.end,function(){o.anyHandlesOutsideImage(n,s.handles)&&o.removeToolState(n.element,r,s);var i=o.arrowAnnotate.getConfiguration();void 0===s.annotationText&&i.getTextCallback(a),e(n.element).on("CornerstoneToolsMouseMove",l,o.arrowAnnotate.mouseMoveCallback),e(n.element).on("CornerstoneToolsMouseDown",l,o.arrowAnnotate.mouseDownCallback),e(n.element).on("CornerstoneToolsMouseDownActivate",l,o.arrowAnnotate.mouseDownActivateCallback),t.updateImage(n.element)})},createNewMeasurement:i,onImageRendered:c,pointNearTool:s,toolType:r}),o.arrowAnnotate.setConfiguration(a),o.arrowAnnotateTouch=o.touchTool({addNewMeasurement:function(n){var a=n.element;function s(e){null!==e?l.annotationText=e:o.removeToolState(a,r,l),l.active=!1,t.updateImage(a)}var l=i(n);o.addToolState(a,r,l),e(a).off("CornerstoneToolsTouchDrag",o.arrowAnnotateTouch.touchMoveCallback),e(a).off("CornerstoneToolsDragStartActive",o.arrowAnnotateTouch.touchDownActivateCallback),e(a).off("CornerstoneToolsTap",o.arrowAnnotateTouch.tapCallback),t.updateImage(a),o.moveNewHandleTouch(n,l.handles.end,function(){t.updateImage(a),o.anyHandlesOutsideImage(n,l.handles)&&o.removeToolState(a,r,l);var i=o.arrowAnnotate.getConfiguration();void 0===l.annotationText&&i.getTextCallback(s),e(a).on("CornerstoneToolsTouchDrag",o.arrowAnnotateTouch.touchMoveCallback),e(a).on("CornerstoneToolsDragStartActive",o.arrowAnnotateTouch.touchDownActivateCallback),e(a).on("CornerstoneToolsTap",o.arrowAnnotateTouch.tapCallback)})},createNewMeasurement:i,onImageRendered:c,pointNearTool:s,toolType:r})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n){"use strict";var o="crosshairs";function r(r,a){var i=n.getToolState(r.currentTarget,o);if(i){var s=r.currentTarget,l=t.getEnabledElement(s).image.imageId,c=n.metaData.get("imagePlane",l),u=a.currentPoints.image,d=n.imagePointToPatientPoint(u,c),h=i.data[0].synchronizationContext.getSourceElements();e.each(h,function(o,r){if(r!==s){var a=Number.MAX_VALUE,i=-1,l=n.getToolState(r,"stack");if(void 0!==l){var c=l.data[0];if(e.each(c.imageIds,function(e,t){var o=n.metaData.get("imagePlane",t),r=o.imagePositionPatient,s=o.rowCosines.clone(),l=o.columnCosines.clone().clone().cross(s.clone()),c=Math.abs(l.clone().dot(r)-l.clone().dot(d));c<a&&(a=c,i=e)}),i!==c.currentImageIdIndex&&-1!==i&&void 0!==c.imageIds[i]){var u=n.loadHandlerManager.getStartLoadHandler(),h=n.loadHandlerManager.getEndLoadHandler(),f=n.loadHandlerManager.getErrorLoadingHandler();u&&u(r),t.loadAndCacheImage(c.imageIds[i]).then(function(e){var n=t.getViewport(r);c.currentImageIdIndex=i,t.displayImage(r,e,n),h&&h(r)},function(e){var t=c.imageIds[i];f&&f(r,t,e)})}}}})}}function a(t,n){e(n.element).off("CornerstoneToolsMouseDrag",s),e(n.element).off("CornerstoneToolsMouseUp",a)}function i(t,o){if(n.isMouseButtonEnabled(o.which,t.data.mouseButtonMask))return e(o.element).on("CornerstoneToolsMouseDrag",s),e(o.element).on("CornerstoneToolsMouseUp",a),r(t,o),!1}function s(e,t){return r(e,t),!1}n.crosshairs={enable:function(t,r,a){var s={mouseButtonMask:r};n.addToolState(t,o,{synchronizationContext:a}),e(t).off("CornerstoneToolsMouseDown",i),e(t).on("CornerstoneToolsMouseDown",s,i)},disable:function(t){e(t).off("CornerstoneToolsMouseDown",i)}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.displayTool=function(n){var o={};return{disable:function(t){e(t).off("CornerstoneImageRendered",n)},enable:function(o){e(o).off("CornerstoneImageRendered",n),e(o).on("CornerstoneImageRendered",n),t.updateImage(o)},getConfiguration:function(){return o},setConfiguration:function(e){o=e}}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";function o(e){var o=t.getEnabledElement(e.element);t.updateImage(e.element);var r=o.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);var a=n.toolColors.getActiveColor(),i=n.textStyle.getFont(),s=n.textStyle.getFontSize();r.save();var l=Math.round(e.currentPoints.image.x),c=Math.round(e.currentPoints.image.y),u=t.getStoredPixels(e.element,l,c,1,1)[0],d=u*e.image.slope+e.image.intercept,h=n.calculateSUV(e.image,u),f={x:e.currentPoints.image.x+3,y:e.currentPoints.image.y-3},m=t.pixelToCanvas(e.element,f);r.font=i,r.fillStyle=a;var g=l+","+c,p="SP: "+u+" MO: "+parseFloat(d.toFixed(3));h&&(p+=" SUV: "+parseFloat(h.toFixed(3))),n.drawTextBox(r,p,m.x,m.y+s+5,a),n.drawTextBox(r,g,m.x,m.y,a),r.restore()}function r(n,o){e(o.element).off("CornerstoneToolsMouseDrag",a),e(o.element).off("CornerstoneToolsMouseUp",r),t.updateImage(o.element)}function a(e,t){return n.dragProbe.strategy(t),!1}n.dragProbe=n.simpleMouseButtonTool(function(t,o){if(n.isMouseButtonEnabled(o.which,t.data.mouseButtonMask))return e(o.element).on("CornerstoneToolsMouseDrag",a),e(o.element).on("CornerstoneToolsMouseUp",r),n.dragProbe.strategy(o),!1}),n.dragProbe.strategies={default:o,minimal:function(e){var o=t.getEnabledElement(e.element);t.updateImage(e.element);var r=o.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);var a=n.toolColors.getActiveColor(),i=n.textStyle.getFont();r.save();var s=Math.round(e.currentPoints.image.x),l=Math.round(e.currentPoints.image.y),c=t.getStoredPixels(e.element,s,l,1,1)[0]*e.image.slope+e.image.intercept;c=parseFloat(c.toFixed(3));var u={x:e.currentPoints.image.x+4,y:e.currentPoints.image.y-4},d=t.pixelToCanvas(e.element,u);r.font=i,r.fillStyle=a,n.drawTextBox(r,c,d.x,d.y,a),r.restore()}},n.dragProbe.strategy=o,n.dragProbeTouch=n.touchDragTool(a)}($,cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";var r="ellipticalRoi";function a(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function i(e,t){var n=e.width/2,o=e.height/2;if(n<=0||o<=0)return!1;var r=e.left+n,a=e.top+o,i=t.x-r,s=t.y-a;return i*s/(n*n)+s*s/(o*o)<=1}function s(e,t){for(var n=0,o=0,r=0,a=0,s=t.top;s<t.top+t.height;s++)for(var l=t.left;l<t.left+t.width;l++)!0===i(t,{x:l,y:s})&&(n+=e[a],o+=e[a]*e[a],r++),a++;if(0===r)return{count:r,mean:0,variance:0,stdDev:0};var c=n/r,u=o/r-c*c;return{count:r,mean:c,variance:u,stdDev:Math.sqrt(u)}}function l(e,n){var a=o.getToolState(e.currentTarget,r);if(void 0!==a){var i,l=n.canvasContext.canvas.getContext("2d");l.setTransform(1,0,0,1,0,0);for(var c=o.toolStyle.getToolWidth(),u=o.textStyle.getFont(),d=o.textStyle.getFontSize(),h=0;h<a.data.length;h++){l.save();var f=a.data[h];i=f.active?o.toolColors.getActiveColor():o.toolColors.getToolColor();var m,g,p,v,y,w,T=t.pixelToCanvas(n.element,f.handles.start),x=t.pixelToCanvas(n.element,f.handles.end),b=Math.abs(T.x-x.x),C=Math.abs(T.y-x.y),P=Math.min(T.x,x.x),S=Math.min(T.y,x.y),M=(T.x+x.x)/2,I=(T.y+x.y)/2;if(l.beginPath(),l.strokeStyle=i,l.lineWidth=c,o.drawEllipse(l,P,S,b,C),l.closePath(),o.drawHandles(l,n,f.handles),l.font=u,f.invalidated){var D=Math.abs(f.handles.start.x-f.handles.end.x),k=Math.abs(f.handles.start.y-f.handles.end.y),E=Math.min(f.handles.start.x,f.handles.end.x),A=Math.min(f.handles.start.y,f.handles.end.y);p=s(t.getPixels(n.element,E,A,D,k),{left:E,top:A,width:D,height:k}),v=Math.PI*(D*n.image.columnPixelSpacing/2)*(k*n.image.rowPixelSpacing/2),f.invalidated=!1,isNaN(v)||(f.area=v),isNaN(p.mean)||isNaN(p.stdDev)||(f.meanStdDev=p)}else m=f.textX,g=f.textY,p=f.meanStdDev,v=f.area;if(void 0!==v)y="Area: "+v.toFixed(2)+" mm"+String.fromCharCode(178),w=l.measureText(y);else{var R="StdDev: "+p.stdDev.toFixed(2);w=l.measureText(R)}m=M<n.image.columns/2?M+b/2:M-b/2-w.width,g=I<n.image.rows/2?I+C/2:I-C/2,l.fillStyle=i,p&&(o.drawTextBox(l,"Mean: "+p.mean.toFixed(2),m,g-d-5,i),o.drawTextBox(l,"StdDev: "+p.stdDev.toFixed(2),m,g,i)),void 0===v||isNaN(v)||o.drawTextBox(l,y,m,g+d+5,i),l.restore()}}}o.ellipticalRoi=o.mouseButtonTool({createNewMeasurement:a,onImageRendered:l,pointNearTool:function(e,o,r){var a=t.pixelToCanvas(e,o.handles.start),i=t.pixelToCanvas(e,o.handles.end),s={left:Math.min(a.x,i.x),top:Math.min(a.y,i.y),width:Math.abs(a.x-i.x),height:Math.abs(a.y-i.y)};return n.rect.distanceToPoint(s,r)<5},toolType:r}),o.ellipticalRoiTouch=o.touchTool({createNewMeasurement:a,onImageRendered:l,pointNearTool:function(e,o,r){var a=t.pixelToCanvas(e,o.handles.start),i=t.pixelToCanvas(e,o.handles.end),s={left:Math.min(a.x,i.x),top:Math.min(a.y,i.y),width:Math.abs(a.x-i.x),height:Math.abs(a.y-i.y)};return n.rect.distanceToPoint(s,r)<15},toolType:r})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n,o){"use strict";var r="freehand",a={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1};function i(e){var n=o.getToolState(e.element,r);if(void 0!==n){var a=o.freehand.getConfiguration(),i=n.data[a.currentTool],s={x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,lines:[]};i.handles.length&&i.handles[a.currentHandle-1].lines.push(e.currentPoints.image),i.handles.push(s),a.currentHandle+=1,a.freehand=!1,t.updateImage(e.element)}}function s(e,a){var i=o.getToolState(e.element,r);if(void 0!==i){var s=i.data[a];if(void 0!==s.handles)for(var l=e.currentPoints.canvas,c=0;c<s.handles.length;c++){var u=t.pixelToCanvas(e.element,s.handles[c]);if(n.point.distance(u,l)<5)return c}}}function l(n,a){if(e(a.element).off("CornerstoneToolsMouseUp",l),void 0!==o.getToolState(a.element,r)){var i=o.freehand.getConfiguration();a.event.shiftKey||(i.freehand=!1),t.updateImage(a.element)}}function c(e,n){var a=o.getToolState(n.element,r);if(void 0!==a){var i=o.freehand.getConfiguration(),l=a.data[i.currentTool];i.mouseLocation.handles.start.x=n.currentPoints.image.x,i.mouseLocation.handles.start.y=n.currentPoints.image.y;var c=i.currentHandle;if(i.modifying&&(l.active=!0,l.highlight=!0,l.handles[c].x=i.mouseLocation.handles.start.x,l.handles[c].y=i.mouseLocation.handles.start.y,c)){var u=l.handles[c-1].lines.length-1,d=l.handles[c-1].lines[u];d.x=i.mouseLocation.handles.start.x,d.y=i.mouseLocation.handles.start.y}if(i.freehand)l.handles[c-1].lines.push(n.currentPoints.image);else{var h=s(n,i.currentTool);void 0!==h&&h<l.handles.length-1&&(i.mouseLocation.handles.start.x=l.handles[h].x,i.mouseLocation.handles.start.y=l.handles[h].y)}t.updateImage(n.element)}}function u(n,a){var i=o.getToolState(n.element,r);if(void 0!==i){var s=o.freehand.getConfiguration(),l=i.data[s.currentTool];l.active=!1,l.highlight=!1,void 0!==a&&l.handles[s.currentHandle-1].lines.push(l.handles[a]),s.modifying&&(s.modifying=!1),s.currentHandle=0,s.currentTool=-1,e(n.element).off("CornerstoneToolsMouseMove",c),t.updateImage(n.element)}}function d(t,n){if(o.isMouseButtonEnabled(n.which,t.data.mouseButtonMask)){var a,d,h=o.getToolState(n.element,r),f=o.freehand.getConfiguration(),m=f.currentTool;if(f.modifying)return void u(n);if(m<0){var g=function(e){var t=o.getToolState(e.element,r);if(void 0!==t)for(var n,a=0;a<t.data.length;a++)if(void 0!==(n=s(e,a)))return{handleNearby:n,toolIndex:a}}(n);g?(a=g.handleNearby,d=g.toolIndex,void 0!==a&&(e(n.element).on("CornerstoneToolsMouseMove",c),e(n.element).on("CornerstoneToolsMouseUp",l),f.modifying=!0,f.currentHandle=a,f.currentTool=d)):(!function(t){e(t.element).on("CornerstoneToolsMouseMove",c),e(t.element).on("CornerstoneToolsMouseUp",l);var n=o.freehand.getConfiguration();n.mouseLocation.handles.start.x=t.currentPoints.image.x,n.mouseLocation.handles.start.y=t.currentPoints.image.y,o.addToolState(t.element,r,{visible:!0,active:!0,handles:[]});var a=o.getToolState(t.element,r);n.currentTool=a.data.length-1}(n),i(n))}else m>=0&&h.data[m].active&&(void 0!==(a=s(n,m))?u(n,a):n.event.shiftKey?f.freehand=!0:i(n));return!1}}function h(e,n){var a=o.getToolState(e.currentTarget,r);if(void 0!==a){var i,s=o.freehand.getConfiguration(),l=n.canvasContext.canvas.getContext("2d");l.setTransform(1,0,0,1,0,0);for(var c=o.toolStyle.getToolWidth(),u=o.toolColors.getFillColor(),d=0;d<a.data.length;d++){l.save();var h,f=a.data[d];if(f.active?(i=o.toolColors.getActiveColor(),u=o.toolColors.getFillColor()):(i=o.toolColors.getToolColor(),u=o.toolColors.getToolColor()),f.handles.length)for(var m=0;m<f.handles.length;m++){h=f.handles[m];var g=t.pixelToCanvas(n.element,h);l.beginPath(),l.strokeStyle=i,l.lineWidth=c,l.moveTo(g.x,g.y);for(var p=0;p<f.handles[m].lines.length;p++){var v=t.pixelToCanvas(n.element,f.handles[m].lines[p]);l.lineTo(v.x,v.y),l.stroke()}var y=t.pixelToCanvas(n.element,s.mouseLocation.handles.start);m===f.handles.length-1&&(!f.active||s.freehand||s.modifying||(l.lineTo(y.x,y.y),l.stroke()))}f.active&&o.drawHandles(l,n,s.mouseLocation.handles,i,u),o.drawHandles(l,n,f.handles,i,u),l.restore()}}}o.freehand={enable:function(n){e(n).off("CornerstoneToolsMouseDown",d),e(n).off("CornerstoneToolsMouseUp",l),e(n).off("CornerstoneToolsMouseMove",c),e(n).off("CornerstoneImageRendered",h),e(n).on("CornerstoneImageRendered",h),t.updateImage(n)},disable:function(n){e(n).off("CornerstoneToolsMouseDown",d),e(n).off("CornerstoneToolsMouseUp",l),e(n).off("CornerstoneToolsMouseMove",c),e(n).off("CornerstoneImageRendered",h),t.updateImage(n)},activate:function(n,o){var r={mouseButtonMask:o};e(n).off("CornerstoneToolsMouseDown",r,d),e(n).off("CornerstoneToolsMouseUp",l),e(n).off("CornerstoneToolsMouseMove",c),e(n).off("CornerstoneImageRendered",h),e(n).on("CornerstoneImageRendered",h),e(n).on("CornerstoneToolsMouseDown",r,d),t.updateImage(n)},deactivate:function(n){e(n).off("CornerstoneToolsMouseDown",d),e(n).off("CornerstoneToolsMouseUp",l),e(n).off("CornerstoneToolsMouseMove",c),e(n).off("CornerstoneImageRendered",h),e(n).on("CornerstoneImageRendered",h),t.updateImage(n)},getConfiguration:function(){return a},setConfiguration:function(e){a=e}}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n,o){"use strict";var r="highlight";function a(e){var t=o.getToolState(e.event.currentTarget,r);if(!(t&&t.data&&t.data.length>0))return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function i(e,n,o){var r=t.pixelToCanvas(e,n.handles.start),a=t.pixelToCanvas(e,n.handles.end),i=Math.min(r.x,a.x),s=Math.min(r.y,a.y),l=Math.abs(r.x-a.x),c=Math.abs(r.y-a.y),u=!1;return o.x>=i&&o.x<=i+l&&o.y>=s&&o.y<=s+c&&(u=!0),u}function s(e,o,r){var a=t.pixelToCanvas(e,o.handles.start),i=t.pixelToCanvas(e,o.handles.end),s={left:Math.min(a.x,i.x),top:Math.min(a.y,i.y),width:Math.abs(a.x-i.x),height:Math.abs(a.y-i.y)};return n.rect.distanceToPoint(s,r)<5}function l(e,n){var a=o.getToolState(e.currentTarget,r);if(void 0!==a){var i,s=n.canvasContext.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0);var l=o.toolStyle.getToolWidth();s.save();var c=a.data[0];if(c){i=c.active?o.toolColors.getActiveColor():o.toolColors.getToolColor();var u=t.pixelToCanvas(n.element,c.handles.start),d=t.pixelToCanvas(n.element,c.handles.end),h={left:Math.min(u.x,d.x),top:Math.min(u.y,d.y),width:Math.abs(u.x-d.x),height:Math.abs(u.y-d.y)};s.beginPath(),s.strokeStyle="transparent",s.rect(0,0,s.canvas.clientWidth,s.canvas.clientHeight),s.rect(h.width+h.left,h.top,-h.width,h.height),s.stroke(),s.fillStyle="rgba(0,0,0,0.7)",s.fill(),s.closePath(),s.beginPath(),s.strokeStyle=i,s.lineWidth=l,s.setLineDash([4]),s.strokeRect(h.left,h.top,h.width,h.height),s.setLineDash([]),o.drawHandles(s,n,c.handles,i),s.restore()}}}o.highlight=o.mouseButtonRectangleTool({createNewMeasurement:a,onImageRendered:l,pointNearTool:s,pointInsideRect:i,toolType:r},!0),o.highlightTouch=o.touchTool({createNewMeasurement:a,onImageRendered:l,pointNearTool:s,pointInsideRect:i,toolType:r},!0)}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n){"use strict";n.keyboardTool=function(t){var n={};return{activate:function(n){e(n).off("CornerstoneToolsKeyDown",t),e(n).on("CornerstoneToolsKeyDown",t)},disable:function(n){e(n).off("CornerstoneToolsKeyDown",t)},enable:function(n){e(n).off("CornerstoneToolsKeyDown",t)},deactivate:function(n){e(n).off("CornerstoneToolsKeyDown",t)},getConfiguration:function(){return n},setConfiguration:function(e){n=e}}}}($,cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";var r="length";function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function i(e,o,r){var a={start:t.pixelToCanvas(e,o.handles.start),end:t.pixelToCanvas(e,o.handles.end)};return n.lineSegment.distanceToPoint(a,r)<25}function s(e,n){var a=o.getToolState(e.currentTarget,r);if(void 0!==a){var i,s=n.canvasContext.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0);for(var l=o.toolStyle.getToolWidth(),c=o.textStyle.getFont(),u=o.length.getConfiguration(),d=0;d<a.data.length;d++){s.save(),u&&u.shadow&&(s.shadowColor="#000000",s.shadowOffsetX=1,s.shadowOffsetY=1);var h=a.data[d];i=h.active?o.toolColors.getActiveColor():o.toolColors.getToolColor();var f=t.pixelToCanvas(n.element,h.handles.start),m=t.pixelToCanvas(n.element,h.handles.end);s.beginPath(),s.strokeStyle=i,s.lineWidth=l,s.moveTo(f.x,f.y),s.lineTo(m.x,m.y),s.stroke(),o.drawHandles(s,n,h.handles,i),s.fillStyle=i,s.font=c;var g=" mm";n.image.rowPixelSpacing&&n.image.columnPixelSpacing||(g=" pixels");var p=(h.handles.start.x-h.handles.end.x)*(n.image.columnPixelSpacing||1),v=(h.handles.start.y-h.handles.end.y)*(n.image.rowPixelSpacing||1),y=""+Math.sqrt(p*p+v*v).toFixed(2)+g,w={x:(f.x+m.x)/2+5,y:(f.y+m.y)/2};o.drawTextBox(s,y,w.x,w.y,i),s.restore()}}}o.length=o.mouseButtonTool({createNewMeasurement:a,onImageRendered:s,pointNearTool:i,toolType:r}),o.lengthTouch=o.touchTool({createNewMeasurement:a,onImageRendered:s,pointNearTool:i,toolType:r})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n){"use strict";var o={magnifySize:100,magnificationLevel:2};function r(t,n){e(n.element).off("CornerstoneToolsMouseDrag",i),e(n.element).off("CornerstoneToolsMouseUp",r),function(t){e(t.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}(n)}function a(t,o){if(n.isMouseButtonEnabled(o.which,t.data.mouseButtonMask))return e(o.element).on("CornerstoneToolsMouseDrag",o,i),e(o.element).on("CornerstoneToolsMouseUp",o,r),s(o),!1}function i(e,t){return s(t),!1}function s(o){var r=e(o.element).find(".magnifyTool").get(0);void 0===r&&l(o.element);var a=n.magnify.getConfiguration(),i=a.magnifySize,s=a.magnificationLevel,c=e(o.element).find("canvas").not(".magnifyTool").get(0);c.getContext("2d").setTransform(1,0,0,1,0,0);var u=r.getContext("2d");u.setTransform(1,0,0,1,0,0);var d=t.pixelToCanvas(o.element,o.currentPoints.image);d.x=Math.max(d.x,0),d.x=Math.min(d.x,c.width),d.y=Math.max(d.y,0),d.y=Math.min(d.y,c.height),u.clearRect(0,0,i,i),u.fillStyle="transparent",u.fillRect(0,0,i,i);var h=i*s,f=i/s,m={x:d.x-.5*f,y:d.y-.5*f};u.drawImage(c,m.x,m.y,i,i,0,0,h,h),r.style.top=d.y-.5*i+"px",r.style.left=d.x-.5*i+"px",r.style.display="block",document.body.style.cursor="none"}function l(t){if(0===e(t).find(".magnifyTool").length){var o=document.createElement("canvas");o.classList.add("magnifyTool");var r=n.magnify.getConfiguration();o.width=r.magnifySize,o.height=r.magnifySize,o.style.position="absolute",t.appendChild(o)}}function c(t){e(t).find(".magnifyTool").remove()}function u(t){e(t).off("CornerstoneToolsMouseDown",a),c(t)}function d(e){var t=n.magnify.getConfiguration(t);l(e)}function h(t){e(t).off("CornerstoneToolsTouchDrag",i),e(t).off("CornerstoneToolsDragStart",i),c(t)}n.magnify={enable:d,activate:function(t,n){var o={mouseButtonMask:n};e(t).off("CornerstoneToolsMouseDown",a),e(t).on("CornerstoneToolsMouseDown",o,a),l(t)},deactivate:u,disable:u,getConfiguration:function(){return o},setConfiguration:function(e){o=e}},n.magnifyTouchDrag={enable:d,activate:function(t){e(t).off("CornerstoneToolsTouchDrag",i),e(t).off("CornerstoneToolsDragStart",i),e(t).on("CornerstoneToolsTouchDrag",i),e(t).on("CornerstoneToolsDragStart",i),l(t)},deactivate:h,disable:h}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.orientationMarkers=n.displayTool(function(e,o){var r=o.element,a=function(e){var o=t.getEnabledElement(e),r=n.metaData.get("imagePlane",o.image.imageId);if(r&&r.rowCosines&&r.columnCosines){var a=n.orientation.getOrientationString(r.rowCosines),i=n.orientation.getOrientationString(r.columnCosines),s=n.orientation.invertOrientationString(a);return{top:n.orientation.invertOrientationString(i),bottom:i,left:s,right:a}}}(r);if(a){var i=function(e){var n,o=t.getEnabledElement(e);n={x:o.image.width/2,y:5};var r=t.pixelToCanvas(e,n);n={x:o.image.width/2,y:o.image.height-5};var a=t.pixelToCanvas(e,n);n={x:5,y:o.image.height/2};var i=t.pixelToCanvas(e,n);return n={x:o.image.width-10,y:o.image.height/2},{top:r,bottom:a,left:i,right:t.pixelToCanvas(e,n)}}(r),s=o.canvasContext.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0);var l=n.toolColors.getToolColor(),c=s.measureText(a.top).width,u=s.measureText(a.left).width,d=s.measureText(a.right).width,h=s.measureText(a.bottom).width;n.drawTextBox(s,a.top,i.top.x-c/2,i.top.y,l),n.drawTextBox(s,a.left,i.left.x-u/2,i.left.y,l);var f=n.orientationMarkers.getConfiguration();f&&f.drawAllMarkers&&(n.drawTextBox(s,a.right,i.right.x-d/2,i.right.y,l),n.drawTextBox(s,a.bottom,i.bottom.x-h/2,i.bottom.y,l))}})}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";function o(t,n){e(n.element).off("CornerstoneToolsMouseDrag",r),e(n.element).off("CornerstoneToolsMouseUp",o)}function r(e,n){return n.viewport.translation.x+=n.deltaPoints.page.x/n.viewport.scale,n.viewport.translation.y+=n.deltaPoints.page.y/n.viewport.scale,t.setViewport(n.element,n.viewport),!1}n.pan=n.simpleMouseButtonTool(function(t,a){if(n.isMouseButtonEnabled(a.which,t.data.mouseButtonMask))return e(a.element).on("CornerstoneToolsMouseDrag",r),e(a.element).on("CornerstoneToolsMouseUp",o),!1}),n.panTouchDrag=n.touchDragTool(function(e,n){var o=n;return o.viewport.translation.x+=o.deltaPoints.page.x/o.viewport.scale,o.viewport.translation.y+=o.deltaPoints.page.y/o.viewport.scale,t.setViewport(o.element,o.viewport),!1})}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";function o(e,n){return n.viewport.translation.x+=n.deltaPoints.page.x/n.viewport.scale,n.viewport.translation.y+=n.deltaPoints.page.y/n.viewport.scale,t.setViewport(n.element,n.viewport),!1}n.panMultiTouch={activate:function(t){e(t).off("CornerstoneToolsMultiTouchDrag",o),e(t).on("CornerstoneToolsMultiTouchDrag",o)},disable:function(t){e(t).off("CornerstoneToolsMultiTouchDrag",o)}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";var o="probe";function r(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function a(e,n,o){var r=t.pixelToCanvas(e,n.handles.end);return cornerstoneMath.point.distance(r,o)<5}function i(e,r){var a=n.getToolState(e.currentTarget,o);if(a){var i,s=r.canvasContext.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0);for(var l=n.textStyle.getFont(),c=n.textStyle.getFontSize(),u=0;u<a.data.length;u++){s.save();var d=a.data[u];i=d.active?n.toolColors.getActiveColor():n.toolColors.getToolColor(),n.drawHandles(s,r,d.handles,i);var h=Math.round(d.handles.end.x),f=Math.round(d.handles.end.y),m=t.getStoredPixels(r.element,h,f,1,1)[0],g=m*r.image.slope+r.image.intercept,p=n.calculateSUV(r.image,m),v={x:d.handles.end.x+3,y:d.handles.end.y-3},y=t.pixelToCanvas(r.element,v);s.font=l,s.fillStyle=i;var w=h+", "+f,T="SP: "+m+" MO: "+parseFloat(g.toFixed(3));p&&(T+=" SUV: "+parseFloat(p.toFixed(3))),n.drawTextBox(s,T,y.x,y.y+c+5,i),n.drawTextBox(s,w,y.x,y.y,i),s.restore()}}}n.probe=n.mouseButtonTool({createNewMeasurement:r,onImageRendered:i,pointNearTool:a,toolType:o}),n.probeTouch=n.touchTool({createNewMeasurement:r,onImageRendered:i,pointNearTool:a,toolType:o})}($,cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";var r="rectangleRoi";function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function i(e,o,r){var a=t.pixelToCanvas(e,o.handles.start),i=t.pixelToCanvas(e,o.handles.end),s={left:Math.min(a.x,i.x),top:Math.min(a.y,i.y),width:Math.abs(a.x-i.x),height:Math.abs(a.y-i.y)};return n.rect.distanceToPoint(s,r)<5}function s(e,t){for(var n=0,o=0,r=0,a=0,i=t.top;i<t.top+t.height;i++)for(var s=t.left;s<t.left+t.width;s++)n+=e[a],o+=e[a]*e[a],r++,a++;if(0===r)return{count:r,mean:0,variance:0,stdDev:0};var l=n/r,c=o/r-l*l;return{count:r,mean:l,variance:c,stdDev:Math.sqrt(c)}}function l(e,n){var a=o.getToolState(e.currentTarget,r);if(void 0!==a){var i,l=n.canvasContext.canvas.getContext("2d");l.setTransform(1,0,0,1,0,0);for(var c=o.toolStyle.getToolWidth(),u=o.textStyle.getFont(),d=o.textStyle.getFontSize(),h=0;h<a.data.length;h++){l.save();var f=a.data[h];i=f.active?o.toolColors.getActiveColor():o.toolColors.getToolColor();var m=t.pixelToCanvas(n.element,f.handles.start),g=t.pixelToCanvas(n.element,f.handles.end),p=Math.abs(m.x-g.x),v=Math.abs(m.y-g.y),y=Math.min(m.x,g.x),w=Math.min(m.y,g.y),T=(m.x+g.x)/2,x=(m.y+g.y)/2;l.beginPath(),l.strokeStyle=i,l.lineWidth=c,l.rect(y,w,p,v),l.stroke(),o.drawHandles(l,n,f.handles,i);var b=Math.abs(f.handles.start.x-f.handles.end.x),C=Math.abs(f.handles.start.y-f.handles.end.y),P=Math.min(f.handles.start.x,f.handles.end.x),S=Math.min(f.handles.start.y,f.handles.end.y),M=s(t.getPixels(n.element,P,S,b,C),{left:P,top:S,width:b,height:C}),I=b*n.image.columnPixelSpacing*(C*n.image.rowPixelSpacing),D="Area: "+I.toFixed(2)+" mm^2";l.font=u;var k=l.measureText(I),E=T<n.image.columns/2?T+p/2:T-p/2-k.width,A=x<n.image.rows/2?x+v/2:x-v/2;l.fillStyle=i,o.drawTextBox(l,"Mean: "+M.mean.toFixed(2),E,A-d-5,i),o.drawTextBox(l,"StdDev: "+M.stdDev.toFixed(2),E,A,i),o.drawTextBox(l,D,E,A+d+5,i),l.restore()}}}o.rectangleRoi=o.mouseButtonTool({createNewMeasurement:a,onImageRendered:l,pointNearTool:i,toolType:r}),o.rectangleRoiTouch=o.touchTool({createNewMeasurement:a,onImageRendered:l,pointNearTool:i,toolType:r})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n){"use strict";function o(e){var t=e.element.getBoundingClientRect(e.element),n=e.currentPoints.client.x,o=e.currentPoints.client.y,r=e.element.clientWidth,a=e.element.clientHeight,i={x:n-t.left-r/2,y:-1*(o-t.top-a/2)},s=-1*(Math.atan2(i.y,i.x)*(180/Math.PI))+90;e.viewport.rotation=s}function r(t,n){e(n.element).off("CornerstoneToolsMouseDrag",a),e(n.element).off("CornerstoneToolsMouseUp",r)}function a(e,o){return n.rotate.strategy(o),t.setViewport(o.element,o.viewport),e.stopPropagation(),!1}n.rotate=n.simpleMouseButtonTool(function(t,o){if(n.isMouseButtonEnabled(o.which,t.data.mouseButtonMask))return e(o.element).on("CornerstoneToolsMouseDrag",a),e(o.element).on("CornerstoneToolsMouseUp",r),!1}),n.rotate.strategies={default:o,horizontal:function(e){e.viewport.rotation+=e.deltaPoints.page.x/e.viewport.scale},vertical:function(e){e.viewport.rotation+=e.deltaPoints.page.y/e.viewport.scale}},n.rotate.strategy=o,n.rotateTouchDrag=n.touchDragTool(function(e,o){return n.rotate.strategy(o),t.setViewport(o.element,o.viewport),!1})}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";function o(e,n){return n.viewport.rotation+=n.rotation,t.setViewport(n.element,n.viewport),!1}n.rotateTouch={activate:function(t){e(t).off("CornerstoneToolsTouchRotate",o),e(t).on("CornerstoneToolsTouchRotate",o)},disable:function(t){e(t).off("CornerstoneToolsTouchRotate",o)}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.saveAs=function(t,n){var o=e(t).find("canvas").get(0),r=document.createElement("a");if(r.download=n,r.href=o.toDataURL(),document.createEvent){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(a)}else r.fireEvent&&r.fireEvent("onclick")}}($,cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";var r="simpleAngle";function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1}}}}function i(e,o,r){var a={start:t.pixelToCanvas(e,o.handles.start),end:t.pixelToCanvas(e,o.handles.middle)},i=n.lineSegment.distanceToPoint(a,r);return i<5||(a.start=t.pixelToCanvas(e,o.handles.middle),a.end=t.pixelToCanvas(e,o.handles.end),(i=n.lineSegment.distanceToPoint(a,r))<5)}function s(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function l(e,n){var a=o.getToolState(e.currentTarget,r);if(void 0!==a){var i,l=n.canvasContext.canvas.getContext("2d");l.setTransform(1,0,0,1,0,0);for(var c=o.toolStyle.getToolWidth(),u=o.textStyle.getFont(),d=0;d<a.data.length;d++){l.save();var h=a.data[d];i=h.active?o.toolColors.getActiveColor():o.toolColors.getToolColor(),l.beginPath(),l.strokeStyle=i,l.lineWidth=c;var f=t.pixelToCanvas(n.element,h.handles.start),m=t.pixelToCanvas(n.element,h.handles.middle);l.moveTo(f.x,f.y),l.lineTo(m.x,m.y);var g=t.pixelToCanvas(n.element,h.handles.end);l.lineTo(g.x,g.y),l.stroke(),o.drawHandles(l,n,h.handles),l.fillStyle=i;var p=n.image.columnPixelSpacing||1,v=n.image.rowPixelSpacing||1,y="";n.image.rowPixelSpacing&&n.image.columnPixelSpacing||(y=" (isotropic)");var w={x:(Math.ceil(h.handles.middle.x)-Math.ceil(h.handles.start.x))*p,y:(Math.ceil(h.handles.middle.y)-Math.ceil(h.handles.start.y))*v},T={x:(Math.ceil(h.handles.end.x)-Math.ceil(h.handles.middle.x))*p,y:(Math.ceil(h.handles.end.y)-Math.ceil(h.handles.middle.y))*v},x={x:(Math.ceil(h.handles.end.x)-Math.ceil(h.handles.start.x))*p,y:(Math.ceil(h.handles.end.y)-Math.ceil(h.handles.start.y))*v},b=s(w),C=s(T),P=s(x),S=Math.acos((Math.pow(b,2)+Math.pow(C,2)-Math.pow(P,2))/(2*b*C));S*=180/Math.PI;var M=o.roundToDecimal(S,2);if(M){var I=M.toString()+String.fromCharCode(parseInt("00B0",16))+y,D=m.x+15,k=m.y;l.font=u;var E=l.measureText(I).width;D=m.x-f.x<0?m.x-15-E-10:m.x+15,k=m.y,o.drawTextBox(l,I,D,k,i)}l.restore()}}}o.simpleAngle=o.mouseButtonTool({createNewMeasurement:a,addNewMeasurement:function(n){var i=a(n),s=n.element,l={mouseButtonMask:n.which};o.addToolState(s,r,i),e(s).off("CornerstoneToolsMouseMove",o.simpleAngle.mouseMoveCallback),e(s).off("CornerstoneToolsMouseDrag",o.simpleAngle.mouseMoveCallback),e(s).off("CornerstoneToolsMouseDown",o.simpleAngle.mouseDownCallback),e(s).off("CornerstoneToolsMouseDownActivate",o.simpleAngle.mouseDownActivateCallback),t.updateImage(s),o.moveNewHandle(n,i.handles.middle,function(){i.active=!1,o.anyHandlesOutsideImage(n,i.handles)&&o.removeToolState(s,r,i),i.handles.end.active=!0,t.updateImage(s),o.moveNewHandle(n,i.handles.end,function(){i.active=!1,o.anyHandlesOutsideImage(n,i.handles)&&o.removeToolState(s,r,i),e(s).on("CornerstoneToolsMouseMove",o.simpleAngle.mouseMoveCallback),e(s).on("CornerstoneToolsMouseDrag",o.simpleAngle.mouseMoveCallback),e(s).on("CornerstoneToolsMouseDown",l,o.simpleAngle.mouseDownCallback),e(s).on("CornerstoneToolsMouseDownActivate",l,o.simpleAngle.mouseDownActivateCallback),t.updateImage(s)})})},onImageRendered:l,pointNearTool:i,toolType:r}),o.simpleAngleTouch=o.touchTool({createNewMeasurement:a,addNewMeasurement:function(n){var i=a(n),s=n.element;o.addToolState(s,r,i),e(s).off("CornerstoneToolsTouchDrag",o.simpleAngleTouch.touchMoveCallback),e(s).off("CornerstoneToolsDragStartActive",o.simpleAngleTouch.touchDownActivateCallback),e(s).off("CornerstoneToolsTap",o.simpleAngleTouch.tapCallback),t.updateImage(s),o.moveNewHandleTouch(n,i.handles.middle,function(){i.active=!1,o.anyHandlesOutsideImage(n,i.handles)&&o.removeToolState(s,r,i),i.handles.end.active=!0,t.updateImage(s),o.moveNewHandleTouch(n,i.handles.end,function(){i.active=!1,o.anyHandlesOutsideImage(n,i.handles)&&o.removeToolState(s,r,i),e(s).on("CornerstoneToolsTouchDrag",o.simpleAngleTouch.touchMoveCallback),e(s).on("CornerstoneToolsDragStartActive",o.simpleAngleTouch.touchDownActivateCallback),e(s).on("CornerstoneToolsTap",o.simpleAngleTouch.tapCallback),t.updateImage(s)})})},onImageRendered:l,pointNearTool:i,toolType:r})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n){"use strict";var o="textMarker";function r(e){var t=n.textMarker.getConfiguration();if(t.current){var o={visible:!0,active:!0,text:t.current,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}},r=t.markers.indexOf(t.current);return t.ascending?(r+=1)>=t.markers.length&&(t.loop?r-=t.markers.length:r=-1):(r-=1)<0&&(t.loop?r+=t.markers.length:r=-1),t.current=t.markers[r],o}}function a(e,n,o){var r=t.pixelToCanvas(e,n.handles.end),a={left:r.x-n.textWidth/2,top:r.y,width:n.textWidth,height:n.textHeight};return cornerstoneMath.rect.distanceToPoint(a,o)<10}function i(e,r){var a=n.getToolState(r.element,o);if(a){var i=r.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);for(var s=n.textStyle.getFont(),l=n.textStyle.getFontSize(),c=0;c<a.data.length;c++){var u=a.data[c],d=n.toolColors.getToolColor();u.active&&(d=n.toolColors.getActiveColor()),i.save(),i.font=s,i.fillStyle=d;var h=i.measureText(u.text);u.textWidth=h.width,u.textHeight=l;var f={x:u.handles.end.x-u.textWidth/2,y:u.handles.end.y},m=t.pixelToCanvas(r.element,f);n.drawTextBox(i,u.text,m.x,m.y,d),i.restore()}}}function s(e,r){var i,s=r.element;function l(e,r,a){!0===a?n.removeToolState(s,o,e):e.text=r,e.active=!1,t.updateImage(s)}if(e.data&&e.data.mouseButtonMask&&!n.isMouseButtonEnabled(r.which,e.data.mouseButtonMask))return!1;var c=n.textMarker.getConfiguration(),u=r.currentPoints.canvas,d=n.getToolState(s,o);if(!d)return!1;for(var h=0;h<d.data.length;h++)if(i=d.data[h],a(s,i,u))return i.active=!0,t.updateImage(s),c.changeTextCallback(i,l),e.stopImmediatePropagation(),!1;return!1}n.textMarker=n.mouseButtonTool({createNewMeasurement:r,onImageRendered:i,pointNearTool:a,toolType:o,mouseDoubleClickCallback:s}),n.textMarkerTouch=n.touchTool({createNewMeasurement:r,onImageRendered:i,pointNearTool:a,toolType:o,pressCallback:s})}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";function o(t,n){e(n.element).off("CornerstoneToolsMouseDrag",a),e(n.element).off("CornerstoneToolsMouseUp",o)}function r(e){var t=(e.image.maxPixelValue-e.image.minPixelValue)/1024,n=e.deltaPoints.page.x*t,o=e.deltaPoints.page.y*t;e.viewport.voi.windowWidth+=n,e.viewport.voi.windowCenter+=o}function a(e,o){return n.wwwc.strategy(o),t.setViewport(o.element,o.viewport),!1}n.wwwc=n.simpleMouseButtonTool(function(t,r){if(n.isMouseButtonEnabled(r.which,t.data.mouseButtonMask))return e(r.element).on("CornerstoneToolsMouseDrag",a),e(r.element).on("CornerstoneToolsMouseUp",o),!1}),n.wwwc.strategies={default:r},n.wwwc.strategy=r,n.wwwcTouchDrag=n.touchDragTool(function(e,o){var r=o,a=(r.image.maxPixelValue-r.image.minPixelValue)/1024,i=r.deltaPoints.page.x*a,s=r.deltaPoints.page.y*a,l=n.wwwc.getConfiguration();l.orientation?0===l.orientation?(r.viewport.voi.windowWidth+=i,r.viewport.voi.windowCenter+=s):(r.viewport.voi.windowWidth+=s,r.viewport.voi.windowCenter+=i):(r.viewport.voi.windowWidth+=i,r.viewport.voi.windowCenter+=s),t.setViewport(r.element,r.viewport)})}($,cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";var r="wwwcRegion",a={minWindowWidth:10};function i(t,n){e(n.element).off("CornerstoneToolsMouseMove",d),e(n.element).off("CornerstoneToolsMouseDrag",d),e(n.element).off("CornerstoneToolsMouseUp",i),e(n.element).off("CornerstoneToolsMouseClick",i);var a=o.getToolState(n.element,r);if(a&&a.data.length){var l={x:n.currentPoints.image.x,y:n.currentPoints.image.y};a.data[0].endPoint=l,s(n);var u={mouseButtonMask:n.which};e(n.element).on("CornerstoneToolsMouseDown",u,c)}}function s(e){var n=o.getToolState(e.element,r);if(void 0!==n&&n.data.length){var a=n.data[0].startPoint,i=n.data[0].endPoint,s=Math.abs(a.x-i.x),l=Math.abs(a.y-i.y),c=Math.min(a.x,i.x),u=Math.min(a.y,i.y);c=Math.max(c,0),c=Math.min(c,e.image.width),u=Math.max(u,0),u=Math.min(u,e.image.height),s=Math.floor(Math.min(s,Math.abs(e.image.width-c))),l=Math.floor(Math.min(l,Math.abs(e.image.height-u)));var d=function(e,t,n){var o=e.length;if(o<2)return{min:t,max:n,mean:t};for(var r=n,a=t,i=0,s=0;s<o;s++){var l=e[s];r=Math.min(r,l),a=Math.max(a,l),i+=l}return{min:r,max:a,mean:i/o}}(t.getPixels(e.element,c,u,s,l),e.image.minPixelValue,e.image.maxPixelValue),h=o.wwwcRegion.getConfiguration(),f=t.getViewport(e.element);f.voi.windowWidth=Math.max(Math.abs(d.max-d.min),h.minWindowWidth),f.voi.windowCenter=d.mean,t.setViewport(e.element,f),n.data=[],t.updateImage(e.element)}}function l(t,n){var o=n.element;e(o).off("CornerstoneToolsMouseMove"),e(o).off("CornerstoneToolsMouseDrag"),e(o).on("CornerstoneToolsMouseMove",d),e(o).on("CornerstoneToolsMouseDrag",d),e(o).on("CornerstoneToolsMouseClick",i),"CornerstoneToolsMouseDrag"===t.type&&e(o).on("CornerstoneToolsMouseUp",i)}function c(t,n){if(o.isMouseButtonEnabled(n.which,t.data.mouseButtonMask))return e(n.element).on("CornerstoneToolsMouseDrag",n,l),e(n.element).on("CornerstoneToolsMouseMove",n,l),e(n.element).on("CornerstoneToolsMouseUp",i),e(n.element).off("CornerstoneToolsMouseDown"),u(n),!1}function u(e){var t=o.getToolState(e.element,r);t&&t.data&&(t.data=[]);var n={startPoint:{x:e.currentPoints.image.x,y:e.currentPoints.image.y}};o.addToolState(e.element,r,n)}function d(e,n){var a=o.getToolState(n.element,r);if(void 0!==a&&a.data.length){var i={x:n.currentPoints.image.x,y:n.currentPoints.image.y};a.data[0].endPoint=i,t.updateImage(n.element)}}function h(n,a){var i=o.getToolState(a.element,r);if(void 0!==i&&i.data.length){var s=i.data[0].startPoint,l=i.data[0].endPoint;if(s){var c=e(a.element).find("canvas").get(0).getContext("2d");c.setTransform(1,0,0,1,0,0);var u=o.toolColors.getActiveColor(),d=t.pixelToCanvas(a.element,s),h=t.pixelToCanvas(a.element,l),f=Math.min(d.x,h.x),m=Math.min(d.y,h.y),g=Math.abs(d.x-h.x),p=Math.abs(d.y-h.y),v=o.toolStyle.getToolWidth();c.save(),c.beginPath(),c.strokeStyle=u,c.lineWidth=v,c.rect(f,m,g,p),c.stroke(),c.restore()}}}function f(n){e(n).off("CornerstoneToolsMouseDown",c),e(n).off("CornerstoneImageRendered",h),t.updateImage(n)}function m(t){e(t).off("CornerstoneToolsTouchDrag",d),e(t).off("CornerstoneToolsDragStart",u),e(t).off("CornerstoneToolsDragEnd",s),e(t).off("CornerstoneImageRendered",h)}o.wwwcRegion={activate:function(n,a){var s={mouseButtonMask:a};o.getToolState(n,r)||o.addToolState(n,r,[]);e(n).off("CornerstoneToolsMouseDown",c),e(n).off("CornerstoneToolsMouseUp",i),e(n).off("CornerstoneToolsMouseDrag",d),e(n).off("CornerstoneImageRendered",h),e(n).on("CornerstoneToolsMouseDown",s,c),e(n).on("CornerstoneImageRendered",h),t.updateImage(n)},deactivate:f,disable:f,setConfiguration:function(e){a=e},getConfiguration:function(){return a}},o.wwwcRegionTouch={activate:function(t){void 0===o.getToolState(t,r)&&o.addToolState(t,r,[]);e(t).off("CornerstoneToolsTouchDrag",d),e(t).off("CornerstoneToolsDragStart",u),e(t).off("CornerstoneToolsDragEnd",s),e(t).off("CornerstoneImageRendered",h),e(t).on("CornerstoneToolsTouchDrag",d),e(t).on("CornerstoneToolsDragStart",u),e(t).on("CornerstoneToolsDragEnd",s),e(t).on("CornerstoneImageRendered",h)},deactivate:m,disable:m}}($,cornerstone,0,cornerstoneTools),function(e,t,n){"use strict";var o;function r(e,t){var o=n.zoom.getConfiguration(),r=Math.log(e.scale)/Math.log(1.7)+t,a=Math.pow(1.7,r);return e.scale=a,o.maxScale&&a>o.maxScale?e.scale=o.maxScale:o.minScale&&a<o.minScale&&(e.scale=o.minScale),e}function a(e,t,n){return e.x=Math.max(e.x,0),e.y=Math.max(e.y,0),e.x=Math.min(e.x,t),e.y=Math.min(e.y,n),e}function i(e,t){if(0!==t.rotation){var n=t.rotation*Math.PI/180,o=Math.cos(n),r=Math.sin(n),a=e.x*o-e.y*r,i=e.x*r+e.y*o;e.x=a,e.y=i}return t.hflip&&(e.x*=-1),t.vflip&&(e.y*=-1),e}function s(e,n){var o=e.element,a=r(e.viewport,n);t.setViewport(o,a);var s=t.pageToPixel(o,e.startPoints.page.x,e.startPoints.page.y),l={x:e.startPoints.image.x-s.x,y:e.startPoints.image.y-s.y};l=i(l,a),a.translation.x-=l.x,a.translation.y-=l.y,t.setViewport(o,a)}function l(t,n){e(n.element).off("CornerstoneToolsMouseDrag",c),e(n.element).off("CornerstoneToolsMouseUp",l)}function c(e,t){if(!t.deltaPoints.page.y)return!1;var o=t.deltaPoints.page.y/100;return n.zoom.strategy(t,o),!1}n.zoom=n.simpleMouseButtonTool(function(t,r){if(n.isMouseButtonEnabled(r.which,t.data.mouseButtonMask))return o=r.startPoints,e(r.element).on("CornerstoneToolsMouseDrag",c),e(r.element).on("CornerstoneToolsMouseUp",l),!1}),n.zoom.strategies={default:s,translate:function(e,s){var l=e.element,c=e.image,u=r(e.viewport,s);t.setViewport(l,u);var d,h,f=n.zoom.getConfiguration();if(s<0){if(d={x:u.scale<3?u.translation.x/8:0,y:u.scale<3?u.translation.y/8:0},Math.abs(u.translation.x)<.01)u.translation.x=0,d.x=0;else if(Math.abs(u.translation.y)<.01)u.translation.y=0,d.y=0;else if(Math.abs(u.translation.x)<.01&&Math.abs(u.translation.y)<.01)return t.setViewport(l,u),!1}else{h=t.pageToPixel(l,o.page.x,o.page.y),f&&f.preventZoomOutsideImage&&(o.image=a(o.image,c.width,c.height),h=a(h,c.width,c.height));var m={x:c.width/2-o.image.x,y:c.height/2-o.image.y},g={x:u.translation.x-m.x,y:u.translation.y-m.y};if(d={x:g.x/8,y:g.y/8},Math.abs(g.x)<.01)u.translation.x=m.x,d.x=0;else if(Math.abs(g.y)<.01)u.translation.y=m.y,d.y=0;else if(Math.abs(g.x)<.01&&Math.abs(g.y)<.01)return t.setViewport(l,u),!1}if(!(d=i(d,u)).x&&!d.y)return!1;u.translation.x-=d.x,u.translation.y-=d.y,t.setViewport(l,u)}},n.zoom.strategy=s,n.zoomWheel=n.mouseWheelTool(function(e,n){var o=-n.direction/4,a=r(n.viewport,o);t.setViewport(n.element,a)}),n.zoomTouchPinch=n.touchPinchTool(function(e,n){var o=n.direction/4,a=r(n.viewport,o);t.setViewport(n.element,a)}),n.zoomTouchDrag=n.touchDragTool(c)}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";var o,r;function a(n){var a=n.currentTarget,i=t.pageToPixel(a,o,r);n=window.event||n;var s={element:a,viewport:t.getViewport(a),image:t.getEnabledElement(a).image,pageX:o,pageY:r,imageX:i.x,imageY:i.y,keyCode:n.keyCode,which:n.which};"keydown"===n.type?e(a).trigger("CornerstoneToolsKeyDown",s):"keypress"===n.type?e(a).trigger("CornerstoneToolsKeyPress",s):"keyup"===n.type&&e(a).trigger("CornerstoneToolsKeyUp",s)}function i(e){o=e.pageX||e.originalEvent.pageX,r=e.pageY||e.originalEvent.pageY}var s="keydown keypress keyup";n.keyboardInput={enable:function(t){e(t).bind(s,a),e(t).on("mousemove",i)},disable:function(t){e(t).unbind(s,a)}}}($,cornerstone,cornerstoneTools),function(e){"use strict";var t=2e3,n={mouse:0,touch:1};e.preventGhostClick=function(e){var o,r;function a(n,a){n.forEach(function(n){e.addEventListener(n,function(e,n){var a=Date.now();if(e!==o){if(a-r<=t)return n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!1;o=e}r=a}.bind(null,a),!0)})}a(["mousedown","mouseup","mousemove"],n.mouse),a(["touchstart","touchend"],n.touch)}}(cornerstoneTools),function(e,t,n,o){"use strict";o.anyHandlesOutsideImage=function(e,t){var o=e.image,r={left:0,top:0,width:o.width,height:o.height},a=!1;return Object.keys(t).forEach(function(e){var o=t[e];!1===n.point.insideRect(o,r)&&(a=!0)}),a}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t){"use strict";var n=6;t.drawHandles=function(o,r,a,i,s){o.strokeStyle=i,Object.keys(a).forEach(function(i){var l=a[i];o.beginPath(),l.active?o.lineWidth=t.toolStyle.getActiveWidth():o.lineWidth=t.toolStyle.getToolWidth();var c=e.pixelToCanvas(r.element,l);o.arc(c.x,c.y,n,0,2*Math.PI),s&&(o.fillStyle=s,o.fill()),o.stroke()})}}(cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";o.getHandleNearImagePoint=function(e,o,r,a){var i;if(o.handles)return Object.keys(o.handles).forEach(function(s){var l=o.handles[s],c=t.pixelToCanvas(e,l);n.point.distanceSquared(c,r)<a&&(i=l)}),i}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n,o){"use strict";o.handleActivator=function(e,o,r){var a=function(e){var t;return Object.keys(e).forEach(function(n){var o=e[n];!0!==o.active||(t=o)}),t}(o),i=function(e,o,r){var a;return Object.keys(o).forEach(function(i){var s=o[i],l=t.pixelToCanvas(e,s);n.point.distance(l,r)<=36&&(a=s)}),a}(e,o,r);return a!==i&&(void 0!==i&&(i.active=!0),void 0!==a&&(a.active=!1),!0)}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n){"use strict";n.moveHandle=function(n,o,r,a){var i=n.element;function s(e,n){o.active=!0,o.x=n.currentPoints.image.x,o.y=n.currentPoints.image.y,a&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,n.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,n.image.height)),t.updateImage(i)}e(i).on("CornerstoneToolsMouseDrag",s),e(i).on("CornerstoneToolsMouseUp",function n(){o.active=!1,e(i).off("CornerstoneToolsMouseDrag",s),e(i).off("CornerstoneToolsMouseUp",n),t.updateImage(i),r()})}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.touchMoveHandle=function(n,o,r){var a=n.element;function i(e,n){o.active=!0;var r=n;o.x=r.currentPoints.image.x,o.y=r.currentPoints.image.y,t.updateImage(a)}function s(){o.active=!1,e(a).off("CornerstoneToolsTouchDrag",i),e(a).off("CornerstoneToolsDragEnd",s),e(a).off("CornerstoneToolsTap",s),t.updateImage(a),r()}e(a).on("CornerstoneToolsTouchDrag",i),e(a).on("CornerstoneToolsDragEnd",s),e(a).on("CornerstoneToolsTap",s)}}($,cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";o.moveAllHandles=function(o,r,a,i,s){var l=o.element;function c(e,n){return r.active=!0,Object.keys(r.handles).forEach(function(e){var t=r.handles[e];t.x+=n.deltaPoints.image.x,t.y+=n.deltaPoints.image.y,s&&(t.x=Math.max(t.x,0),t.x=Math.min(t.x,n.image.width),t.y=Math.max(t.y,0),t.y=Math.min(t.y,n.image.height))}),t.updateImage(l),!1}return e(l).on("CornerstoneToolsMouseDrag",c),e(l).on("CornerstoneToolsMouseUp",function o(s,u){if(r.active=!1,r.invalidated=!0,e(l).off("CornerstoneToolsMouseDrag",c),e(l).off("CornerstoneToolsMouseUp",o),!0===i){var d=u.image,h=!1,f={top:0,left:0,width:d.width,height:d.height};if(Object.keys(r.handles).forEach(function(e){var t=r.handles[e];t.active=!1,!1!==n.point.insideRect(t,f)||(h=!0)}),h){var m=-1;a.data.forEach(function(e,t){e!==r||(m=t)}),-1!==m&&a.data.splice(m,1)}}t.updateImage(l)}),!0}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t,n){"use strict";n.moveNewHandle=function(n,o,r,a){var i=n.element;function s(e,n){o.active=!0,o.x=n.currentPoints.image.x,o.y=n.currentPoints.image.y,a&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,n.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,n.image.height)),t.updateImage(i)}function l(t){e(i).off("CornerstoneToolsMouseMove"),e(i).off("CornerstoneToolsMouseDrag"),e(i).on("CornerstoneToolsMouseMove",s),e(i).on("CornerstoneToolsMouseDrag",s),e(i).on("CornerstoneToolsMouseClick",c),"CornerstoneToolsMouseDrag"===t.type&&e(i).on("CornerstoneToolsMouseUp",c)}function c(){e(i).off("CornerstoneToolsMouseMove",s),e(i).off("CornerstoneToolsMouseDrag",s),e(i).off("CornerstoneToolsMouseClick",c),e(i).off("CornerstoneToolsMouseUp",c),o.active=!1,t.updateImage(i),r()}e(i).on("CornerstoneToolsMouseDrag",l),e(i).on("CornerstoneToolsMouseMove",l)}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.moveNewHandleTouch=function(n,o,r,a){var i=n.element;function s(e,n){o.active=!0,o.x=n.currentPoints.image.x,o.y=n.currentPoints.image.y,a&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,n.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,n.image.height)),t.updateImage(i)}function l(n,c){e(i).off("CornerstoneToolsTouchDrag",s),e(i).off("CornerstoneToolsTap",l),e(i).off("CornerstoneToolsDragEnd",l),o.active=!1,o.x=c.currentPoints.image.x,o.y=c.currentPoints.image.y,a&&(o.x=Math.max(o.x,0),o.x=Math.min(o.x,c.image.width),o.y=Math.max(o.y,0),o.y=Math.min(o.y,c.image.height)),t.updateImage(i),r()}e(i).on("CornerstoneToolsTouchDrag",s),e(i).on("CornerstoneToolsDragEnd",l),e(i).on("CornerstoneToolsTap",l)}}($,cornerstone,cornerstoneTools),function(e,t,n,o){"use strict";o.touchMoveAllHandles=function(o,r,a,i,s){var l=o.element;function c(e,n){return r.active=!0,Object.keys(r.handles).forEach(function(e){var t=r.handles[e];t.x+=n.deltaPoints.image.x,t.y+=n.deltaPoints.image.y}),t.updateImage(l),!1}function u(o,d){if(r.active=!1,r.invalidated=!1,e(l).off("CornerstoneToolsTouchDrag",c),e(l).off("CornerstoneToolsDragEnd",u),e(l).off("CornerstoneToolsTap",u),!0===i){var h=d.image,f=!1,m={top:0,left:0,width:h.width,height:h.height};if(Object.keys(r.handles).forEach(function(e){var t=r.handles[e];!1!==n.point.insideRect(t,m)||(f=!0)}),f){for(var g=-1,p=0;p<a.data.length;p++)a.data[p]===r&&(g=p);-1!==g&&a.data.splice(g,1)}}s(),t.updateImage(l)}return e(l).on("CornerstoneToolsTouchDrag",c),e(l).on("CornerstoneToolsDragEnd",u),e(l).on("CornerstoneToolsTap",u),!0}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e,t){"use strict";t.LineSampleMeasurement=function(){var t=this;t.samples=[],this.set=function(n){t.samples=n,e(t).trigger("CornerstoneLineSampleUpdated")}}}($,cornerstoneTools),function(e,t){"use strict";t.MeasurementManager=new function(){var t=this;t.measurements=[],this.add=function(n){var o={index:t.measurements.push(n),measurement:n};e(t).trigger("CornerstoneMeasurementAdded",o)},this.remove=function(n){var o=t.measurements[n];t.measurements.splice(n,1);var r={index:n,measurement:o};e(t).trigger("CornerstoneMeasurementRemoved",r)}}}($,cornerstoneTools),function(e,t,n){"use strict";var o=[];n.metaData={addProvider:function(e){o.push(e)},removeProvider:function(e){var t=o.indexOf(e);-1!==t&&o.splice(t,1)},get:function(t,n){var r;return e.each(o,function(e,o){if(void 0!==(r=o(t,n)))return!0}),r}}}($,cornerstone,cornerstoneTools),function(e,t){"use strict";t.orientation.getOrientationString=function(t){for(var n="",o=t.x<0?"R":"L",r=t.y<0?"A":"P",a=t.z<0?"F":"H",i=new e.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),s=0;s<3;s++)if(i.x>1e-4&&i.x>i.y&&i.x>i.z)n+=o,i.x=0;else if(i.y>1e-4&&i.y>i.x&&i.y>i.z)n+=r,i.y=0;else{if(!(i.z>1e-4&&i.z>i.x&&i.z>i.y))break;n+=a,i.z=0}return n}}(cornerstoneMath,cornerstoneTools),function(e){"use strict";e.orientation.invertOrientationString=function(e){var t=e.replace("H","f");return t=(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}}(cornerstoneTools),function(e){"use strict";e.referenceLines.calculateReferenceLine=function(t,n){var o=e.planePlaneIntersection(t,n);if(o)return{start:e.projectPatientPointToImagePlane(o.start,t),end:e.projectPatientPointToImagePlane(o.end,t)}}}(cornerstoneTools),function(e,t,n){"use strict";var o="referenceLines";function r(r,a){var i=n.getToolState(r.currentTarget,o);if(void 0!==i){var s=i.data[0].synchronizationContext.getSourceElements(),l=i.data[0].renderer,c=a.canvasContext.canvas.getContext("2d");t.setToPixelCoordinateSystem(a.enabledElement,c),e.each(s,function(e,t){t!==r.currentTarget&&l(c,a,r.currentTarget,t)})}}n.referenceLines.tool={enable:function(a,i,s){s=s||n.referenceLines.renderActiveReferenceLine,n.addToolState(a,o,{synchronizationContext:i,renderer:s}),e(a).on("CornerstoneImageRendered",r),t.updateImage(a)},disable:function(n){e(n).off("CornerstoneImageRendered",r),t.updateImage(n)}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.referenceLines.renderActiveReferenceLine=function(e,o,r,a){var i=t.getEnabledElement(r).image,s=t.getEnabledElement(a).image;if(i&&s){var l=n.metaData.get("imagePlane",i.imageId),c=n.metaData.get("imagePlane",s.imageId);if(l.frameOfReferenceUID===c.frameOfReferenceUID){var u=l.rowCosines.clone().cross(l.columnCosines),d=c.rowCosines.clone().cross(c.columnCosines),h=u.angleTo(d);if(!((h=Math.abs(h))<.5)){var f=n.referenceLines.calculateReferenceLine(l,c);if(f){var m=t.pixelToCanvas(o.element,f.start),g=t.pixelToCanvas(o.element,f.end),p=n.toolColors.getActiveColor(),v=n.toolStyle.getToolWidth();e.setTransform(1,0,0,1,0,0),e.save(),e.beginPath(),e.strokeStyle=p,e.lineWidth=v,e.moveTo(m.x,m.y),e.lineTo(g.x,g.y),e.stroke(),e.restore()}}}}}}($,cornerstone,cornerstoneTools),function(e,t){"use strict";var n={interaction:[],thumbnail:[],prefetch:[]},o={interaction:0,thumbnail:0,prefetch:0},r={interaction:6,thumbnail:6,prefetch:5},a=!1,i=20;t.requestPoolManager=function(){function s(){a&&setTimeout(function(){var e=c();e?l(e):a=!1},i)}function l(t){var n=t.type;o[n]++,a=!0;var r=t.imageId,i=t.doneCallback,l=t.failCallback,c=e.imageCache.getImagePromise(r);c?c.then(function(e){o[n]--,i(e),s()},function(e){o[n]--,l(e)}):e.loadAndCacheImage(r).then(function(e){o[n]--,i(e),s()},function(e){o[n]--,l(e)})}function c(){return n.interaction.length&&o.interaction<r.interaction?n.interaction.shift():n.thumbnail.length&&o.thumbnail<r.thumbnail?n.thumbnail.shift():n.prefetch.length&&o.prefetch<r.prefetch?n.prefetch.shift():(n.interaction.length||n.thumbnail.length||n.prefetch.length||(a=!1),!1)}return{addRequest:function(t,o,r,a,i){if(!n.hasOwnProperty(r))throw"Request type must be one of interaction, thumbnail, or prefetch";if(t&&o){var s={type:r,imageId:o,doneCallback:a,failCallback:i},l=e.imageCache.getImagePromise(o);l?l.then(function(e){a(e)},function(e){i(e)}):(n[r].push(s),"interaction"===r&&t)}},clearRequestStack:function(e){if(!n.hasOwnProperty(e))throw"Request type must be one of interaction, thumbnail, or prefetch";n[e]=[]},startGrabbing:function(){if(!a){var e=t.getMaxSimultaneousRequests();r={interaction:e,thumbnail:e-2,prefetch:e-1};for(var n=0;n<e;n++){var o=c();o&&l(o)}}},getRequestPool:function(){return n}}}()}(cornerstone,cornerstoneTools),function(e,t,n){"use strict";var o="playClip";n.playClip=function(r,a){if(void 0===r)throw"playClip: element must not be undefined";void 0===a&&(a=30);var i=n.getToolState(r,"stack");if(void 0!==i&&void 0!==i.data&&0!==i.data.length){var s,l=i.data[0],c=n.getToolState(r,o);void 0===c||0===c.data.length?(s={intervalId:void 0,framesPerSecond:a,lastFrameTimeStamp:void 0,frameRate:0,loop:!0},n.addToolState(r,o,s)):(s=c.data[0]).framesPerSecond=a,void 0===s.intervalId&&(s.intervalId=setInterval(function(){var o=l.currentImageIdIndex;if(s.framesPerSecond>0?o++:o--,!s.loop&&(o>=l.imageIds.length||o<0)){var a={element:r},i=e.Event("CornerstoneToolsClipStopped",a);return e(r).trigger(i,a),clearInterval(s.intervalId),void(s.intervalId=void 0)}if(o>=l.imageIds.length&&(o=0),o<0&&(o=l.imageIds.length-1),o!==l.currentImageIdIndex){var c=n.loadHandlerManager.getStartLoadHandler(),u=n.loadHandlerManager.getEndLoadHandler(),d=n.loadHandlerManager.getErrorLoadingHandler();c&&c(r);var h=t.getViewport(r);t.loadAndCacheImage(l.imageIds[o]).then(function(e){l.currentImageIdIndex=o,t.displayImage(r,e,h),u&&u(r)},function(e){var t=l.imageIds[o];d&&d(r,t,e)})}},1e3/Math.abs(s.framesPerSecond)))}},n.stopClip=function(e){var t,r=n.getToolState(e,o);void 0!==r&&0!==r.data.length&&(t=r.data[0],clearInterval(t.intervalId),t.intervalId=void 0)}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";var o=6;n.scrollIndicator=n.displayTool(function(e,t){var r=t.element,a=t.enabledElement.canvas.width,i=t.enabledElement.canvas.height;if(!a||!i)return!1;var s=t.enabledElement.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0),s.save();var l=n.scrollIndicator.getConfiguration();s.fillStyle=l.backgroundColor,s.fillRect(0,i-o,a,o);var c=n.getToolState(r,"stack");if(c&&c.data&&c.data.length){var u=c.data[0].imageIds,d=c.data[0].currentImageIdIndex,h=a/u.length,f=h*d;s.fillStyle=l.fillColor,s.fillRect(f,i-o,h,o),s.restore()}}),n.scrollIndicator.setConfiguration({backgroundColor:"rgb(19, 63, 141)",fillColor:"white"})}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";var o,r,a="stackPrefetch",i="prefetch",s={};function l(e,t){return e-t}var c=function(e){return Math.max.apply(null,e)},u=function(e){return Math.min.apply(null,e)};function d(e){var o=n.getToolState(e,"stack");if(o&&o.data&&o.data.length){var r=o.data[0],s=n.getToolState(e,a);if(s){var d=s.data[0];if(d&&d.indicesToRequest&&d.indicesToRequest.length||(d.enabled=!1),!1!==d.enabled)if(s.data[0].indicesToRequest.sort(l),d.indicesToRequest.slice().forEach(function(e){var n=r.imageIds[e];if(n){var o=t.imageCache.getImagePromise(n);o&&"resolved"===o.state()&&b(e)}}),d.indicesToRequest.length){var h=n.requestPoolManager;h.clearRequestStack(i);for(var f,m,g,p,v,y,w=(f=d.indicesToRequest,m=r.currentImageIdIndex,g=[],p=[],f.forEach(function(e){e<m?g.push(e):e>m&&p.push(e)}),{low:f.indexOf(c(g)),high:f.indexOf(u(p))}),T=w.low,x=w.high;T>0||x<d.indicesToRequest.length;)T>=0&&(y=d.indicesToRequest[T--],v=r.imageIds[y],h.addRequest(e,v,i,C,P)),x<d.indicesToRequest.length&&(y=d.indicesToRequest[x++],v=r.imageIds[y],h.addRequest(e,v,i,C,P));h.startGrabbing()}}}function b(e){var t=d.indicesToRequest.indexOf(e);t>-1&&d.indicesToRequest.splice(t,1)}function C(e){b(r.imageIds.indexOf(e.imageId))}function P(e){console.log("prefetch errored: "+e)}}function h(e){var t=e.data.element,o=n.getToolState(t,a);o&&o.data&&o.data.length&&n.requestPoolManager.clearRequestStack(i)}function f(e,t){var o=e.data.element,r=n.getToolState(o,"stack");if(r&&r.data&&r.data.length){var i=r.data[0].imageIds.indexOf(t.imageId);if(!(i<0)){var s=n.getToolState(o,a);s&&s.data&&s.data.length&&s.data[0].indicesToRequest.push(i)}}}function m(e){clearTimeout(o),o=setTimeout(function(){d(e.currentTarget)},r)}n.stackPrefetch={enable:function(o){n.getToolState(o,a).data=[];var r=n.getToolState(o,"stack");if(r&&r.data&&r.data.length){var i=r.data[0],s={indicesToRequest:function(e,t){e=Math.round(e)||0;var n=[],o=(t=Math.round(t)||0)-e+1;if(o<=0)return n;for(;o--;)n[o]=t--;return n}(0,i.imageIds.length-1),enabled:!0,direction:1},l=s.indicesToRequest.indexOf(i.currentImageIdIndex);s.indicesToRequest.splice(l,1),n.addToolState(o,a,s),d(o),e(o).off("CornerstoneNewImage",m),e(o).on("CornerstoneNewImage",m),e(t).off("CornerstoneImageCacheFull",h),e(t).on("CornerstoneImageCacheFull",{element:o},h),e(t).off("CornerstoneImageCachePromiseRemoved",f),e(t).on("CornerstoneImageCachePromiseRemoved",{element:o},f)}},disable:function(o){e(o).off("CornerstoneNewImage",m),e(t).off("CornerstoneImageCacheFull",h),e(t).off("CornerstoneImageCachePromiseRemoved",f);var r=n.getToolState(o,a);r&&r.data.length&&(r.data[0].enabled=!1,n.requestPoolManager.clearRequestStack(i))},getConfiguration:function(){return s},setConfiguration:function(e){s=e}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";function o(t,n){e(n.element).off("CornerstoneToolsMouseDrag",r),e(n.element).off("CornerstoneToolsMouseUp",o)}function r(t,o){t.data.deltaY+=o.deltaPoints.page.y;var r=o.element,a=n.getToolState(o.element,"stack");if(void 0!==a&&void 0!==a.data&&0!==a.data.length){var i=a.data[0],s=e(o.element).height()/Math.max(i.imageIds.length,8);if(void 0!==t.data.options&&void 0!==t.data.options.stackScrollSpeed&&(s=t.data.options.stackScrollSpeed),t.data.deltaY>=s||t.data.deltaY<=-s){var l=t.data.deltaY/s,c=t.data.deltaY%s,u=Math.round(l);t.data.deltaY=c,n.scroll(r,u)}return!1}}n.stackScroll=n.simpleMouseButtonTool(function(t,a){if(n.isMouseButtonEnabled(a.which,t.data.mouseButtonMask)){var i={deltaY:0,options:t.data.options};return e(a.element).on("CornerstoneToolsMouseDrag",i,r),e(a.element).on("CornerstoneToolsMouseUp",o),t.stopImmediatePropagation(),!1}}),n.stackScrollWheel=n.mouseWheelTool(function(e,t){var o=-t.direction;n.scroll(t.element,o)}),n.stackScrollTouchDrag=n.touchDragTool(function(e,t){var o=t.element;t.deltaY=t.deltaY||0,t.deltaY+=t.deltaPoints.page.y;var r=n.getToolState(t.element,"stack");if(void 0!==r&&void 0!==r.data&&0!==r.data.length){if(t.deltaY>=3||t.deltaY<=-3){var a=t.deltaY/3,i=t.deltaY%3,s=Math.round(a);t.deltaY=i,n.scroll(o,s)}return!1}})}($,cornerstone,cornerstoneTools),function(e){"use strict";var t={UP:38,DOWN:40};e.stackScrollKeyboard=e.keyboardTool(function(n,o){var r=o.keyCode;if(r===t.UP||r===t.DOWN){var a=1;r===t.DOWN&&(a=-1),e.scroll(o.element,a)}})}(cornerstoneTools),function(e,t,n){"use strict";n.appState={save:function(e){var o={imageIdToolState:n.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return e.forEach(function(e){var r=n.getElementToolStateManager(e);r!==n.globalImageIdSpecificToolStateManager&&(o.elementToolState[e.id]=r.saveToolState(),o.elementViewport[e.id]=t.getViewport(e))}),o},restore:function(e){if(e.hasOwnProperty("imageIdToolState")&&e.hasOwnProperty("elementToolState")&&e.hasOwnProperty("elementViewport"))return n.globalImageIdSpecificToolStateManager.restoreToolState(e.imageIdToolState),Object.keys(e.elementViewport).forEach(function(o){var r=document.getElementById(o);if(r&&e.elementToolState.hasOwnProperty(o)){var a=n.getElementToolStateManager(r);if(a!==n.globalImageIdSpecificToolStateManager){a.restoreToolState(e.elementToolState[o]);var i=e.elementViewport[o];t.setViewport(r,i),t.updateImage(r)}}}),e}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";function o(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n))return o[n]}},add:function(t,n,o){!1===e.hasOwnProperty(t)&&(e[t]={});var r=e[t];!1===r.hasOwnProperty(n)&&(r[n]={data:[]}),r[n].data.push(o)},remove:function(t,n,o){if(!1!==e.hasOwnProperty(t)){var r=e[t];if(!1!==r.hasOwnProperty(n)){for(var a=r[n],i=-1,s=0;s<a.data.length;s++)a.data[s]===o&&(i=s);-1!==i&&a.data.splice(i,1)}}}}}var r=o();n.newFrameOfReferenceSpecificToolStateManager=o,n.globalFrameOfReferenceSpecificToolStateManager=r}($,cornerstone,cornerstoneTools),function(e,t){"use strict";function n(){var t={};return{get:function(n,o){var r=e.getEnabledElement(n);if(r.image&&!1!==t.hasOwnProperty(r.image.imageId)){var a=t[r.image.imageId];if(!1!==a.hasOwnProperty(o))return a[o]}},add:function(n,o,r){var a=e.getEnabledElement(n);a.image&&!1!==t.hasOwnProperty(a.image.imageId)||(t[a.image.imageId]={});var i=t[a.image.imageId];!1===i.hasOwnProperty(o)&&(i[o]={data:[]}),i[o].data.push(r)},clear:function(n){var o=e.getEnabledElement(n);o.image&&!1!==t.hasOwnProperty(o.image.imageId)&&delete t[o.image.imageId]},saveImageIdToolState:function(e){return t[e]},restoreImageIdToolState:function(e,n){t[e]=n},saveToolState:function(){return t},restoreToolState:function(e){t=e},toolState:t}}var o=n();t.newImageIdSpecificToolStateManager=n,t.globalImageIdSpecificToolStateManager=o}(cornerstone,cornerstoneTools),function(e){"use strict";var t,n,o;e.loadHandlerManager={setStartLoadHandler:function(e){t=e},getStartLoadHandler:function(){return t},setEndLoadHandler:function(e){n=e},getEndLoadHandler:function(){return n},setErrorLoadingHandler:function(e){o=e},getErrorLoadingHandler:function(){return o}}}(cornerstoneTools),function(e,t){"use strict";var n=[];t.newStackSpecificToolStateManager=function(e,t){var n={};return{get:function(o,r){return e.indexOf(r)>=0?(!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r]):t.get(o,r)},add:function(o,r,a){if(!(e.indexOf(r)>=0))return t.add(o,r,a);!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r].data.push(a)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}},t.addStackStateManager=function(e){var o=t.getElementToolStateManager(e);o||(o=t.globalImageIdSpecificToolStateManager);var r=t.newStackSpecificToolStateManager(["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs"],o);n.push(r),t.setElementToolStateManager(e,r)}}(cornerstone,cornerstoneTools),function(e){"use strict";var t,n,o;e.textStyle=(n=(t=15)+"px Arial",o="transparent",{setFont:function(e){n=e},getFont:function(){return n},setFontSize:function(e){t=e},getFontSize:function(){return t},setBackgroundColor:function(e){o=e},getBackgroundColor:function(){return o}})}(cornerstoneTools),function(e,t){"use strict";var n=[];t.newTimeSeriesSpecificToolStateManager=function(e,t){var n={};return{get:function(o,r){return e.indexOf(r)>=0?(!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r]):t.get(o,r)},add:function(o,r,a){if(!(e.indexOf(r)>=0))return t.add(o,r,a);!1===n.hasOwnProperty(r)&&(n[r]={data:[]}),n[r].data.push(a)}}},t.addTimeSeriesStateManager=function(e,o){o=o||["timeSeries"];var r=t.getElementToolStateManager(e);void 0===r&&(r=t.globalImageIdSpecificToolStateManager);var a=t.newTimeSeriesSpecificToolStateManager(o,r);n.push(a),t.setElementToolStateManager(e,a)}}(cornerstone,cornerstoneTools),function(e){"use strict";var t,n,o;e.toolColors=(t="white",n="greenyellow",o="transparent",{setFillColor:function(e){o=e},getFillColor:function(){return o},setToolColor:function(e){t=e},getToolColor:function(){return t},setActiveColor:function(e){n=e},getActiveColor:function(){return n}})}(cornerstoneTools),function(e){"use strict";var t;e.toolCoordinates=(t="",{setCoords:function(e){t=e.currentPoints.canvas},getCoords:function(){return t}})}(cornerstoneTools),function(e,t){"use strict";function n(n){var o=e.getEnabledElement(n);return void 0===o.toolStateManager&&(o.toolStateManager=t.globalImageIdSpecificToolStateManager),o.toolStateManager}t.addToolState=function(e,t,o){n(e).add(e,t,o)},t.getToolState=function(e,t){return n(e).get(e,t)},t.removeToolState=function(e,t,o){for(var r=n(e).get(e,t),a=-1,i=0;i<r.data.length;i++)r.data[i]===o&&(a=i);-1!==a&&r.data.splice(a,1)},t.clearToolState=function(e,t){var o=n(e).get(e,t);void 0!==o&&(o.data=[])},t.setElementToolStateManager=function(t,n){e.getEnabledElement(t).toolStateManager=n},t.getElementToolStateManager=n}(cornerstone,cornerstoneTools),function(e){"use strict";var t,n;e.toolStyle=(t=1,n=2,{setToolWidth:function(e){t=e},getToolWidth:function(){return t},setActiveWidth:function(e){n=e},getActiveWidth:function(){return n}})}(cornerstoneTools),function(e,t,n){"use strict";n.panZoomSynchronizer=function(e,n,o){if(o!==n){var r=t.getViewport(n),a=t.getViewport(o);a.scale===r.scale&&a.translation.x===r.translation.x&&a.translation.y===r.translation.y||(a.scale=r.scale,a.translation.x=r.translation.x,a.translation.y=r.translation.y,e.setViewport(o,a))}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.stackImageIndexSynchronizer=function(e,o,r){if(r!==o){var a=n.getToolState(o,"stack").data[0],i=n.getToolState(r,"stack").data[0],s=a.currentImageIdIndex;if((s=Math.min(Math.max(s,0),i.imageIds.length-1))!==i.currentImageIdIndex){var l=n.loadHandlerManager.getStartLoadHandler(),c=n.loadHandlerManager.getEndLoadHandler(),u=n.loadHandlerManager.getErrorLoadingHandler();l&&l(r),t.loadAndCacheImage(i.imageIds[s]).then(function(n){var o=t.getViewport(r);i.currentImageIdIndex=s,e.displayImage(r,n,o),c&&c(r)},function(e){var t=i.imageIds[s];u&&u(r,t,e)})}}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.stackImagePositionSynchronizer=function(o,r,a){if(a!==r){var i=t.getEnabledElement(r).image,s=n.metaData.get("imagePlane",i.imageId).imagePositionPatient,l=n.getToolState(a,"stack").data[0],c=Number.MAX_VALUE,u=-1;if(e.each(l.imageIds,function(e,t){var o=n.metaData.get("imagePlane",t).imagePositionPatient.distanceToSquared(s);o<c&&(c=o,u=e)}),u!==l.currentImageIdIndex){var d=n.loadHandlerManager.getStartLoadHandler(),h=n.loadHandlerManager.getEndLoadHandler(),f=n.loadHandlerManager.getErrorLoadingHandler();d&&d(a),-1!==u&&t.loadAndCacheImage(l.imageIds[u]).then(function(e){var n=t.getViewport(a);l.currentImageIdIndex=u,o.displayImage(a,e,n),h&&h(a)},function(e){var t=l.imageIds[u];f&&f(a,t,e)})}}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.stackScrollSynchronizer=function(e,o,r,a){if(o!==r&&a&&a.direction){var i=n.getToolState(r,"stack").data[0],s=i.currentImageIdIndex+a.direction;if(s=Math.min(Math.max(s,0),i.imageIds.length-1),i.currentImageIdIndex!==s){var l=n.loadHandlerManager.getStartLoadHandler(),c=n.loadHandlerManager.getEndLoadHandler(),u=n.loadHandlerManager.getErrorLoadingHandler();l&&l(r),t.loadAndCacheImage(i.imageIds[s]).then(function(n){var o=t.getViewport(r);i.currentImageIdIndex=s,e.displayImage(r,n,o),c&&c(r)},function(e){var t=i.imageIds[s];u&&u(r,t,e)})}}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.Synchronizer=function(n,o){var r=this,a=[],i=[],s=!1;function l(t,n){s=!0,e.each(i,function(e,a){o(r,t,a,n)}),s=!1}function c(e,t){!0!==s&&l(e.currentTarget,t)}this.addSource=function(t){-1===a.indexOf(t)&&(a.push(t),e(t).on(n,c),l(t))},this.addTarget=function(e){-1===i.indexOf(e)&&(i.push(e),o(r,e,e))},this.add=function(e){r.addSource(e),r.addTarget(e)},this.removeSource=function(t){var o=a.indexOf(t);-1!==o&&(a.splice(o,1),e(t).off(n,c),l(t))},this.removeTarget=function(e){var t=i.indexOf(e);-1!==t&&(i.splice(t,1),o(r,e,e))},this.remove=function(e){r.removeTarget(e),r.removeSource(e)},this.getSourceElements=function(){return a},this.displayImage=function(e,n,o){s=!0,t.displayImage(e,n,o),s=!1},this.setViewport=function(e,n){s=!0,t.setViewport(e,n),s=!1}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.updateImageSynchronizer=function(e,n,o){o!==n&&t.updateImage(o)}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.wwwcSynchronizer=function(e,n,o){if(o!==n){var r=t.getViewport(n),a=t.getViewport(o);a.voi.windowWidth===r.voi.windowWidth&&a.voi.windowCenter===r.voi.windowCenter&&a.invert===r.invert||(a.voi.windowWidth=r.voi.windowWidth,a.voi.windowCenter=r.voi.windowCenter,a.invert=r.invert,e.setViewport(o,a))}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";var o="probe4D";n.probeTool4D=n.mouseButtonTool({createNewMeasurement:function(e){var o=n.getToolState(e.element,"timeSeries");if(void 0!==o&&void 0!==o.data&&0!==o.data.length){var r=o.data[0],a={timeSeries:r,lineSample:new n.LineSampleMeasurement,imageIdIndex:r.stacks[r.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};return function(e){var n=[];e.timeSeries.stacks.forEach(function(o){t.loadAndCacheImage(o.imageIds[e.imageIdIndex]).then(function(t){var o=Math.round(e.handles.end.x)+Math.round(e.handles.end.y)*t.width,r=t.getPixelData()[o];n.push(r)})}),e.lineSample.set(n)}(a),n.MeasurementManager.add(a),a}},onImageRendered:function(e,r){var a=n.getToolState(e.currentTarget,o);if(void 0!==a){var i=r.canvasContext.canvas.getContext("2d");t.setToPixelCoordinateSystem(r.enabledElement,i);for(var s=0;s<a.data.length;s++){i.save();var l=a.data[s];i.beginPath(),n.drawHandles(i,r,l.handles,"white"),i.stroke();var c=n.setContextToDisplayFontSize(r.enabledElement,r.canvasContext,15);i.font=c.fontSize+"px Arial";var u=Math.round(l.handles.end.x),d=Math.round(l.handles.end.y),h=l.handles.end.x+3,f=l.handles.end.y-3;i.fillStyle="white",i.fillText(u+","+d,h,f),i.restore()}}},toolType:o})}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.incrementTimePoint=function(e,o,r){var a=n.getToolState(e,"timeSeries");if(void 0!==a&&void 0!==a.data&&0!==a.data.length){var i=a.data[0],s=i.stacks[i.currentStackIndex].currentImageIdIndex,l=i.currentStackIndex+o;if(r?(l>=i.stacks.length&&(l=0),l<0&&(l=i.stacks.length-1)):(l=Math.min(i.stacks.length-1,l),l=Math.max(0,l)),l!==i.currentStackIndex){var c=t.getViewport(e),u=i.stacks[l],d=n.loadHandlerManager.getStartLoadHandler(),h=n.loadHandlerManager.getEndLoadHandler(),f=n.loadHandlerManager.getErrorLoadingHandler();d&&d(e),t.loadAndCacheImage(u.imageIds[s]).then(function(n){i.currentImageIdIndex!==s&&(u.currentImageIdIndex=s,i.currentStackIndex=l,t.displayImage(e,n,c),h&&h(e))},function(t){var n=u.imageIds[s];f&&f(e,n,t)})}}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";var o="timeSeriesPlayer";n.timeSeriesPlayer={start:function(e,t){if(void 0===e)throw"playClip: element must not be undefined";void 0===t&&(t=30);var r=n.getToolState(e,"timeSeries");if(void 0!==r&&void 0!==r.data&&0!==r.data.length){var a,i=n.getToolState(e,o);void 0===i||0===i.data.length?(a={intervalId:void 0,framesPerSecond:t,lastFrameTimeStamp:void 0,frameRate:0},n.addToolState(e,o,a)):(a=i.data[0]).framesPerSecond=t,void 0===a.intervalId&&(a.intervalId=setInterval(function(){a.framesPerSecond>0?n.incrementTimePoint(e,1,!0):n.incrementTimePoint(e,-1,!0)},1e3/Math.abs(a.framesPerSecond)))}},stop:function(e){var t,r=n.getToolState(e,o);void 0!==r&&0!==r.data.length&&(t=r.data[0],clearInterval(t.intervalId),t.intervalId=void 0)}}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";function o(t,n){e(n.element).off("CornerstoneToolsMouseDrag",r),e(n.element).off("CornerstoneToolsMouseUp",o)}function r(t,o){t.data.deltaY+=o.deltaPoints.page.y;var r=n.getToolState(o.element,"timeSeries");if(void 0!==r&&void 0!==r.data&&0!==r.data.length){var a=r.data[0],i=e(o.element).height()/a.stacks.length;if(void 0!==t.data.options&&void 0!==t.data.options.timeSeriesScrollSpeed&&(i=t.data.options.timeSeriesScrollSpeed),t.data.deltaY>=i||t.data.deltaY<=-i){var s=Math.round(t.data.deltaY/i),l=t.data.deltaY%i;n.incrementTimePoint(o.element,s),t.data.deltaY=l}return!1}}n.timeSeriesScroll=n.simpleMouseButtonTool(function(t,a){if(n.isMouseButtonEnabled(a.which,t.data.mouseButtonMask)){var i={deltaY:0,options:t.data.options};return e(a.element).on("CornerstoneToolsMouseDrag",i,r),e(a.element).on("CornerstoneToolsMouseUp",o),t.stopImmediatePropagation(),!1}}),n.timeSeriesScrollWheel=n.mouseWheelTool(function(e,t){var o=-t.direction;n.incrementTimePoint(t.element,o)}),n.timeSeriesScrollTouchDrag=n.touchDragTool(function(e){var t=e.originalEvent.detail,o={deltaY:0};o.deltaY+=t.deltaPoints.page.y;var r=n.getToolState(t.element,"stack");if(void 0!==r&&void 0!==r.data&&0!==r.data.length){if(o.deltaY>=3||o.deltaY<=-3){var a=o.deltaY/3,i=o.deltaY%3;n.setTimePoint(o.element,a),o.deltaY=i}return!1}})}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.roundToDecimal=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}}($,cornerstone,cornerstoneTools),function(e){"use strict";e.calculateSUV=function(e,t){if(void 0!==e.data&&"PT"===e.data.string("x00080060")){var n=t*e.slope+e.intercept,o=e.data.floatString("x00101030");if(void 0!==o){var r=e.data.elements.x00540016;if(void 0!==r){var a=(r=r.items[0].dataSet).time("x00181072"),i=r.floatString("x00181074"),s=r.floatString("x00181075"),l=e.data.time("x00080032");if(a&&i&&s&&l){var c=l.fractionalSeconds+l.seconds+60*l.minutes+60*l.hours*60-(a.fractionalSeconds+a.seconds+60*a.minutes+60*a.hours*60);return n*o/(i*Math.exp(-c*Math.log(2)/s))*1e3}}}}}}(cornerstoneTools),function(e,t,n,o){"use strict";o.copyPoints=function(e){return{page:n.point.copy(e.page),image:n.point.copy(e.image),client:n.point.copy(e.client),canvas:n.point.copy(e.canvas)}}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(e){"use strict";e.drawEllipse=function(e,t,n,o,r){var a=o/2*.5522848,i=r/2*.5522848,s=t+o,l=n+r,c=t+o/2,u=n+r/2;e.beginPath(),e.moveTo(t,u),e.bezierCurveTo(t,u-i,c-a,n,c,n),e.bezierCurveTo(c+a,n,s,u-i,s,u),e.bezierCurveTo(s,u+i,c+a,l,c,l),e.bezierCurveTo(c-a,l,t,u+i,t,u),e.closePath(),e.stroke()}}(cornerstoneTools),function(e){"use strict";e.drawTextBox=function(t,n,o,r,a){var i=e.textStyle.getFont(),s=e.textStyle.getFontSize(),l=e.textStyle.getBackgroundColor();t.save(),t.font=i;var c=t.measureText(n).width;t.textBaseline="top",t.fillStyle=l,t.fillRect(o,r-s,c+10,s+10),t.fillStyle=a,t.fillText(n,o+5,r-s+5),t.restore()}}(cornerstoneTools),function(e,t){"use strict";var n={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:4}};t.getMaxSimultaneousRequests=function(){var e=t.stackPrefetch.getConfiguration();if(e.maxSimultaneousRequests)return e.maxSimultaneousRequests;var o,r,a,i=(r=navigator.userAgent,a=r.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(a[1])?"IE "+((o=/\brv[ :]+(\d+)/g.exec(r)||[])[1]||""):"Chrome"===a[1]&&null!==(o=r.match(/\b(OPR|Edge)\/(\d+)/))?o.slice(1).join(" ").replace("OPR","Opera"):(a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(o=r.match(/version\/(\d+)/i))&&a.splice(1,1,o[1]),a.join(" "))).split(" "),s=i[0],l=i[1],c=n[s];return c?c[l]?c[l]:c.default:n.default}}(cornerstone,cornerstoneTools),function(e,t){"use strict";t.isMouseButtonEnabled=function(e,t){return 0!=(t&1<<e-1)}}(cornerstone,cornerstoneTools),function(e,t,n){"use strict";n.pauseEvent=function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}}($,cornerstone,cornerstoneTools),function(e,t,n){"use strict";function o(e,t){var n=t.rowCosines.clone().multiplyScalar(e.x);n.multiplyScalar(t.columnPixelSpacing);var o=t.columnCosines.clone().multiplyScalar(e.y);o.multiplyScalar(t.rowPixelSpacing);var r=n.add(o);return r.add(t.imagePositionPatient),r}n.projectPatientPointToImagePlane=function(e,t){var n=e.clone().sub(t.imagePositionPatient);return{x:t.rowCosines.dot(n)/t.columnPixelSpacing,y:t.columnCosines.dot(n)/t.rowPixelSpacing}},n.imagePointToPatientPoint=o,n.planePlaneIntersection=function(e,t){var n=e.rowCosines.clone().cross(e.columnCosines),r=new cornerstoneMath.Plane;r.setFromNormalAndCoplanarPoint(n,e.imagePositionPatient);var a=t.rowCosines.clone().cross(t.columnCosines),i=new cornerstoneMath.Plane;i.setFromNormalAndCoplanarPoint(a,t.imagePositionPatient);var s=i.clone().intersectPlane(r),l=s.origin,c=s.direction,u=o({x:t.columns,y:t.rows},t),d=t.imagePositionPatient.distanceTo(u),h=new cornerstoneMath.Line3;h.start=l,h.end=l.clone().add(c.multiplyScalar(d));var f=function(e,t){var n=[];return Object.keys(t).forEach(function(o){var r=t[o],a=e.intersectLine(r);a&&n.push(a)}),n}(h,function(e){var t=o({x:0,y:0},e),n=o({x:e.columns,y:0},e),r=o({x:0,y:e.rows},e),a=o({x:e.columns,y:e.rows},e);return{top:new cornerstoneMath.Line3(t,n),left:new cornerstoneMath.Line3(t,r),right:new cornerstoneMath.Line3(n,a),bottom:new cornerstoneMath.Line3(r,a)}}(t));if(2===f.length)return{start:f[0],end:f[1]}}}($,cornerstone,cornerstoneTools),function(e,t){"use strict";t.scroll=function(e,n){var o=t.getToolState(e,"stack");if(void 0!==o&&void 0!==o.data&&0!==o.data.length){var r=o.data[0],a=r.currentImageIdIndex+n;a=Math.min(r.imageIds.length-1,a),a=Math.max(0,a),t.scrollToIndex(e,a)}}}(cornerstone,cornerstoneTools),function(e,t){"use strict";t.scrollToIndex=function(n,o){var r=t.getToolState(n,"stack");if(void 0!==r&&void 0!==r.data&&0!==r.data.length){var a=r.data[0];o<0&&(o+=a.imageIds.length);var i=t.loadHandlerManager.getStartLoadHandler(),s=t.loadHandlerManager.getEndLoadHandler(),l=t.loadHandlerManager.getErrorLoadingHandler();if(o!==a.currentImageIdIndex){i&&i(n);var c={newImageIdIndex:o,direction:o-a.currentImageIdIndex};a.currentImageIdIndex=o;var u=e.getViewport(n),d=a.imageIds[o],h=t.stackScroll.getConfiguration();if(h&&!0===h.retryLoadOnScroll){var f=e.imageCache.getImagePromise(d);f&&"rejected"===f.state()&&e.imageCache.removeImagePromise(d)}var m=t.requestPoolManager;t.requestPoolManager.clearRequestStack("interaction"),m.addRequest(n,d,"interaction",function(t){a.currentImageIdIndex===o&&(e.displayImage(n,t,u),s&&s(n))},function(e){var t=a.imageIds[o];l&&l(n,t,e)}),m.startGrabbing(),$(n).trigger("CornerstoneStackScroll",c)}}},t.loadHandlers={}}(cornerstone,cornerstoneTools),function(e,t){"use strict";t.setContextToDisplayFontSize=function(t,n,o){return e.setToPixelCoordinateSystem(t,n,.1),{fontSize:o/t.viewport.scale/.1,lineHeight:o/t.viewport.scale/.1,fontScale:.1}}}(cornerstone,cornerstoneTools),
/*! cornerstone-wado-image-loader - v0.7.0 - 2015-09-06 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */
"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneWADOImageLoader&&(cornerstoneWADOImageLoader={internal:{options:{beforeSend:function(e){}},multiFrameCacheHack:{}}}),function(e){"use strict";function t(t,n,o){0===t.uint16("x00280006")?e.convertRGBColorByPixel(n,o):e.convertRGBColorByPlane(n,o)}e.convertColorSpace=function(n,o,r){var a=o.uint16("x00280010"),i=o.uint16("x00280011"),s=o.string("x00280004");n.height=a,n.width=i;var l=n.getContext("2d").createImageData(i,a),c=$.Deferred();try{if("RGB"===s)t(o,r,l.data);else if("YBR_RCT"===s)t(o,r,l.data);else if("YBR_ICT"===s)t(o,r,l.data);else if("PALETTE COLOR"===s)e.convertPALETTECOLOR(r,l.data,o);else if("YBR_FULL_422"===s)e.convertYBRFull(r,l.data);else{if("YBR_FULL"!==s)throw"no color space conversion for photometric interpretation "+s;e.convertYBRFull(r,l.data)}return c.resolve(l),c}catch(e){return c.reject(e),c}}}(cornerstoneWADOImageLoader),function(e){"use strict";e.convertPALETTECOLOR=function(e,t,n){for(var o=n.int16("x00281101",0),r=n.int16("x00281101",1),a=8===n.int16("x00281101",2)?0:8,i=n.byteArray.buffer,s=new Uint16Array(i,n.elements.x00281201.dataOffset,o),l=new Uint16Array(i,n.elements.x00281202.dataOffset,o),c=new Uint16Array(i,n.elements.x00281203.dataOffset,o),u=n.uint16("x00280010")*n.uint16("x00280011"),d=0,h=0,f=0;f<u;++f){var m=e[d++];m<r?m=0:m>r+o-1?m=o-1:m-=r,t[h++]=s[m]>>a,t[h++]=l[m]>>a,t[h++]=c[m]>>a,t[h++]=255}}}(cornerstoneWADOImageLoader),function(e){"use strict";e.convertRGBColorByPixel=function(e,t){if(void 0===e)throw"decodeRGB: rgbBuffer must not be undefined";if(e.length%3!=0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var n=e.length/3,o=0,r=0,a=0;a<n;a++)t[r++]=e[o++],t[r++]=e[o++],t[r++]=e[o++],t[r++]=255}}(cornerstoneWADOImageLoader),function(e){"use strict";e.convertRGBColorByPlane=function(e,t){if(void 0===e)throw"decodeRGB: rgbBuffer must not be undefined";if(e.length%3!=0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var n=e.length/3,o=0,r=0;r<n;r++){var a=0,i=n,s=2*n;for(r=0;r<n;r++)t[o++]=e[a++],t[o++]=e[i++],t[o++]=e[s++],t[o++]=255}}}(cornerstoneWADOImageLoader),function(e){"use strict";e.convertYBRFull=function(e,t){if(void 0===e)throw"decodeRGB: ybrBuffer must not be undefined";if(e.length%3!=0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var n=e.length/3,o=0,r=0,a=0;a<n;a++){var i=e[o++],s=e[o++],l=e[o++];t[r++]=i+1.402*(l-128),t[r++]=i-.34414*(s-128)-.71414*(l-128),t[r++]=i+1.772*(s-128),t[r++]=255}}}(cornerstoneWADOImageLoader),function(e){"use strict";e.configure=function(t){e.internal.options=t}}(cornerstoneWADOImageLoader),function(e,t,n){"use strict";function o(t){var o,r=t.indexOf(":"),a=t.substring(r+1),i=a.indexOf("frame=");if(-1!==i){var s=a.substr(i+6);o=parseInt(s),a=a.substr(0,i-1)}if(void 0!==o&&n.internal.multiFrameCacheHack.hasOwnProperty(a)){var l=e.Deferred(),c=n.internal.multiFrameCacheHack[a];return n.createImageObject(c,t,o).then(function(e){l.resolve(e)},function(e){l.reject(e)}),l}return n.internal.xhrRequest(t,o,a)}t.loadImage=o,t.registerImageLoader("dicomweb",o),t.registerImageLoader("wadouri",o)}($,cornerstone,cornerstoneWADOImageLoader),function(e){"use strict";e.createImageObject=function(t,n,o){void 0===o&&(o=0);var r=t.string("x00280004");return!1===e.isColorImage(r)?e.makeGrayscaleImage(n,t,o):e.makeColorImage(n,t,o)}}(cornerstoneWADOImageLoader),function(e,t,n){"use strict";n.decodeJPEG2000=function(e,t){var n=e.uint16("x00280010"),o=e.uint16("x00280011"),r=dicomParser.readEncapsulatedPixelData(e,e.elements.x7fe00010,t),a=new JpxImage;a.parse(r);var i=a.width,s=a.height;if(i!==o)throw"JPEG2000 decoder returned width of "+i+", when "+o+" is expected";if(s!==n)throw"JPEG2000 decoder returned width of "+s+", when "+n+" is expected";var l=a.tiles.length;if(1!==l)throw"JPEG2000 decoder returned a tileCount of "+l+", when 1 is expected";return a.tiles[0].items}}($,cornerstone,cornerstoneWADOImageLoader),function(e,t,n){"use strict";n.decodeJPEGBaseline=function(e,t){var n=e.elements.x7fe00010,o=e.uint16("x00280010"),r=e.uint16("x00280011"),a=e.uint16("x00280100"),i=dicomParser.readEncapsulatedPixelData(e,n,t),s=new JpegImage;return s.parse(i),8===a?s.getData(r,o):16===a?s.getData16(r,o):void 0}}($,cornerstone,cornerstoneWADOImageLoader),function(e){"use strict";function t(e){return function(e){var t;try{return decodeURIComponent(escape(e))}catch(n){if((t=n)instanceof URIError)return e;throw t}}(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(e))))}e.decodeJPEGBaseline8Bit=function(e,n,o){var r=$.Deferred(),a=n.uint16("x00280010"),i=n.uint16("x00280011");e.height=a,e.width=i;var s=dicomParser.readEncapsulatedPixelData(n,n.elements.x7fe00010,o),l=new Blob([s],{type:"image/jpeg"}),c=new FileReader;return void 0===c.readAsBinaryString?c.readAsArrayBuffer(l):c.readAsBinaryString(l),c.onload=function(){var n=new Image;n.onload=function(){var t=e.getContext("2d");t.drawImage(this,0,0);var n=t.getImageData(0,0,i,a);r.resolve(n)},n.onerror=function(e){r.reject(e)},void 0===c.readAsBinaryString?n.src="data:image/jpeg;base64,"+window.btoa(t(c.result)):n.src="data:image/jpeg;base64,"+window.btoa(c.result)},r},e.isJPEGBaseline8Bit=function(e){var t=e.string("x00020010");if(8===e.uint16("x00280100")&&"1.2.840.10008.1.2.4.50"===t)return!0}}(cornerstoneWADOImageLoader),function(e){e.decodeJPEGLossless=function(e,t){var n=e.elements.x7fe00010,o=e.uint16("x00280100"),r=e.uint16("x00280103"),a=dicomParser.readEncapsulatedPixelData(e,n,t),i=o<=8?1:2,s=(new jpeg.lossless.Decoder).decode(a.buffer,a.byteOffset,a.length,i);return 0===r?2===i?new Uint16Array(s.buffer):new Uint8Array(s.buffer):new Int16Array(s.buffer)}}(cornerstoneWADOImageLoader),function(e){function t(e,t,n){for(var o=new DataView(e.buffer,e.byteOffset),r=new DataView(e.buffer,e.byteOffset),a=new DataView(t),i=o.getInt32(0,!0),s=0;s<i;++s){var l=0,c=0===s?1:0,u=o.getInt32(4*(s+1),!0),d=o.getInt32(4*(s+2),!0);for(0===d&&(d=e.length);u<d;){var h=r.getInt8(u++);if(h>=0&&h<=127)for(var f=0;f<h+1&&l<n;++f)a.setInt8(2*l+c,r.getInt8(u++)),l++;else if(h<=-1&&h>=-127)for(var m=r.getInt8(u++),g=0;g<1-h&&l<n;++g)a.setInt8(2*l+c,m),l++}}}e.decodeRLE=function(n,o){var r,a=n.uint16("x00280010"),i=n.uint16("x00280011"),s=n.uint16("x00280002"),l=n.elements.x7fe00010,c=dicomParser.readEncapsulatedPixelData(n,l,o),u=e.getPixelFormat(n),d=i*a;return 1===u?(function(e,t,n,o){for(var r=new DataView(e.buffer,e.byteOffset),a=new DataView(e.buffer,e.byteOffset),i=new DataView(t),s=0,l=r.getInt32(0,!0),c=0;c<l;++c){s=c;var u=r.getInt32(4*(c+1),!0),d=r.getInt32(4*(c+2),!0);0===d&&(d=e.length);for(var h=n*l;u<d;){var f=a.getInt8(u++);if(f>=0&&f<=127)for(var m=0;m<f+1&&s<h;++m)i.setInt8(s,a.getInt8(u++)),s+=o;else if(f<=-1&&f>=-127)for(var g=a.getInt8(u++),p=0;p<1-f&&s<h;++p)i.setInt8(s,g),s+=o}}}(c,r=new ArrayBuffer(d*s),d,s),new Uint8Array(r)):2===u?(t(c,r=new ArrayBuffer(d*s*2),d),new Uint16Array(r)):3===u?(t(c,r=new ArrayBuffer(d*s*2),d),new Int16Array(r)):void 0}}(cornerstoneWADOImageLoader),function(e){"use strict";e.decodeTransferSyntax=function(t,n){var o=t.string("x00020010");if("1.2.840.10008.1.2"===o)return e.extractUncompressedPixels(t,n);if("1.2.840.10008.1.2.1"===o)return e.extractUncompressedPixels(t,n);if("1.2.840.10008.1.2.4.90"===o)return e.decodeJPEG2000(t,n);if("1.2.840.10008.1.2.4.91"===o)return e.decodeJPEG2000(t,n);if("1.2.840.10008.1.2.5"===o)return e.decodeRLE(t,n);if("1.2.840.10008.1.2.4.50"===o)return e.decodeJPEGBaseline(t,n);if("1.2.840.10008.1.2.4.51"===o)return e.decodeJPEGBaseline(t,n);if("1.2.840.10008.1.2.4.57"===o)return e.decodeJPEGLossless(t,n);if("1.2.840.10008.1.2.4.70"===o)return e.decodeJPEGLossless(t,n);throw"no decoder for transfer syntax "+o}}(cornerstoneWADOImageLoader);var ColorSpace={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},JpegImage=function(){"use strict";var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,n=799,o=3406,r=2276,a=1567,i=3784,s=5793,l=2896;function c(){}function u(e,t){for(var n,o,r=0,a=[],i=16;i>0&&!e[i-1];)i--;a.push({children:[],index:0});var s,l=a[0];for(n=0;n<i;n++){for(o=0;o<e[n];o++){for((l=a.pop()).children[l.index]=t[r];l.index>0;)l=a.pop();for(l.index++,a.push(l);a.length<=n;)a.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s;r++}n+1<i&&(a.push(s={children:[],index:0}),l.children[l.index]=s.children,l=s)}return a[0].children}function d(e,t,n){return 64*((e.blocksPerLine+1)*t+n)}function h(t,n,o,r,a,i,s,l,c){o.precision,o.samplesPerLine,o.scanLines;var u=o.mcusPerLine,h=o.progressive,f=(o.maxH,o.maxV,n),m=0,g=0;function p(){if(g>0)return m>>--g&1;if(255==(m=t[n++])){var e=t[n++];if(e)throw"unexpected marker: "+(m<<8|e).toString(16)}return g=7,m>>>7}function v(e){for(var t,n=e;null!==(t=p());){if("number"==typeof(n=n[t]))return n;if("object"!=typeof n)throw"invalid huffman sequence"}return null}function y(e){for(var t=0;e>0;){var n=p();if(null===n)return;t=t<<1|n,e--}return t}function w(e){var t=y(e);return t>=1<<e-1?t:t+(-1<<e)+1}var T=0;var x,b=0;function C(e,t,n,o,r){var a=n%u;t(e,d(e,(n/u|0)*e.v+o,a*e.h+r))}function P(e,t,n){t(e,d(e,n/e.blocksPerLine|0,n%e.blocksPerLine))}var S,M,I,D,k,E,A=r.length;E=h?0===i?0===l?function(e,t){var n=v(e.huffmanTableDC),o=0===n?0:w(n)<<c;e.blockData[t]=e.pred+=o}:function(e,t){e.blockData[t]|=p()<<c}:0===l?function(t,n){if(T>0)T--;else for(var o=i,r=s;o<=r;){var a=v(t.huffmanTableAC),l=15&a,u=a>>4;if(0!==l){var d=e[o+=u];t.blockData[n+d]=w(l)*(1<<c),o++}else{if(u<15){T=y(u)+(1<<u)-1;break}o+=16}}}:function(t,n){for(var o=i,r=s,a=0;o<=r;){var l=e[o];switch(b){case 0:var u=v(t.huffmanTableAC),d=15&u;if(a=u>>4,0===d)a<15?(T=y(a)+(1<<a),b=4):(a=16,b=1);else{if(1!==d)throw"invalid ACn encoding";x=w(d),b=a?2:3}continue;case 1:case 2:t.blockData[n+l]?t.blockData[n+l]+=p()<<c:0==--a&&(b=2==b?3:0);break;case 3:t.blockData[n+l]?t.blockData[n+l]+=p()<<c:(t.blockData[n+l]=x<<c,b=0);break;case 4:t.blockData[n+l]&&(t.blockData[n+l]+=p()<<c)}o++}4===b&&0==--T&&(b=0)}:function(t,n){var o=v(t.huffmanTableDC),r=0===o?0:w(o);t.blockData[n]=t.pred+=r;for(var a=1;a<64;){var i=v(t.huffmanTableAC),s=15&i,l=i>>4;if(0!==s){var c=e[a+=l];t.blockData[n+c]=w(s),a++}else{if(l<15)break;a+=16}}};var R,O,L,B,U=0;for(O=1==A?r[0].blocksPerLine*r[0].blocksPerColumn:u*o.mcusPerColumn,a||(a=O);U<O;){for(M=0;M<A;M++)r[M].pred=0;if(T=0,1==A)for(S=r[0],k=0;k<a;k++)P(S,E,U),U++;else for(k=0;k<a;k++){for(M=0;M<A;M++)for(L=(S=r[M]).h,B=S.v,I=0;I<B;I++)for(D=0;D<L;D++)C(S,E,U,I,D);U++}if(g=0,(R=t[n]<<8|t[n+1])<=65280)throw"marker was not found";if(!(R>=65488&&R<=65495))break;n+=2}return n-f}function f(e,c,u){var d,h,f,m,g,p,v,y,w,T,x=e.quantizationTable;for(T=0;T<64;T++)u[T]=e.blockData[c+T]*x[T];for(T=0;T<8;++T){var b=8*T;0!==u[1+b]||0!==u[2+b]||0!==u[3+b]||0!==u[4+b]||0!==u[5+b]||0!==u[6+b]||0!==u[7+b]?(d=s*u[0+b]+128>>8,h=s*u[4+b]+128>>8,f=u[2+b],m=u[6+b],g=l*(u[1+b]-u[7+b])+128>>8,y=l*(u[1+b]+u[7+b])+128>>8,p=u[3+b]<<4,v=u[5+b]<<4,w=d-h+1>>1,d=d+h+1>>1,h=w,w=f*i+m*a+128>>8,f=f*a-m*i+128>>8,m=w,w=g-v+1>>1,g=g+v+1>>1,v=w,w=y+p+1>>1,p=y-p+1>>1,y=w,w=d-m+1>>1,d=d+m+1>>1,m=w,w=h-f+1>>1,h=h+f+1>>1,f=w,w=g*r+y*o+2048>>12,g=g*o-y*r+2048>>12,y=w,w=p*n+v*t+2048>>12,p=p*t-v*n+2048>>12,v=w,u[0+b]=d+y,u[7+b]=d-y,u[1+b]=h+v,u[6+b]=h-v,u[2+b]=f+p,u[5+b]=f-p,u[3+b]=m+g,u[4+b]=m-g):(w=s*u[0+b]+512>>10,u[0+b]=w,u[1+b]=w,u[2+b]=w,u[3+b]=w,u[4+b]=w,u[5+b]=w,u[6+b]=w,u[7+b]=w)}for(T=0;T<8;++T){var C=T;0!==u[8+C]||0!==u[16+C]||0!==u[24+C]||0!==u[32+C]||0!==u[40+C]||0!==u[48+C]||0!==u[56+C]?(d=s*u[0+C]+2048>>12,h=s*u[32+C]+2048>>12,f=u[16+C],m=u[48+C],g=l*(u[8+C]-u[56+C])+2048>>12,y=l*(u[8+C]+u[56+C])+2048>>12,p=u[24+C],v=u[40+C],w=d-h+1>>1,d=d+h+1>>1,h=w,w=f*i+m*a+2048>>12,f=f*a-m*i+2048>>12,m=w,w=g-v+1>>1,g=g+v+1>>1,v=w,w=y+p+1>>1,p=y-p+1>>1,y=w,w=d-m+1>>1,d=d+m+1>>1,m=w,w=h-f+1>>1,h=h+f+1>>1,f=w,w=g*r+y*o+2048>>12,g=g*o-y*r+2048>>12,y=w,w=p*n+v*t+2048>>12,p=p*t-v*n+2048>>12,v=w,u[0+C]=d+y,u[56+C]=d-y,u[8+C]=h+v,u[48+C]=h-v,u[16+C]=f+p,u[40+C]=f-p,u[24+C]=m+g,u[32+C]=m-g):(w=s*u[T+0]+8192>>14,u[0+C]=w,u[8+C]=w,u[16+C]=w,u[24+C]=w,u[32+C]=w,u[40+C]=w,u[48+C]=w,u[56+C]=w)}for(T=0;T<64;++T){var P=c+T,S=u[T];S=S<=-2056/e.bitConversion?0:S>=2024/e.bitConversion?255/e.bitConversion:S+2056/e.bitConversion>>4,e.blockData[P]=S}}function m(e,t){for(var n=t.blocksPerLine,o=t.blocksPerColumn,r=new Int32Array(64),a=0;a<o;a++)for(var i=0;i<n;i++){f(t,d(t,a,i),r)}return t.blockData}function g(e){return e<=0?0:e>=255?255:0|e}return c.prototype={load:function(e){var t=function(e){this.parse(e),this.onload&&this.onload()}.bind(this);if(e.indexOf("data:")>-1){for(var n=e.indexOf("base64,")+7,o=atob(e.substring(n)),r=new Uint8Array(o.length),a=o.length-1;a>=0;a--)r[a]=o.charCodeAt(a);t(o)}else{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){var e=new Uint8Array(i.response);t(e)}.bind(this),i.send(null)}},parse:function(t){function n(){var e=t[s]<<8|t[s+1];return s+=2,e}function o(){var e=n(),o=t.subarray(s,s+e-2);return s+=o.length,o}function r(e){for(var t=Math.ceil(e.samplesPerLine/8/e.maxH),n=Math.ceil(e.scanLines/8/e.maxV),o=0;o<e.components.length;o++){j=e.components[o];var r=Math.ceil(Math.ceil(e.samplesPerLine/8)*j.h/e.maxH),a=Math.ceil(Math.ceil(e.scanLines/8)*j.v/e.maxV),i=t*j.h,s=64*(n*j.v)*(i+1);j.blockData=new Int16Array(s),j.blocksPerLine=r,j.blocksPerColumn=a}e.mcusPerLine=t,e.mcusPerColumn=n}var a,i,s=0,l=(t.length,null),c=null,d=[],f=[],g=[],p=n();if(65496!=p)throw"SOI not found";for(p=n();65497!=p;){var v,y;switch(p){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=o();65504===p&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(l={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])}),65518===p&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&0===w[5]&&(c={version:w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var T=n()+s-2;s<T;){var x=t[s++],b=new Int32Array(64);if(x>>4==0)for(v=0;v<64;v++){b[e[v]]=t[s++]}else{if(x>>4!=1)throw"DQT: invalid table spec";for(v=0;v<64;v++){b[e[v]]=n()}}d[15&x]=b}break;case 65472:case 65473:case 65474:if(a)throw"Only single frame JPEGs supported";n(),(a={}).extended=65473===p,a.progressive=65474===p,a.precision=t[s++],a.scanLines=n(),a.samplesPerLine=n(),a.components=[],a.componentIds={};var C,P=t[s++],S=0,M=0;for(W=0;W<P;W++){C=t[s];var I=t[s+1]>>4,D=15&t[s+1];S<I&&(S=I),M<D&&(M=D);var k=t[s+2];y=a.components.push({h:I,v:D,quantizationTable:d[k],quantizationTableId:k,bitConversion:255/((1<<a.precision)-1)}),a.componentIds[C]=y-1,s+=3}a.maxH=S,a.maxV=M,r(a);break;case 65476:var E=n();for(W=2;W<E;){var A=t[s++],R=new Uint8Array(16),O=0;for(v=0;v<16;v++,s++)O+=R[v]=t[s];var L=new Uint8Array(O);for(v=0;v<O;v++,s++)L[v]=t[s];W+=17+O,(A>>4==0?g:f)[15&A]=u(R,L)}break;case 65501:n(),i=n();break;case 65498:n();var B=t[s++],U=[];for(W=0;W<B;W++){var z=a.componentIds[t[s++]];j=a.components[z];var F=t[s++];j.huffmanTableDC=g[F>>4],j.huffmanTableAC=f[15&F],U.push(j)}var H=t[s++],V=t[s++],q=t[s++],N=h(t,s,a,U,i,H,V,q>>4,15&q);s+=N;break;default:if(255==t[s-3]&&t[s-2]>=192&&t[s-2]<=254){s-=3;break}throw"unknown JPEG marker "+p.toString(16)}p=n()}switch(this.width=a.samplesPerLine,this.height=a.scanLines,this.jfif=l,this.adobe=c,this.components=[],a.components.length){case 1:this.colorspace=ColorSpace.Grayscale;break;case 3:this.adobe?this.colorspace=ColorSpace.AdobeRGB:this.colorspace=ColorSpace.RGB;break;case 4:this.colorspace=ColorSpace.CYMK;break;default:this.colorspace=ColorSpace.Unknown}for(var W=0;W<a.components.length;W++){var j;(j=a.components[W]).quantizationTable||null===j.quantizationTableId||(j.quantizationTable=d[j.quantizationTableId]),this.components.push({output:m(0,j),scaleX:j.h/a.maxH,scaleY:j.v/a.maxV,blocksPerLine:j.blocksPerLine,blocksPerColumn:j.blocksPerColumn,bitConversion:j.bitConversion})}},getData16:function(e,t){if(1!==this.components.length)throw"Unsupported color mode";var n,o,r,a,i,s,l=this.width/e,c=this.height/t,u=0,h=this.components.length,f=new Uint16Array(e*t*h),m=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(s=0;s<h;s++){for(var g,p,v,y=(n=this.components[s]).blocksPerLine,w=n.blocksPerColumn,T=y<<3,x=0,b=0;b<w;b++)for(var C=b<<3,P=0;P<y;P++){var S=d(n,b,P),M=(u=0,P<<3);for(g=0;g<8;g++){x=(C+g)*T;for(p=0;p<8;p++)m[x+M+p]=n.output[S+u++]}}for(o=n.scaleX*l,r=n.scaleY*c,u=s,i=0;i<t;i++)for(a=0;a<e;a++)v=(0|i*r)*T+(0|a*o),f[u]=m[v],u+=h}return f},getData:function(e,t){var n,o,r,a,i,s,l,c,u,h,f,m,p,v,y,w=this.width/e,T=this.height/t,x=0,b=this.components.length,C=e*t*b,P=new Uint8Array(C),S=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(s=0;s<b;s++){for(var M,I,D,k=(n=this.components[s]).blocksPerLine,E=n.blocksPerColumn,A=k<<3,R=0,O=0;O<E;O++)for(var L=O<<3,B=0;B<k;B++){var U=d(n,O,B),z=(x=0,B<<3);for(M=0;M<8;M++){R=(L+M)*A;for(I=0;I<8;I++)S[R+z+I]=n.output[U+x++]*n.bitConversion}}for(o=n.scaleX*w,r=n.scaleY*T,x=s,i=0;i<t;i++)for(a=0;a<e;a++)D=(0|i*r)*A+(0|a*o),P[x]=S[D],x+=b}switch(b){case 1:case 2:break;case 3:if(y=!0,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(s=0;s<C;s+=b)l=P[s],c=P[s+1],m=g(l-179.456+1.402*(u=P[s+2])),p=g(l+135.459-.344*c-.714*u),v=g(l-226.816+1.772*c),P[s]=m,P[s+1]=p,P[s+2]=v;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(y=!1,this.adobe&&this.adobe.transformCode?y=!0:void 0!==this.colorTransform&&(y=!!this.colorTransform),y)for(s=0;s<C;s+=b)l=P[s],c=P[s+1],h=g(434.456-l-1.402*(u=P[s+2])),f=g(119.541-l+.344*c+.714*u),l=g(481.816-l-1.772*c),P[s]=h,P[s+1]=f,P[s+2]=l;break;default:throw"Unsupported color mode"}return P}},c}();!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).jpeg=e()}}(function(){return function e(t,n,o){function r(i,s){if(!n[i]){if(!t[i]){var l="function"==typeof require&&require;if(!s&&l)return l(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[i]={exports:{}};t[i][0].call(u.exports,function(e){var n=t[i][1][e];return r(n||e)},u,u.exports,e,t,n,o)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<o.length;i++)r(o[i]);return r}({1:[function(e,t,n){"use strict";var o=o||{};o.lossless=o.lossless||{},o.lossless.ComponentSpec=o.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0},"undefined"!==typeof t&&t.exports&&(t.exports=o.lossless.ComponentSpec)},{}],2:[function(e,t,n){"use strict";var o=o||{};o.lossless=o.lossless||{},o.lossless.DataStream=o.lossless.DataStream||function(e,t,n){this.buffer=new DataView(e,t,n),this.index=0},o.lossless.DataStream.prototype.get16=function(){var e=this.buffer.getUint16(this.index,!1);return this.index+=2,e},o.lossless.DataStream.prototype.get8=function(){var e=this.buffer.getUint8(this.index);return this.index+=1,e},"undefined"!==typeof t&&t.exports&&(t.exports=o.lossless.DataStream)},{}],3:[function(e,t,n){"use strict";var o=o||{};o.lossless=o.lossless||{},o.lossless.DataStream=o.lossless.DataStream||(void 0!==e?e("./data-stream.js"):null),o.lossless.HuffmanTable=o.lossless.HuffmanTable||(void 0!==e?e("./huffman-table.js"):null),o.lossless.QuantizationTable=o.lossless.QuantizationTable||(void 0!==e?e("./quantization-table.js"):null),o.lossless.ScanHeader=o.lossless.ScanHeader||(void 0!==e?e("./scan-header.js"):null),o.lossless.FrameHeader=o.lossless.FrameHeader||(void 0!==e?e("./frame-header.js"):null),o.lossless.Utils=o.lossless.Utils||(void 0!==e?e("./utils.js"):null),o.lossless.Decoder=o.lossless.Decoder||function(e,t){this.buffer=e,this.frame=new o.lossless.FrameHeader,this.huffTable=new o.lossless.HuffmanTable,this.quantTable=new o.lossless.QuantizationTable,this.scan=new o.lossless.ScanHeader,this.DU=o.lossless.Utils.createArray(10,4,64),this.HuffTab=o.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=o.lossless.Utils.createArray(10,1),this.dcTab=o.lossless.Utils.createArray(10,1),this.qTab=o.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.outputData=null,this.numBytes=void 0===t?2:t},o.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],o.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],o.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,o.lossless.Decoder.MSB=2147483648,o.lossless.Decoder.prototype.decode=function(e,t,n,r){var a,i,s,l,c=0,u=[],d=[],h=[];if(void 0!==e&&(this.buffer=e),void 0!==r&&(this.numBytes=r),2===this.numBytes?(this.getter=this.getValue16,this.setter=this.setValue16):1===this.numBytes&&(this.getter=this.getValue8,this.setter=this.setValue8),this.stream=new o.lossless.DataStream(this.buffer,t,n),this.buffer=null,this.xLoc=0,this.yLoc=0,65496!==(a=this.stream.get16()))throw new Error("Not a JPEG file");for(a=this.stream.get16();a>>4!=4092||65476===a;){switch(a){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,o.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(a>>8!=255)throw new Error("ERROR: format throw new IOException! (decode)")}a=this.stream.get16()}if(a<65472||a>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),a=this.stream.get16();do{for(;65498!==a;){switch(a){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,o.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(a>>8!=255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}a=this.stream.get16()}for(this.precision=this.frame.precision,this.components=this.frame.components,this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,i=0;i<this.numComp;i+=1)s=this.scanComps[i].scanCompSel,this.qTab[i]=this.quantTables[this.components[s].quantTableSel],this.nBlock[i]=this.components[s].vSamp*this.components[s].hSamp,this.dcTab[i]=this.HuffTab[this.scanComps[i].dcTabSel][0],this.acTab[i]=this.HuffTab[this.scanComps[i].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes)),c+=1;;){for(d[0]=0,h[0]=0,i=0;i<10;i+=1)u[i]=1<<this.precision-1;if(0===this.restartInterval){for(a=this.decodeUnit(u,d,h);0===a&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(u),a=this.decodeUnit(u,d,h);break}for(l=0;l<this.restartInterval&&(a=this.decodeUnit(u,d,h),this.output(u),0===a);l+=1);if(0===a&&(0!==this.markerIndex?(a=65280|this.marker,this.markerIndex=0):a=this.stream.get16()),!(a>=65488&&a<=65495))break}65500===a&&1===c&&(this.readNumber(),a=this.stream.get16())}while(65497!==a&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===c);return this.outputData},o.lossless.Decoder.prototype.decodeUnit=function(e,t,n){var r,a,i,s,l,c,u,d;switch(this.selection){case 2:e[0]=this.getPreviousY();break;case 3:e[0]=this.getPreviousXY();break;case 4:e[0]=this.getPreviousX()+this.getPreviousY()-this.getPreviousXY();break;case 5:e[0]=this.getPreviousX()+(this.getPreviousY()-this.getPreviousXY()>>1);break;case 6:e[0]=this.getPreviousY()+(this.getPreviousX()-this.getPreviousXY()>>1);break;case 7:e[0]=(this.getPreviousX()+this.getPreviousY())/2;break;default:e[0]=this.getPreviousX()}if(this.numComp>1){for(l=0;l<this.numComp;l+=1)for(s=this.qTab[l],a=this.acTab[l],i=this.dcTab[l],c=0;c<this.nBlock[l];c+=1){for(u=0;u<this.IDCT_Source.length;u+=1)this.IDCT_Source[u]=0;if((r=this.getHuffmanValue(i,t,n))>=65280)return r;for(e[l]=this.IDCT_Source[0]=e[l]+this.getn(n,r,t,n),this.IDCT_Source[0]*=s[0],d=1;d<64;d+=1){if((r=this.getHuffmanValue(a,t,n))>=65280)return r;if(d+=r>>4,0==(15&r)){if(r>>4==0)break}else this.IDCT_Source[o.lossless.Decoder.IDCT_P[d]]=this.getn(n,15&r,t,n)*s[d]}this.scaleIDCT(this.DU[l][c])}return 0}for(c=0;c<this.nBlock[0];c+=1){if((r=this.getHuffmanValue(this.dcTab[0],t,n))>=65280)return r;e[0]+=this.getn(e,r,t,n)}return 0},o.lossless.Decoder.prototype.getHuffmanValue=function(e,t,n){var r,a;if(65535,n[0]<8?(t[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=a):n[0]-=8,0!=((r=e[t[0]>>n[0]])&o.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;t[0]&=65535>>16-n[0],t[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),t[0]|=a,r=e[256*(255&r)+(t[0]>>n[0])],n[0]+=8}if(n[0]+=8-(r>>8),n[0]<0)throw new Error("index="+n[0]+" temp="+t[0]+" code="+r+" in HuffmanValue()");return n[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(t[0]&=65535>>16-n[0],255&r)},o.lossless.Decoder.prototype.getn=function(e,t,n,o){var r,a;if(1,-1,65535,0===t)return 0;if(16===t)return e[0]>=0?-32768:32768;if(o[0]-=t,o[0]>=0){if(o[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;r=n[0]>>o[0],n[0]&=65535>>16-o[0]}else{if(n[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),n[0]|=a,o[0]+=8,o[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;n[0]<<=8,255===(a=this.stream.get8())&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),n[0]|=a,o[0]+=8}if(o[0]<0)throw new Error("index="+o[0]+" in getn()");if(o[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;r=n[0]>>o[0],n[0]&=65535>>16-o[0]}return r<1<<t-1&&(r+=1+(-1<<t)),r},o.lossless.Decoder.prototype.getPreviousX=function(){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1):this.yLoc>0?this.getPreviousY():1<<this.frame.precision-1},o.lossless.Decoder.prototype.getPreviousXY=function(){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1):this.getPreviousY()},o.lossless.Decoder.prototype.getPreviousY=function(){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc):this.getPreviousX()},o.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},o.lossless.Decoder.prototype.output=function(e){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,e[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},o.lossless.Decoder.prototype.setValue16=function(e,t){this.outputData.setInt16(2*e,t,!0)},o.lossless.Decoder.prototype.getValue16=function(e){return this.outputData.getInt16(2*e,!0)},o.lossless.Decoder.prototype.setValue8=function(e,t){this.outputData.setInt8(e,t)},o.lossless.Decoder.prototype.getValue8=function(e){return this.outputData.getInt8(e)},o.lossless.Decoder.prototype.readApp=function(){var e=0,t=this.stream.get16();for(e+=2;e<t;)this.stream.get8(),e+=1;return t},o.lossless.Decoder.prototype.readComment=function(){var e,t="",n=0;for(e=this.stream.get16(),n+=2;n<e;)t+=this.stream.get8(),n+=1;return t},o.lossless.Decoder.prototype.readNumber=function(){if(4!==this.stream.get16())throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()},o.lossless.Decoder.prototype.scaleIDCT=function(e){var t,n,r,a,i,s,l,c,u,d,h,f,m,g,p,v,y,w,T,x=o.lossless.Utils.createArray(8,8),b=0;for(a=0;a<8;a+=1)i=this.IDCT_Source[0+a],s=this.IDCT_Source[8+a],l=this.IDCT_Source[16+a]-this.IDCT_Source[24+a],c=this.IDCT_Source[24+a]+this.IDCT_Source[16+a],u=this.IDCT_Source[32+a]-this.IDCT_Source[56+a],h=this.IDCT_Source[40+a]-this.IDCT_Source[48+a],d=(t=this.IDCT_Source[40+a]+this.IDCT_Source[48+a])-(n=this.IDCT_Source[32+a]+this.IDCT_Source[56+a]),f=t+n,i=(m=(t=256*i)+(n=256*s))+(v=r=256*c),s=(g=t-n)+(p=384*l-r),l=g-p,c=m-v,u=(w=480*h-192*u)-(480*-u-192*h)-(y=384*d)-(T=256*f),d=y-w+T,h=w-T,f=T,x[0][a]=i+f+4096>>13,x[1][a]=s+h+4096>>13,x[2][a]=l+d+4096>>13,x[3][a]=c+u+4096>>13,x[4][a]=c-u+4096>>13,x[5][a]=l-d+4096>>13,x[6][a]=s-h+4096>>13,x[7][a]=i-f+4096>>13;for(a=0;a<8;a+=1)i=x[a][0],s=x[a][1],l=x[a][2]-x[a][3],c=x[a][3]+x[a][2],u=x[a][4]-x[a][7],h=x[a][5]-x[a][6],d=(t=x[a][5]+x[a][6])-(n=x[a][4]+x[a][7]),f=t+n,i=(m=(t=256*i)+(n=256*s))+(v=r=256*c),s=(g=t-n)+(p=384*l-r),l=g-p,c=m-v,u=(w=480*h-192*u)-(480*-u-192*h)-(y=384*d)-(T=256*f),d=y-w+T,h=w-T,f=T,e[b+=1]=i+f+4096>>13,e[b+=1]=s+h+4096>>13,e[b+=1]=l+d+4096>>13,e[b+=1]=c+u+4096>>13,e[b+=1]=c-u+4096>>13,e[b+=1]=l-d+4096>>13,e[b+=1]=s-h+4096>>13,e[b+=1]=i-f+4096>>13},"undefined"!==typeof t&&t.exports&&(t.exports=o.lossless.Decoder)},{"./data-stream.js":2,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-header.js":9,"./utils.js":10}],4:[function(e,t,n){"use strict";var o=o||{};o.lossless=o.lossless||{},o.lossless.ComponentSpec=o.lossless.ComponentSpec||(void 0!==e?e("./component-spec.js"):null),o.lossless.DataStream=o.lossless.DataStream||(void 0!==e?e("./data-stream.js"):null),o.lossless.FrameHeader=o.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},o.lossless.FrameHeader.prototype.read=function(e){var t,n,r,a,i=0;for(t=e.get16(),i+=2,this.precision=e.get8(),i+=1,this.dimY=e.get16(),i+=2,this.dimX=e.get16(),i+=2,this.numComp=e.get8(),i+=1,n=1;n<=this.numComp;n+=1){if(i>t)throw new Error("ERROR: frame format error");if(r=e.get8(),(i+=1)>=t)throw new Error("ERROR: frame format error [c>=Lf]");a=e.get8(),i+=1,this.components[r]||(this.components[r]=new o.lossless.ComponentSpec),this.components[r].hSamp=a>>4,this.components[r].vSamp=15&a,this.components[r].quantTableSel=e.get8(),i+=1}if(i!==t)throw new Error("ERROR: frame format error [Lf!=count]");return 1},"undefined"!==typeof t&&t.exports&&(t.exports=o.lossless.FrameHeader)},{"./component-spec.js":1,"./data-stream.js":2}],5:[function(e,t,n){"use strict";var o=o||{};o.lossless=o.lossless||{},o.lossless.DataStream=o.lossless.DataStream||(void 0!==e?e("./data-stream.js"):null),o.lossless.Utils=o.lossless.Utils||(void 0!==e?e("./utils.js"):null),o.lossless.HuffmanTable=o.lossless.HuffmanTable||function(){this.l=o.lossless.Utils.createArray(4,2,16),this.th=[],this.v=o.lossless.Utils.createArray(4,2,16,200),this.tc=o.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},o.lossless.HuffmanTable.MSB=2147483648,o.lossless.HuffmanTable.prototype.read=function(e,t){var n,o,r,a,i,s,l=0;for(n=e.get16(),l+=2;l<n;){if(l+=1,(r=15&(o=e.get8()))>3)throw new Error("ERROR: Huffman table ID > 3");if((a=o>>4)>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[r]=1,this.tc[r][a]=1,i=0;i<16;i+=1)this.l[r][a][i]=e.get8(),l+=1;for(i=0;i<16;i+=1)for(s=0;s<this.l[r][a][i];s+=1){if(l>n)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[r][a][i][s]=e.get8(),l+=1}}if(l!==n)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(i=0;i<4;i+=1)for(s=0;s<2;s+=1)0!==this.tc[i][s]&&this.buildHuffTable(t[i][s],this.l[i][s],this.v[i][s]);return 1},o.lossless.HuffmanTable.prototype.buildHuffTable=function(e,t,n){var r,a,i,s,l;for(256,a=0,i=0;i<8;i+=1)for(s=0;s<t[i];s+=1)for(l=0;l<256>>i+1;l+=1)e[a]=n[i][s]|i+1<<8,a+=1;for(i=1;a<256;i+=1,a+=1)e[a]=i|o.lossless.HuffmanTable.MSB;for(r=1,a=0,i=8;i<16;i+=1)for(s=0;s<t[i];s+=1){for(l=0;l<256>>i-7;l+=1)e[256*r+a]=n[i][s]|i+1<<8,a+=1;if(a>=256){if(a>256)throw new Error("ERROR: Huffman table error(1)!");a=0,r+=1}}},"undefined"!==typeof t&&t.exports&&(t.exports=o.lossless.HuffmanTable)},{"./data-stream.js":2,"./utils.js":10}],6:[function(e,t,n){"use strict";var o=o||{};o.lossless=o.lossless||{},o.lossless.ComponentSpec=o.lossless.ComponentSpec||(void 0!==e?e("./component-spec.js"):null),o.lossless.DataStream=o.lossless.DataStream||(void 0!==e?e("./data-stream.js"):null),o.lossless.Decoder=o.lossless.Decoder||(void 0!==e?e("./decoder.js"):null),o.lossless.FrameHeader=o.lossless.FrameHeader||(void 0!==e?e("./frame-header.js"):null),o.lossless.HuffmanTable=o.lossless.HuffmanTable||(void 0!==e?e("./huffman-table.js"):null),o.lossless.QuantizationTable=o.lossless.QuantizationTable||(void 0!==e?e("./quantization-table.js"):null),o.lossless.ScanComponent=o.lossless.ScanComponent||(void 0!==e?e("./scan-component.js"):null),o.lossless.ScanHeader=o.lossless.ScanHeader||(void 0!==e?e("./scan-header.js"):null),o.lossless.Utils=o.lossless.Utils||(void 0!==e?e("./utils.js"):null),"undefined"!==typeof t&&t.exports&&(t.exports=o)},{"./component-spec.js":1,"./data-stream.js":2,"./decoder.js":3,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-component.js":8,"./scan-header.js":9,"./utils.js":10}],7:[function(e,t,n){"use strict";var o=o||{};o.lossless=o.lossless||{},o.lossless.DataStream=o.lossless.DataStream||(void 0!==e?e("./data-stream.js"):null),o.lossless.Utils=o.lossless.Utils||(void 0!==e?e("./utils.js"):null),o.lossless.QuantizationTable=o.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=o.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},o.lossless.QuantizationTable.enhanceQuantizationTable=function(e,t){var n;for(n=0;n<8;n+=1)e[t[0+n]]*=90,e[t[32+n]]*=90,e[t[16+n]]*=118,e[t[48+n]]*=49,e[t[40+n]]*=71,e[t[8+n]]*=126,e[t[56+n]]*=25,e[t[24+n]]*=106;for(n=0;n<8;n+=1)e[t[0+8*n]]*=90,e[t[4+8*n]]*=90,e[t[2+8*n]]*=118,e[t[6+8*n]]*=49,e[t[5+8*n]]*=71,e[t[1+8*n]]*=126,e[t[7+8*n]]*=25,e[t[3+8*n]]*=106;for(n=0;n<64;n+=1)e[n]>>=6},o.lossless.QuantizationTable.prototype.read=function(e,t){var n,r,a,i,s=0;for(n=e.get16(),s+=2;s<n;){if(s+=1,(a=15&(r=e.get8()))>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[a]=r>>4,0===this.precision[a])this.precision[a]=8;else{if(1!==this.precision[a])throw new Error("ERROR: Quantization table precision error");this.precision[a]=16}if(this.tq[a]=1,8===this.precision[a]){for(i=0;i<64;i+=1){if(s>n)throw new Error("ERROR: Quantization table format error");this.quantTables[a][i]=e.get8(),s+=1}o.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[a],t)}else{for(i=0;i<64;i+=1){if(s>n)throw new Error("ERROR: Quantization table format error");this.quantTables[a][i]=e.get16(),s+=2}o.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[a],t)}}if(s!==n)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1},"undefined"!==typeof t&&t.exports&&(t.exports=o.lossless.QuantizationTable)},{"./data-stream.js":2,"./utils.js":10}],8:[function(e,t,n){"use strict";var o=o||{};o.lossless=o.lossless||{},o.lossless.ScanComponent=o.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0},"undefined"!==typeof t&&t.exports&&(t.exports=o.lossless.ScanComponent)},{}],9:[function(e,t,n){"use strict";var o=o||{};o.lossless=o.lossless||{},o.lossless.DataStream=o.lossless.DataStream||(void 0!==e?e("./data-stream.js"):null),o.lossless.ScanComponent=o.lossless.ScanComponent||(void 0!==e?e("./scan-component.js"):null),o.lossless.ScanHeader=o.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},o.lossless.ScanHeader.prototype.read=function(e){var t,n,r,a=0;for(t=e.get16(),a+=2,this.numComp=e.get8(),a+=1,n=0;n<this.numComp;n+=1){if(this.components[n]=new o.lossless.ScanComponent,a>t)throw new Error("ERROR: scan header format error");this.components[n].scanCompSel=e.get8(),a+=1,r=e.get8(),a+=1,this.components[n].dcTabSel=r>>4,this.components[n].acTabSel=15&r}if(this.selection=e.get8(),a+=1,this.spectralEnd=e.get8(),a+=1,r=e.get8(),this.ah=r>>4,this.al=15&r,(a+=1)!==t)throw new Error("ERROR: scan header format error [count!=Ns]");return 1},"undefined"!==typeof t&&t.exports&&(t.exports=o.lossless.ScanHeader)},{"./data-stream.js":2,"./scan-component.js":8}],10:[function(e,t,n){"use strict";var o=o||{};o.lossless=o.lossless||{},o.lossless.Utils=o.lossless.Utils||{},o.lossless.Utils.createArray=function(e){var t=new Array(e||0),n=e;if(arguments.length>1)for(var r=Array.prototype.slice.call(arguments,1);n--;)t[e-1-n]=o.lossless.Utils.createArray.apply(this,r);return t},"undefined"!==typeof t&&t.exports&&(t.exports=o.lossless.Utils)},{}]},{},[6])(6)}),function(e,t,n){"use strict";n.extractUncompressedPixels=function(e,t){var o=n.getPixelFormat(e),r=e.elements.x7fe00010,a=e.uint16("x00280010"),i=e.uint16("x00280011"),s=e.uint16("x00280002"),l=r.dataOffset,c=i*a*s,u=0;return 1===o?(u=l+t*c,new Uint8Array(e.byteArray.buffer,u,c)):2===o?(u=l+t*c*2,new Uint16Array(e.byteArray.buffer,u,c)):3===o?(u=l+t*c*2,new Int16Array(e.byteArray.buffer,u,c)):void 0}}($,cornerstone,cornerstoneWADOImageLoader),function(e){"use strict";e.getPixelFormat=function(e){var t=e.uint16("x00280103"),n=e.uint16("x00280100");return 0===t&&8===n?1:0===t&&16===n?2:1===t&&16===n?3:void 0}}(cornerstoneWADOImageLoader),function(e){"use strict";e.getPixelSpacing=function(e){var t=e.string("x00280030");if(t&&t.length>0){var n=t.split("\\");return{row:parseFloat(n[0]),column:parseFloat(n[1])}}return{row:void 0,column:void 0}}}(cornerstoneWADOImageLoader),function(e){"use strict";e.getRescaleSlopeAndIntercept=function(e){var t={intercept:0,slope:1},n=e.floatString("x00281052"),o=e.floatString("x00281053");return n&&o&&(t.intercept=n,t.slope=o),t}}(cornerstoneWADOImageLoader),function(e){"use strict";e.getWindowWidthAndCenter=function(e){var t={windowCenter:void 0,windowWidth:void 0},n=e.floatString("x00281050"),o=e.floatString("x00281051");return n&&o&&(t.windowCenter=n,t.windowWidth=o),t}}(cornerstoneWADOImageLoader),function(e){"use strict";e.isColorImage=function(e){return"RGB"===e||"PALETTE COLOR"===e||"YBR_FULL"===e||"YBR_FULL_422"===e||"YBR_PARTIAL_422"===e||"YBR_PARTIAL_420"===e||"YBR_RCT"===e||"YBR_ICT"===e}}(cornerstoneWADOImageLoader),function(e,t,n){"use strict";var o=document.createElement("canvas"),r="";n.makeColorImage=function(a,i,s){var l=n.getPixelSpacing(i),c=i.uint16("x00280010"),u=i.uint16("x00280011"),d=n.getRescaleSlopeAndIntercept(i),h=c*u*4,f=n.getWindowWidthAndCenter(i);r=void 0;var m,g=e.Deferred();try{m=function(e,t){if(!0===n.isJPEGBaseline8Bit(e))return n.decodeJPEGBaseline8Bit(o,e,t);var r=n.decodeTransferSyntax(e,t);return n.convertColorSpace(o,e,r)}(i,s)}catch(e){return g.reject(e),g}return m.then(function(e){var n={imageId:a,minPixelValue:0,maxPixelValue:255,slope:d.slope,intercept:d.intercept,windowCenter:f.windowCenter,windowWidth:f.windowWidth,render:t.renderColorImage,getPixelData:function(){return e.data},getImageData:function(){return e},getCanvas:function(){return r===a?o:(o.height=c,o.width=u,o.getContext("2d").putImageData(e,0,0),r=a,o)},rows:c,columns:u,height:c,width:u,color:!0,columnPixelSpacing:l.column,rowPixelSpacing:l.row,data:i,invert:!1,sizeInBytes:h};void 0===n.windowCenter&&(n.windowWidth=255,n.windowCenter=128),g.resolve(n)},function(e){g.reject(e)}),g}}($,cornerstone,cornerstoneWADOImageLoader),function(e,t,n){"use strict";n.makeGrayscaleImage=function(o,r,a){var i,s=e.Deferred(),l=n.getPixelSpacing(r),c=r.uint16("x00280010"),u=r.uint16("x00280011"),d=n.getRescaleSlopeAndIntercept(r);try{i=function(e){var t=n.getPixelFormat(e);if(1===t)return 1;if(2===t||3===t)return 2;throw"unknown pixel format"}(r)}catch(e){return s.reject(e),s}var h,f=c*u*i,m="MONOCHROME1"===r.string("x00280004"),g=n.getWindowWidthAndCenter(r);try{h=n.decodeTransferSyntax(r,a)}catch(e){return s.reject(e),s}var p=function(e){for(var t=65535,n=-32768,o=e.length,r=e,a=0;a<o;a++){var i=r[a];t=Math.min(t,i),n=Math.max(n,i)}return{min:t,max:n}}(h),v={imageId:o,minPixelValue:p.min,maxPixelValue:p.max,slope:d.slope,intercept:d.intercept,windowCenter:g.windowCenter,windowWidth:g.windowWidth,render:t.renderGrayscaleImage,getPixelData:function(){return h},rows:c,columns:u,height:c,width:u,color:!1,columnPixelSpacing:l.column,rowPixelSpacing:l.row,data:r,invert:m,sizeInBytes:f};if(void 0===v.windowCenter){var y=v.maxPixelValue*v.slope+v.intercept,w=v.minPixelValue*v.slope+v.intercept;v.windowWidth=y-w,v.windowCenter=(y+w)/2}return s.resolve(v),s}}($,cornerstone,cornerstoneWADOImageLoader),function(e){"use strict";e.version="0.7.0"}(cornerstoneWADOImageLoader),function(e,t,n){"use strict";n.internal.xhrRequest=function(o,r,a){var i=e.Deferred(),s=new XMLHttpRequest;return s.responseType="arraybuffer",s.open("get",a,!0),n.internal.options.beforeSend(s),s.onreadystatechange=function(e){if(4===s.readyState)if(200===s.status){var t=s.response,l=new Uint8Array(t),c=dicomParser.parseDicom(l);void 0!==r&&(n.internal.multiFrameCacheHack[a]=c),n.createImageObject(c,o,r).then(function(e){i.resolve(e)},function(e){i.reject(e)})}else i.reject(s.response)},s.onprogress=function(n){if(n.lengthComputable){var r=n.loaded,a=n.total,i=Math.round(r/a*100);e(t).trigger("CornerstoneImageLoadProgress",{imageId:o,loaded:r,total:a,percentComplete:i})}},s.send(),i}}($,cornerstone,cornerstoneWADOImageLoader),
/*! cornerstoneWebImageLoader - v0.5.2 - 2015-09-06 | (c) 2015 Chris Hafey | https://github.com/chafey/cornerstoneWebImageLoader */
cornerstoneWebImageLoader={},function(e,t,n){"use strict";var o=document.createElement("canvas"),r="",a={beforeSend:function(e){}};function i(n){var i=e.Deferred(),s=new Image,l=new XMLHttpRequest;return l.responseType="arraybuffer",l.open("GET",n,!0),a.beforeSend(l),l.onload=function(e){var a=new Uint8Array(this.response),l=new Blob([a],{type:"image/jpeg"}),c=window.URL||window.webkitURL,u=c.createObjectURL(l);s.src=u,s.onload=function(){var e=function(e,n){var a=e.naturalHeight,i=e.naturalWidth;function s(){var t;return r!==n?(o.height=e.naturalHeight,o.width=e.naturalWidth,(t=o.getContext("2d")).drawImage(e,0,0),r=n):t=o.getContext("2d"),t.getImageData(0,0,e.naturalWidth,e.naturalHeight)}return{imageId:n,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:127,windowWidth:256,render:t.renderColorImage,getPixelData:function(){for(var t=s().data,n=e.naturalHeight*e.naturalWidth,o=new Uint8Array(4*n),r=0,a=0,i=0;i<n;i++)o[a++]=t[r++],o[a++]=t[r++],o[a++]=t[r++],o[a++]=255,r++;return o},getImageData:s,getCanvas:function(){return r===n?o:(o.height=e.naturalHeight,o.width=e.naturalWidth,o.getContext("2d").drawImage(e,0,0),r=n,o)},getImage:function(){return e},rows:a,columns:i,height:a,width:i,color:!0,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:a*i*4}}(s,n);i.resolve(e),c.revokeObjectURL(u)},s.onerror=function(){c.revokeObjectURL(u),i.reject()}},l.onprogress=function(o){if(o.lengthComputable){var r=o.loaded,a=o.total,i=Math.round(r/a*100);e(t).trigger("CornerstoneImageLoadProgress",{imageId:n,loaded:r,total:a,percentComplete:i})}},l.send(),i}t.registerImageLoader("http",i),t.registerImageLoader("https",i),n.configure=function(e){a=e}}($,cornerstone,cornerstoneWebImageLoader),
/*! dicom-parser - v1.1.5 - 2015-08-12 | (c) 2014 Chris Hafey | https://github.com/chafey/dicomParser */
function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"==typeof cornerstone&&(dicomParser={},"undefined"!=typeof Package&&(e.dicomParser=dicomParser)),dicomParser=t())}(this,function(){var e;return e=function(e){"use strict";return void 0===e&&(e={}),e.version="1.1.5",e}(e=function(e){"use strict";return void 0===e&&(e={}),e.readTag=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";return"x"+("00000000"+(256*e.readUint16()*256+e.readUint16()).toString(16)).substr(-8)},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.readSequenceItem=function(t){if(void 0===t)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";return{tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position}},e}(e=function(e){"use strict";function t(t){var n=e.readSequenceItem(t);return 4294967295===n.length?(n.hadUndefinedLength=!0,n.dataSet=function(t){for(var n={};t.position<t.byteArray.length;){var o=e.readDicomElementImplicit(t);if(n[o.tag]=o,"xfffee00d"===o.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,n)}return t.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,n)}(t),n.length=t.position-n.dataOffset):(n.dataSet=new e.DataSet(t.byteArrayParser,t.byteArray,{}),e.parseDicomDataSetImplicit(n.dataSet,t,t.position+n.length)),n}return void 0===e&&(e={}),e.readSequenceItemsImplicit=function(n,o){if(void 0===n)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===o)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";o.items=[],4294967295===o.length?function(n,o){for(;n.position<n.byteArray.length;){var r=e.readTag(n);if(n.seek(-4),"xfffee0dd"===r)return o.length=n.position-o.dataOffset,n.seek(8),o;var a=t(n);o.items.push(a)}o.length=n.byteArray.length-o.dataOffset}(n,o):function(e,n){for(var o=n.dataOffset+n.length;e.position<o;){var r=t(e);n.items.push(r)}}(n,o)},e}(e=function(e){"use strict";function t(t,n){var o=e.readSequenceItem(t);return 4294967295===o.length?(o.hadUndefinedLength=!0,o.dataSet=function(t,n){for(var o={};t.position<t.byteArray.length;){var r=e.readDicomElementExplicit(t,n);if(o[r.tag]=r,"xfffee00d"===r.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,o)}return t.warnings.push("eof encountered before finding sequence delimitation item while reading sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,o)}(t,n),o.length=t.position-o.dataOffset):(o.dataSet=new e.DataSet(t.byteArrayParser,t.byteArray,{}),e.parseDicomDataSetExplicit(o.dataSet,t,t.position+o.length)),o}return void 0===e&&(e={}),e.readSequenceItemsExplicit=function(n,o,r){if(void 0===n)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===o)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";o.items=[],4294967295===o.length?function(n,o,r){for(;n.position<n.byteArray.length;){var a=e.readTag(n);if(n.seek(-4),"xfffee0dd"===a)return o.length=n.position-o.dataOffset,n.seek(8),o;var i=t(n,r);o.items.push(i)}o.length=n.position-o.dataOffset}(n,o):function(e,n,o){for(var r=n.dataOffset+n.length;e.position<r;){var a=t(e,o);n.items.push(a)}}(n,o,r)},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.readDicomElementImplicit=function(t,n){if(void 0===t)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var o={tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position};if(4294967295===o.length&&(o.hadUndefinedLength=!0),o.tag===n)return o;if(t.position+4<=t.byteArray.length){var r=e.readTag(t);if(t.seek(-4),o.hadUndefinedLength&&"xfffee0dd"===r)return o.length=0,t.seek(8),o;if("xfffee000"===r)return e.readSequenceItemsImplicit(t,o),o}return 4294967295===o.length?(e.findItemDelimitationItemAndSetElementLength(t,o),o):(t.seek(o.length),o)},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.readDicomElementExplicit=function(t,n,o){if(void 0===t)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var r,a={tag:e.readTag(t),vr:t.readFixedString(2)};return 2===("OB"===(r=a.vr)||"OW"===r||"SQ"===r||"OF"===r||"UT"===r||"UN"===r?4:2)?(a.length=t.readUint16(),a.dataOffset=t.position):(t.seek(2),a.length=t.readUint32(),a.dataOffset=t.position),4294967295===a.length&&(a.hadUndefinedLength=!0),a.tag===o?a:"SQ"===a.vr?(e.readSequenceItemsExplicit(t,a,n),a):4294967295===a.length?"x7fe00010"===a.tag?(e.findEndOfEncapsulatedElement(t,a,n),a):(e.findItemDelimitationItemAndSetElementLength(t,a),a):(t.seek(a.length),a)},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.parseDicomDataSetExplicit=function(t,n,o,r){if(o=void 0===o?n.byteArray.length:o,r=r||{},void 0===n)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(o<n.position||o>n.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var a=t.elements;n.position<o;){var i=e.readDicomElementExplicit(n,t.warnings,r.untilTag);if(a[i.tag]=i,i.tag===r.untilTag)return}if(n.position>o)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},e.parseDicomDataSetImplicit=function(t,n,o,r){if(o=void 0===o?t.byteArray.length:o,r=r||{},void 0===n)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(o<n.position||o>n.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var a=t.elements;n.position<o;){var i=e.readDicomElementImplicit(n,r.untilTag);if(a[i.tag]=i,i.tag===r.untilTag)return}},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.littleEndianByteArrayParser={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8);return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7],new Float64Array(n.buffer)[0]}},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.findItemDelimitationItemAndSetElementLength=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=e.byteArray.length-8;e.position<=n;){if(65534===e.readUint16())if(57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position"+e.position-4+" while reading element of undefined length with tag ' + element.tag"),void(t.length=e.position-t.dataOffset)}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.findEndOfEncapsulatedElement=function(t,n,o){if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===n)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(n.encapsulatedPixelData=!0,n.basicOffsetTable=[],n.fragments=[],"xfffee000"!==e.readTag(t))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var r=t.readUint32()/4,a=0;a<r;a++){var i=t.readUint32();n.basicOffsetTable.push(i)}for(var s=t.position;t.position<t.byteArray.length;){var l=e.readTag(t),c=t.readUint32();if("xfffee0dd"===l)return t.seek(c),void(n.length=t.position-n.dataOffset);if("xfffee000"!==l)return o&&o.push("unexpected tag "+l+" while searching for end of pixel data element with undefined length"),c>t.byteArray.length-t.position&&(c=t.byteArray.length-t.position),n.fragments.push({offset:t.position-s-8,position:t.position,length:c}),t.seek(c),void(n.length=t.position-n.dataOffset);n.fragments.push({offset:t.position-s-8,position:t.position,length:c}),t.seek(c)}o&&o.push("pixel data element "+n.tag+" missing sequence delimiter tag xfffee0dd")},e}(e=function(e){"use strict";function t(e,t){return void 0!==e.parser?e.parser:t}return void 0===e&&(e={}),e.DataSet=function(e,t,n){this.byteArrayParser=e,this.byteArray=t,this.elements=n},e.DataSet.prototype.uint16=function(e,n){var o=this.elements[e];if(n=void 0!==n?n:0,o&&0!==o.length)return t(o,this.byteArrayParser).readUint16(this.byteArray,o.dataOffset+2*n)},e.DataSet.prototype.int16=function(e,n){var o=this.elements[e];if(n=void 0!==n?n:0,o&&0!==o.length)return t(o,this.byteArrayParser).readInt16(this.byteArray,o.dataOffset+2*n)},e.DataSet.prototype.uint32=function(e,n){var o=this.elements[e];if(n=void 0!==n?n:0,o&&0!==o.length)return t(o,this.byteArrayParser).readUint32(this.byteArray,o.dataOffset+4*n)},e.DataSet.prototype.int32=function(e,n){var o=this.elements[e];if(n=void 0!==n?n:0,o&&0!==o.length)return t(o,this.byteArrayParser).readInt32(this.byteArray,o.dataOffset+4*n)},e.DataSet.prototype.float=function(e,n){var o=this.elements[e];if(n=void 0!==n?n:0,o&&0!==o.length)return t(o,this.byteArrayParser).readFloat(this.byteArray,o.dataOffset+4*n)},e.DataSet.prototype.double=function(e,n){var o=this.elements[e];if(n=void 0!==n?n:0,o&&0!==o.length)return t(o,this.byteArrayParser).readDouble(this.byteArray,o.dataOffset+8*n)},e.DataSet.prototype.numStringValues=function(t){var n=this.elements[t];if(n&&n.length>0){var o=e.readFixedString(this.byteArray,n.dataOffset,n.length).match(/\\/g);return null===o?1:o.length+1}},e.DataSet.prototype.string=function(t,n){var o=this.elements[t];if(o&&o.length>0){var r=e.readFixedString(this.byteArray,o.dataOffset,o.length);return n>=0?r.split("\\")[n].trim():r.trim()}},e.DataSet.prototype.text=function(t,n){var o=this.elements[t];if(o&&o.length>0){var r=e.readFixedString(this.byteArray,o.dataOffset,o.length);return n>=0?r.split("\\")[n].replace(/ +$/,""):r.replace(/ +$/,"")}},e.DataSet.prototype.floatString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var o=this.string(e,t);if(void 0!==o)return parseFloat(o)}},e.DataSet.prototype.intString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var o=this.string(e,t);if(void 0!==o)return parseInt(o)}},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.ByteStream=function(e,t,n){if(void 0===e)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(t instanceof Uint8Array==!1)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array";if(n<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(n>=t.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=e,this.byteArray=t,this.position=n||0,this.warnings=[]},e.ByteStream.prototype.seek=function(e){if(this.position+e<0)throw"cannot seek to position < 0";this.position+=e},e.ByteStream.prototype.readByteStream=function(t){if(this.position+t>this.byteArray.length)throw"readByteStream - buffer overread";var n=new Uint8Array(this.byteArray.buffer,this.position,t);return this.position+=t,new e.ByteStream(this.byteArrayParser,n)},e.ByteStream.prototype.readUint16=function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e},e.ByteStream.prototype.readUint32=function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e},e.ByteStream.prototype.readFixedString=function(t){var n=e.readFixedString(this.byteArray,this.position,t);return this.position+=t,n},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.readFixedString=function(e,t,n){if(n<0)throw"readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var o="",r=0;r<n;r++){var a=e[t+r];if(0===a)return t+=n,o;o+=String.fromCharCode(a)}return o},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.bigEndianByteArrayParser={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=(e[t]<<8)+e[t+1];return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);return n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3],new Float32Array(n.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);return n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7],new Float64Array(n.buffer)[0]}},e}(e=function(e){"use strict";function t(t,n){for(var o=[],r=0;t.position<n&&t.position<t.byteArray.length;){var a=e.readSequenceItem(t);if("xfffee0dd"===a.tag)break;o.push(a),t.seek(a.length),r+=a.length}return function(e,t,n){if(1===t.length)return new Uint8Array(e.byteArray.buffer,t[0].dataOffset,t[0].length);for(var o=new Uint8Array(n),r=0,a=0;a<t.length;a++)for(var i=t[a].dataOffset,s=0;s<t[a].length;s++)o[r++]=e.byteArray[i++];return o}(t,o,r)}return void 0===e&&(e={}),e.readEncapsulatedPixelData=function(n,o,r){if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===o)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==o.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==o.encapsulatedPixelData)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(!0!==o.hadUndefinedLength)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===o.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===o.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";var a=new e.ByteStream(n.byteArrayParser,n.byteArray,o.dataOffset),i=e.readSequenceItem(a);if("xfffee000"!==i.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";return a.seek(i.length),0!==o.basicOffsetTable.length?function(e,n,o){if(o>e.basicOffsetTable.length)throw"dicomParser.readEncapsulatedPixelData: parameter frame exceeds number of frames in basic offset table";var r=e.basicOffsetTable[o];n.seek(r);var a=e.basicOffsetTable[o+1];return void 0===a&&(a=n.position+e.length),t(n,a)}(o,a,r):function(e,n,o){if(0!==o)throw"dicomParser.readEncapsulatedPixelData: non zero frame specified for single frame encapsulated pixel data";return t(n,n.position+e.length)}(o,a,r)},e}(e=function(e){"use strict";void 0===e&&(e={});var t={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};return e.isStringVr=function(e){return t[e]},e.isPrivateTag=function(e){return parseInt(e[4])%2==1},e.parsePN=function(e){if(void 0!==e){var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}}},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.parseTM=function(e,t){if(e.length>=2){var n=parseInt(e.substring(0,2),10),o=e.length>=4?parseInt(e.substring(2,4),10):void 0,r=e.length>=6?parseInt(e.substring(4,6),10):void 0,a=e.length>=8?parseInt(e.substring(7,13),10):void 0;if(t&&(isNaN(n)||void 0!==o&&isNaN(o)||void 0!==r&&isNaN(r)||void 0!==a&&isNaN(a)||n<0||n>23||o&&(o<0||o>59)||r&&(r<0||r>59)||a&&(a<0||a>999999)))throw"invalid TM '"+e+"'";return{hours:n,minutes:o,seconds:r,fractionalSeconds:a}}if(t)throw"invalid TM '"+e+"'"},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.parseDA=function(e,t){if(e&&8===e.length){var n=parseInt(e.substring(0,4),10),o=parseInt(e.substring(4,6),10),r=parseInt(e.substring(6,8),10);if(t&&!0!=(a=r,i=o,s=n,!isNaN(s)&&i>0&&i<=12&&a>0&&a<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(i,s)))throw"invalid DA '"+e+"'";return{year:n,month:o,day:r}}var a,i,s;if(t)throw"invalid DA '"+e+"'"},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.explicitElementToString=function(t,n){if(void 0===t||void 0===n)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===n.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var o,r=n.vr,a=n.tag;function i(e,n){for(var o="",r=0;r<e;r++)0!==r&&(o+="/"),o+=n.call(t,a).toString();return o}if(!0===e.isStringVr(r))o=t.string(a);else{if("AT"==r){var s=t.uint32(a);if(void 0===s)return;return s<0&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase()}"US"==r?o=i(n.length/2,t.uint16):"SS"===r?o=i(n.length/2,t.int16):"UL"==r?o=i(n.length/4,t.uint32):"SL"===r?o=i(n.length/4,t.int32):"FD"==r?o=i(n.length/8,t.double):"FL"==r&&(o=i(n.length/4,t.float))}return o},e}(e=function(e){"use strict";return void 0===e&&(e={}),e.explicitDataSetToJS=function(t,n){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";n=n||{omitPrivateAttibutes:!0,maxElementLength:128};var o={};for(var r in t.elements){var a=t.elements[r];if(!0!==n.omitPrivateAttibutes||!e.isPrivateTag(r))if(a.items){for(var i=[],s=0;s<a.items.length;s++)i.push(e.explicitDataSetToJS(a.items[s].dataSet,n));o[r]=i}else{var l;l=void 0,a.length<n.maxElementLength&&(l=e.explicitElementToString(t,a)),o[r]=void 0!==l?l:{dataOffset:a.dataOffset,length:a.length}}}return o},e}(e=function(e){return void 0===e&&(e={}),e.parseDicom=function(t,n){if(void 0===t)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";var o,r=new e.ByteStream(e.littleEndianByteArrayParser,t);function a(){!function(){if(r.seek(128),"DICM"!==r.readFixedString(4))throw"dicomParser.parseDicom: DICM prefix not found at location 132"}();for(var t=[],n={};r.position<r.byteArray.length;){var o=r.position,a=e.readDicomElementExplicit(r,t);if(a.tag>"x0002ffff"){r.position=o;break}a.parser=e.littleEndianByteArrayParser,n[a.tag]=a}var i=new e.DataSet(r.byteArrayParser,r.byteArray,n);return i.warnings=r.warnings,i}function i(o){var a=function(t){if(void 0===t.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var n=t.elements.x00020010;return e.readFixedString(r.byteArray,n.dataOffset,n.length)}(o),i=function(e){return"1.2.840.10008.1.2"!==e}(a),s=function(n){return"1.2.840.10008.1.2.2"===n?new e.ByteStream(e.bigEndianByteArrayParser,t,r.position):new e.ByteStream(e.littleEndianByteArrayParser,t,r.position)}(a),l=new e.DataSet(s.byteArrayParser,s.byteArray,{});l.warnings=s.warnings;try{i?e.parseDicomDataSetExplicit(l,s,s.byteArray.length,n):e.parseDicomDataSetImplicit(l,s,s.byteArray.length,n)}catch(e){throw{exception:e,dataSet:l}}return l}return function(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(o=a(),i(o))},e}(e))))))))))))))))))))))});var JpxImage=function(){var e={LL:0,LH:1,HL:1,HH:2};function t(){this.failOnCorruptedImage=!1}function n(e,t){e.x0=Math.ceil(t.XOsiz/e.XRsiz),e.x1=Math.ceil(t.Xsiz/e.XRsiz),e.y0=Math.ceil(t.YOsiz/e.YRsiz),e.y1=Math.ceil(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function o(e,t){for(var n,o=e.SIZ,r=[],a=Math.ceil((o.Xsiz-o.XTOsiz)/o.XTsiz),i=Math.ceil((o.Ysiz-o.YTOsiz)/o.YTsiz),s=0;s<i;s++)for(var l=0;l<a;l++)(n={}).tx0=Math.max(o.XTOsiz+l*o.XTsiz,o.XOsiz),n.ty0=Math.max(o.YTOsiz+s*o.YTsiz,o.YOsiz),n.tx1=Math.min(o.XTOsiz+(l+1)*o.XTsiz,o.Xsiz),n.ty1=Math.min(o.YTOsiz+(s+1)*o.YTsiz,o.Ysiz),n.width=n.tx1-n.tx0,n.height=n.ty1-n.ty0,n.components=[],r.push(n);e.tiles=r;for(var c=0,u=o.Csiz;c<u;c++)for(var d=t[c],h=0,f=r.length;h<f;h++){var m={};n=r[h],m.tcx0=Math.ceil(n.tx0/d.XRsiz),m.tcy0=Math.ceil(n.ty0/d.YRsiz),m.tcx1=Math.ceil(n.tx1/d.XRsiz),m.tcy1=Math.ceil(n.ty1/d.YRsiz),m.width=m.tcx1-m.tcx0,m.height=m.tcy1-m.tcy0,n.components[c]=m}}function r(e,t,n){var o=t.codingStyleParameters,r={};return o.entropyCoderWithCustomPrecincts?(r.PPx=o.precinctsSizes[n].PPx,r.PPy=o.precinctsSizes[n].PPy):(r.PPx=15,r.PPy=15),r.xcb_=n>0?Math.min(o.xcb,r.PPx-1):Math.min(o.xcb,r.PPx),r.ycb_=n>0?Math.min(o.ycb,r.PPy-1):Math.min(o.ycb,r.PPy),r}function a(e,t,n){var o=1<<n.PPx,r=1<<n.PPy,a=0===t.resLevel,i=1<<n.PPx+(a?0:-1),s=1<<n.PPy+(a?0:-1),l=t.trx1>t.trx0?Math.ceil(t.trx1/o)-Math.floor(t.trx0/o):0,c=t.try1>t.try0?Math.ceil(t.try1/r)-Math.floor(t.try0/r):0,u=l*c;t.precinctParameters={precinctWidth:o,precinctHeight:r,numprecinctswide:l,numprecinctshigh:c,numprecincts:u,precinctWidthInSubband:i,precinctHeightInSubband:s}}function i(e,t,n){var o,r,a,i,s=n.xcb_,l=n.ycb_,c=1<<s,u=1<<l,d=t.tbx0>>s,h=t.tby0>>l,f=t.tbx1+c-1>>s,m=t.tby1+u-1>>l,g=t.resolution.precinctParameters,p=[],v=[];for(r=h;r<m;r++)for(o=d;o<f;o++){if((a={cbx:o,cby:r,tbx0:c*o,tby0:u*r,tbx1:c*(o+1),tby1:u*(r+1)}).tbx0_=Math.max(t.tbx0,a.tbx0),a.tby0_=Math.max(t.tby0,a.tby0),a.tbx1_=Math.min(t.tbx1,a.tbx1),a.tby1_=Math.min(t.tby1,a.tby1),i=Math.floor((a.tbx0_-t.tbx0)/g.precinctWidthInSubband)+Math.floor((a.tby0_-t.tby0)/g.precinctHeightInSubband)*g.numprecinctswide,a.precinctNumber=i,a.subbandType=t.type,a.Lblock=3,!(a.tbx1_<=a.tbx0_||a.tby1_<=a.tby0_)){p.push(a);var y=v[i];void 0!==y?(o<y.cbxMin?y.cbxMin=o:o>y.cbxMax&&(y.cbxMax=o),r<y.cbyMin?y.cbxMin=r:r>y.cbyMax&&(y.cbyMax=r)):v[i]=y={cbxMin:o,cbyMin:r,cbxMax:o,cbyMax:r},a.precinct=y}}t.codeblockParameters={codeblockWidth:s,codeblockHeight:l,numcodeblockwide:f-d+1,numcodeblockhigh:m-h+1},t.codeblocks=p,t.precincts=v}function s(e,t,n){for(var o=[],r=e.subbands,a=0,i=r.length;a<i;a++)for(var s=r[a].codeblocks,l=0,c=s.length;l<c;l++){var u=s[l];u.precinctNumber===t&&o.push(u)}return{layerNumber:n,codeblocks:o}}function l(e,t,n,o,r){var a=e*o.minWidth,i=t*o.minHeight;if(a%n.width!=0||i%n.height!=0)return null;var s=i/n.width*r.precinctParameters.numprecinctswide;return a/n.height+s}function c(e){for(var t=e.components.length,n=Number.MAX_VALUE,o=Number.MAX_VALUE,r=0,a=0,i=new Array(t),s=0;s<t;s++){for(var l=e.components[s],c=l.codingStyleParameters.decompositionLevelsCount,u=new Array(c+1),d=Number.MAX_VALUE,h=Number.MAX_VALUE,f=0,m=0,g=1,p=c;p>=0;--p){var v=l.resolutions[p],y=g*v.precinctParameters.precinctWidth,w=g*v.precinctParameters.precinctHeight;d=Math.min(d,y),h=Math.min(h,w),f=Math.max(f,v.precinctParameters.numprecinctswide),m=Math.max(m,v.precinctParameters.numprecinctshigh),u[p]={width:y,height:w},g<<=1}n=Math.min(n,d),o=Math.min(o,h),r=Math.max(r,f),a=Math.max(a,m),i[s]={resolutions:u,minWidth:d,minHeight:h,maxNumWide:f,maxNumHigh:m}}return{components:i,minWidth:n,minHeight:o,maxNumWide:r,maxNumHigh:a}}function u(e){for(var t=e.SIZ,n=e.currentTile.index,o=e.tiles[n],u=t.Csiz,d=0;d<u;d++){for(var h=o.components[d],f=h.codingStyleParameters.decompositionLevelsCount,m=[],g=[],p=0;p<=f;p++){var v,y=r(0,h,p),w={},T=1<<f-p;if(w.trx0=Math.ceil(h.tcx0/T),w.try0=Math.ceil(h.tcy0/T),w.trx1=Math.ceil(h.tcx1/T),w.try1=Math.ceil(h.tcy1/T),w.resLevel=p,a(0,w,y),m.push(w),0===p)(v={}).type="LL",v.tbx0=Math.ceil(h.tcx0/T),v.tby0=Math.ceil(h.tcy0/T),v.tbx1=Math.ceil(h.tcx1/T),v.tby1=Math.ceil(h.tcy1/T),v.resolution=w,i(0,v,y),g.push(v),w.subbands=[v];else{var x=1<<f-p+1,b=[];(v={}).type="HL",v.tbx0=Math.ceil(h.tcx0/x-.5),v.tby0=Math.ceil(h.tcy0/x),v.tbx1=Math.ceil(h.tcx1/x-.5),v.tby1=Math.ceil(h.tcy1/x),v.resolution=w,i(0,v,y),g.push(v),b.push(v),(v={}).type="LH",v.tbx0=Math.ceil(h.tcx0/x),v.tby0=Math.ceil(h.tcy0/x-.5),v.tbx1=Math.ceil(h.tcx1/x),v.tby1=Math.ceil(h.tcy1/x-.5),v.resolution=w,i(0,v,y),g.push(v),b.push(v),(v={}).type="HH",v.tbx0=Math.ceil(h.tcx0/x-.5),v.tby0=Math.ceil(h.tcy0/x-.5),v.tbx1=Math.ceil(h.tcx1/x-.5),v.tby1=Math.ceil(h.tcy1/x-.5),v.resolution=w,i(0,v,y),g.push(v),b.push(v),w.subbands=b}}h.resolutions=m,h.subbands=g}var C=o.codingStyleDefaultParameters.progressionOrder;switch(C){case 0:o.packetsIterator=new function(e){for(var t=e.SIZ,n=e.currentTile.index,o=e.tiles[n],r=o.codingStyleDefaultParameters.layersCount,a=t.Csiz,i=0,l=0;l<a;l++)i=Math.max(i,o.components[l].codingStyleParameters.decompositionLevelsCount);var c=0,u=0,d=0,h=0;this.nextPacket=function(){for(;c<r;c++){for(;u<=i;u++){for(;d<a;d++){var e=o.components[d];if(!(u>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[u],n=t.precinctParameters.numprecincts;h<n;){var l=s(t,h,c);return h++,l}h=0}}d=0}u=0}}}(e);break;case 1:o.packetsIterator=new function(e){for(var t=e.SIZ,n=e.currentTile.index,o=e.tiles[n],r=o.codingStyleDefaultParameters.layersCount,a=t.Csiz,i=0,l=0;l<a;l++)i=Math.max(i,o.components[l].codingStyleParameters.decompositionLevelsCount);var c=0,u=0,d=0,h=0;this.nextPacket=function(){for(;c<=i;c++){for(;u<r;u++){for(;d<a;d++){var e=o.components[d];if(!(c>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[c],n=t.precinctParameters.numprecincts;h<n;){var l=s(t,h,u);return h++,l}h=0}}d=0}u=0}}}(e);break;case 2:o.packetsIterator=new function(e){var t,n,o,r,a=e.SIZ,i=e.currentTile.index,l=e.tiles[i],c=l.codingStyleDefaultParameters.layersCount,u=a.Csiz,d=0;for(o=0;o<u;o++){var h=l.components[o];d=Math.max(d,h.codingStyleParameters.decompositionLevelsCount)}var f=new Int32Array(d+1);for(n=0;n<=d;++n){var m=0;for(o=0;o<u;++o){var g=l.components[o].resolutions;n<g.length&&(m=Math.max(m,g[n].precinctParameters.numprecincts))}f[n]=m}t=0,n=0,o=0,r=0,this.nextPacket=function(){for(;n<=d;n++){for(;r<f[n];r++){for(;o<u;o++){var e=l.components[o];if(!(n>e.codingStyleParameters.decompositionLevelsCount)){var a=e.resolutions[n],i=a.precinctParameters.numprecincts;if(!(r>=i)){for(;t<c;){var h=s(a,r,t);return t++,h}t=0}}}o=0}r=0}}}(e);break;case 3:o.packetsIterator=new function(e){var t=e.SIZ,n=e.currentTile.index,o=e.tiles[n],r=o.codingStyleDefaultParameters.layersCount,a=t.Csiz,i=c(o),u=i,d=0,h=0,f=0,m=0,g=0;this.nextPacket=function(){for(;g<u.maxNumHigh;g++){for(;m<u.maxNumWide;m++){for(;f<a;f++){for(var e=o.components[f],t=e.codingStyleParameters.decompositionLevelsCount;h<=t;h++){var n=e.resolutions[h],c=i.components[f].resolutions[h],p=l(m,g,c,u,n);if(null!==p){for(;d<r;){var v=s(n,p,d);return d++,v}d=0}}h=0}f=0}m=0}}}(e);break;case 4:o.packetsIterator=new function(e){var t=e.SIZ,n=e.currentTile.index,o=e.tiles[n],r=o.codingStyleDefaultParameters.layersCount,a=t.Csiz,i=c(o),u=0,d=0,h=0,f=0,m=0;this.nextPacket=function(){for(;h<a;++h){for(var e=o.components[h],t=i.components[h],n=e.codingStyleParameters.decompositionLevelsCount;m<t.maxNumHigh;m++){for(;f<t.maxNumWide;f++){for(;d<=n;d++){var c=e.resolutions[d],g=t.resolutions[d],p=l(f,m,g,t,c);if(null!==p){for(;u<r;){var v=s(c,p,u);return u++,v}u=0}}d=0}f=0}m=0}}}(e);break;default:throw new Error("JPX Error: Unsupported progression order "+C)}}function d(e,t,n,o){var r,a=0,i=0,s=!1;function l(e){for(;i<e;){if(n+a>=t.length)throw new Error("Unexpected EOF");var o=t[n+a];a++,s?(r=r<<7|o,i+=7,s=!1):(r=r<<8|o,i+=8),255===o&&(s=!0)}return r>>>(i-=e)&(1<<e)-1}function c(e){return 255===t[n+a-1]&&t[n+a]===e?(u(1),!0):255===t[n+a]&&t[n+a+1]===e&&(u(2),!0)}function u(e){a+=e}function d(){i=0,s&&(a++,s=!1)}function h(){if(0===l(1))return 1;if(0===l(1))return 2;var e=l(2);return e<3?e+3:(e=l(5))<31?e+6:(e=l(7))+37}for(var f=e.currentTile.index,m=e.tiles[f],v=e.COD.sopMarkerUsed,y=e.COD.ephMarkerUsed,w=m.packetsIterator;a<o;)try{d(),v&&c(145)&&u(4);var T=w.nextPacket();if(void 0===T)return;if(!l(1))continue;for(var x,b=T.layerNumber,C=[],P=0,S=T.codeblocks.length;P<S;P++){var M=(x=T.codeblocks[P]).precinct,I=x.cbx-M.cbxMin,D=x.cby-M.cbyMin,k=!1,E=!1;if(void 0!==x.included)k=!!l(1);else{var A,R;if(void 0!==(M=x.precinct).inclusionTree)A=M.inclusionTree;else{var O=M.cbxMax-M.cbxMin+1,L=M.cbyMax-M.cbyMin+1;A=new p(O,L),R=new g(O,L),M.inclusionTree=A,M.zeroBitPlanesTree=R}for(A.reset(I,D,b);;){if(a>=t.length)return;if(A.isAboveThreshold())break;if(A.isKnown())A.nextLevel();else if(l(1)){if(A.setKnown(),A.isLeaf()){x.included=!0,k=E=!0;break}A.nextLevel()}else A.incrementValue()}}if(k){if(E){for((R=M.zeroBitPlanesTree).reset(I,D);;){if(a>=t.length)return;if(l(1)){if(!R.nextLevel())break}else R.incrementValue()}x.zeroBitPlanes=R.value}for(var B=h();l(1);)x.Lblock++;var U=log2(B),z=l((B<1<<U?U-1:U)+x.Lblock);C.push({codeblock:x,codingpasses:B,dataLength:z})}}for(d(),y&&c(146);C.length>0;){var F=C.shift();void 0===(x=F.codeblock).data&&(x.data=[]),x.data.push({data:t,start:n+a,end:n+a+F.dataLength,codingpasses:F.codingpasses}),a+=F.dataLength}}catch(e){return}return a}function h(e,t,n,o,r,a,i,s){for(var l=o.tbx0,c=o.tby0,u=o.tbx1-o.tbx0,d=o.codeblocks,h="H"===o.type.charAt(0)?1:0,f="H"===o.type.charAt(1)?t:0,m=0,g=d.length;m<g;++m){var p=d[m],y=p.tbx1_-p.tbx0_,w=p.tby1_-p.tby0_;if(0!==y&&0!==w&&void 0!==p.data){var T,x;T=new v(y,w,p.subbandType,p.zeroBitPlanes,a),x=2;var b,C,P,S=p.data,M=0,I=0;for(b=0,C=S.length;b<C;b++)M+=(P=S[b]).end-P.start,I+=P.codingpasses;var D=new Int16Array(M),k=0;for(b=0,C=S.length;b<C;b++){var E=(P=S[b]).data.subarray(P.start,P.end);D.set(E,k),k+=E.length}var A=new ArithmeticDecoder(D,0,M);for(T.setDecoder(A),b=0;b<I;b++){switch(x){case 0:T.runSignificancePropogationPass();break;case 1:T.runMagnitudeRefinementPass();break;case 2:T.runCleanupPass(),s&&T.checkSegmentationSymbol()}x=(x+1)%3}var R,O,L,B=p.tbx0_-l+(p.tby0_-c)*u,U=T.coefficentsSign,z=T.coefficentsMagnitude,F=T.bitsDecoded,H=i?0:.5;k=0;var V="LL"!==o.type;for(b=0;b<w;b++){var q=2*(B/u|0)*(t-u)+h+f;for(R=0;R<y;R++){if(0!==(O=z[k])){O=(O+H)*r,0!==U[k]&&(O=-O),L=F[k];var N=V?q+(B<<1):B;e[N]=i&&L>=a?O:O*(1<<a-L)}B++,k++}B+=u-y}}}}function f(t,n,o){for(var r=n.components[o],a=r.codingStyleParameters,i=r.quantizationParameters,s=a.decompositionLevelsCount,l=i.SPqcds,c=i.scalarExpounded,u=i.guardBits,d=a.segmentationSymbolUsed,f=t.components[o].precision,m=a.reversibleTransformation,g=m?new T:new w,p=[],v=0,y=0;y<=s;y++){for(var x=r.resolutions[y],b=x.trx1-x.trx0,C=x.try1-x.try0,P=new Float32Array(b*C),S=0,M=x.subbands.length;S<M;S++){var I,D;c?(I=l[v].mu,D=l[v].epsilon,v++):(I=l[0].mu,D=l[0].epsilon+(y>0?1-y:0));var k=x.subbands[S],E=e[k.type];h(P,b,0,k,m?1:Math.pow(2,f+E-D)*(1+I/2048),u+D-1,m,d)}p.push({width:b,height:C,items:P})}var A=g.calculate(p,r.tcx0,r.tcy0);return{left:r.tcx0,top:r.tcy0,width:A.width,height:A.height,items:A.items}}function m(e,t){for(var n=e.SIZ.Csiz,o=e.tiles[t],r=0;r<n;r++){var a=o.components[r],i=void 0!==e.currentTile.QCC[r]?e.currentTile.QCC[r]:e.currentTile.QCD;a.quantizationParameters=i;var s=void 0!==e.currentTile.COC[r]?e.currentTile.COC[r]:e.currentTile.COD;a.codingStyleParameters=s}o.codingStyleDefaultParameters=e.currentTile.COD}t.prototype={parse:function(e){if(65359!==readUint16(e,0))for(var t=0,n=e.length;t<n;){var o=8,r=readUint32(e,t),a=readUint32(e,t+4);if(t+=o,1===r&&(r=4294967296*readUint32(e,t)+readUint32(e,t+4),t+=8,o+=8),0===r&&(r=n-t+o),r<o)throw new Error("JPX Error: Invalid box field size");var i=r-o,s=!0;switch(a){case 1785737832:s=!1;break;case 1668246642:var l=e[t];e[t+1],e[t+2];if(1===l){var c=readUint32(e,t+3);switch(c){case 16:case 17:case 18:break;default:warn("Unknown colorspace "+c)}}else 2===l&&info("ICC profile not supported");break;case 1785737827:this.parseCodestream(e,t,t+i);break;case 1783636e3:218793738!==readUint32(e,t)&&warn("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:warn("Unsupported header type "+a+" ("+String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,255&a)+")")}s&&(t+=i)}else this.parseCodestream(e,0,e.length)},parseImageProperties:function(e){for(var t=e.getByte();t>=0;){if(65361===(t<<8|(t=e.getByte()))){e.skip(4);var n=e.getInt32()>>>0,o=e.getInt32()>>>0,r=e.getInt32()>>>0,a=e.getInt32()>>>0;e.skip(16);var i=e.getUint16();return this.width=n-r,this.height=o-a,this.componentsCount=i,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(e,t,r){var a={};try{for(var i=!1,s=t;s+1<r;){var l=readUint16(e,s);s+=2;var c,h,g,p,v,y,w=0;switch(l){case 65359:a.mainHeader=!0;break;case 65497:break;case 65361:w=readUint16(e,s);var T={};T.Xsiz=readUint32(e,s+4),T.Ysiz=readUint32(e,s+8),T.XOsiz=readUint32(e,s+12),T.YOsiz=readUint32(e,s+16),T.XTsiz=readUint32(e,s+20),T.YTsiz=readUint32(e,s+24),T.XTOsiz=readUint32(e,s+28),T.YTOsiz=readUint32(e,s+32);var x=readUint16(e,s+36);T.Csiz=x;var b=[];c=s+38;for(var C=0;C<x;C++){var P={precision:1+(127&e[c]),isSigned:!!(128&e[c]),XRsiz:e[c+1],YRsiz:e[c+1]};n(P,T),b.push(P)}a.SIZ=T,a.components=b,o(a,b),a.QCC=[],a.COC=[];break;case 65372:w=readUint16(e,s);var S={};switch(c=s+2,31&(h=e[c++])){case 0:p=8,v=!0;break;case 1:p=16,v=!1;break;case 2:p=16,v=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+h)}for(S.noQuantization=8===p,S.scalarExpounded=v,S.guardBits=h>>5,g=[];c<w+s;){var M={};8===p?(M.epsilon=e[c++]>>3,M.mu=0):(M.epsilon=e[c]>>3,M.mu=(7&e[c])<<8|e[c+1],c+=2),g.push(M)}S.SPqcds=g,a.mainHeader?a.QCD=S:(a.currentTile.QCD=S,a.currentTile.QCC=[]);break;case 65373:w=readUint16(e,s);var I,D={};switch(c=s+2,a.SIZ.Csiz<257?I=e[c++]:(I=readUint16(e,c),c+=2),31&(h=e[c++])){case 0:p=8,v=!0;break;case 1:p=16,v=!1;break;case 2:p=16,v=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+h)}for(D.noQuantization=8===p,D.scalarExpounded=v,D.guardBits=h>>5,g=[];c<w+s;)M={},8===p?(M.epsilon=e[c++]>>3,M.mu=0):(M.epsilon=e[c]>>3,M.mu=(7&e[c])<<8|e[c+1],c+=2),g.push(M);D.SPqcds=g,a.mainHeader?a.QCC[I]=D:a.currentTile.QCC[I]=D;break;case 65362:w=readUint16(e,s);var k={};c=s+2;var E=e[c++];k.entropyCoderWithCustomPrecincts=!!(1&E),k.sopMarkerUsed=!!(2&E),k.ephMarkerUsed=!!(4&E),k.progressionOrder=e[c++],k.layersCount=readUint16(e,c),c+=2,k.multipleComponentTransform=e[c++],k.decompositionLevelsCount=e[c++],k.xcb=2+(15&e[c++]),k.ycb=2+(15&e[c++]);var A=e[c++];if(k.selectiveArithmeticCodingBypass=!!(1&A),k.resetContextProbabilities=!!(2&A),k.terminationOnEachCodingPass=!!(4&A),k.verticalyStripe=!!(8&A),k.predictableTermination=!!(16&A),k.segmentationSymbolUsed=!!(32&A),k.reversibleTransformation=e[c++],k.entropyCoderWithCustomPrecincts){for(var R=[];c<w+s;){var O=e[c++];R.push({PPx:15&O,PPy:O>>4})}k.precinctsSizes=R}var L=[];if(k.selectiveArithmeticCodingBypass&&L.push("selectiveArithmeticCodingBypass"),k.resetContextProbabilities&&L.push("resetContextProbabilities"),k.terminationOnEachCodingPass&&L.push("terminationOnEachCodingPass"),k.verticalyStripe&&L.push("verticalyStripe"),k.predictableTermination&&L.push("predictableTermination"),L.length>0)throw i=!0,new Error("JPX Error: Unsupported COD options ("+L.join(", ")+")");a.mainHeader?a.COD=k:(a.currentTile.COD=k,a.currentTile.COC=[]);break;case 65424:w=readUint16(e,s),(y={}).index=readUint16(e,s+2),y.length=readUint32(e,s+4),y.dataEnd=y.length+s-2,y.partIndex=e[s+8],y.partsCount=e[s+9],a.mainHeader=!1,0===y.partIndex&&(y.COD=a.COD,y.COC=a.COC.slice(0),y.QCD=a.QCD,y.QCC=a.QCC.slice(0)),a.currentTile=y;break;case 65427:0===(y=a.currentTile).partIndex&&(m(a,y.index),u(a)),d(a,e,s,w=y.dataEnd-s);break;case 65365:case 65367:case 65368:case 65380:w=readUint16(e,s);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+l.toString(16))}s+=w}}catch(e){if(i||this.failOnCorruptedImage)throw e;warn("Trying to recover from "+e.message)}this.tiles=function(e){for(var t=e.SIZ,n=e.components,o=t.Csiz,r=[],a=0,i=e.tiles.length;a<i;a++){var s,l=e.tiles[a],c=[];for(s=0;s<o;s++)c[s]=f(e,l,s);var u=c[0],d=n[0].isSigned;if(d)var h=new Int16Array(u.items.length*o);else var h=new Uint16Array(u.items.length*o);var m,g,p,v,y,w,T,x,b,C,P,S,M,I,D,k={left:u.left,top:u.top,width:u.width,height:u.height,items:h},E=0;if(l.codingStyleDefaultParameters.multipleComponentTransform){var A=4===o,R=c[0].items,O=c[1].items,L=c[2].items,B=A?c[3].items:null;m=n[0].precision-8,g=.5+(128<<m),v=-(y=.5*(p=255*(1<<m)));var U=l.components[0],z=o-3;if(T=R.length,U.codingStyleParameters.reversibleTransformation)for(w=0;w<T;w++,E+=z)x=R[w]+g,b=O[w],C=L[w],P=(S=x-(C+b>>2))+C,M=S+b,h[E++]=P<=0?0:P>=p?255:P>>m,h[E++]=S<=0?0:S>=p?255:S>>m,h[E++]=M<=0?0:M>=p?255:M>>m;else for(w=0;w<T;w++,E+=z)x=R[w]+g,b=O[w],C=L[w],P=x+1.402*C,S=x-.34413*b-.71414*C,M=x+1.772*b,h[E++]=P<=0?0:P>=p?255:P>>m,h[E++]=S<=0?0:S>=p?255:S>>m,h[E++]=M<=0?0:M>=p?255:M>>m;if(A)for(w=0,E=3;w<T;w++,E+=4)I=B[w],h[E]=I<=v?0:I>=y?255:I+g>>m}else for(s=0;s<o;s++)if(8===n[s].precision){var F=c[s].items;for(m=n[s].precision-8,g=.5+(128<<m),v=-(p=127.5*(1<<m)),E=s,w=0,T=F.length;w<T;w++)D=F[w],h[E]=D<=v?0:D>=p?255:D+g>>m,E+=o}else{var d=n[s].isSigned,F=c[s].items;if(d)for(E=s,w=0,T=F.length;w<T;w++)h[E]=F[w],E+=o;else{m=n[s].precision-8,g=.5+(128<<m);var H=Math.pow(2,n[s].precision)-1;for(E=s,w=0,T=F.length;w<T;w++)D=F[w],h[E]=Math.max(Math.min(D+g,H),0),E+=o}}r.push(k)}return r}(a),this.width=a.SIZ.Xsiz-a.SIZ.XOsiz,this.height=a.SIZ.Ysiz-a.SIZ.YOsiz,this.componentsCount=a.SIZ.Csiz}};var g=function(){function e(e,t){var n=log2(Math.max(e,t))+1;this.levels=[];for(var o=0;o<n;o++){var r={width:e,height:t,items:[]};this.levels.push(r),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t){for(var n,o=0,r=0;o<this.levels.length;){var a=e+t*(n=this.levels[o]).width;if(void 0!==n.items[a]){r=n.items[a];break}n.index=a,e>>=1,t>>=1,o++}o--,(n=this.levels[o]).items[n.index]=r,this.currentLevel=o,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return--e<0?(this.value=n,!1):(this.currentLevel=e,(t=this.levels[e]).items[t.index]=n,!0)}},e}(),p=function(){function e(e,t){var n=log2(Math.max(e,t))+1;this.levels=[];for(var o=0;o<n;o++){for(var r=new Uint8Array(e*t),a=new Uint8Array(e*t),i=0,s=r.length;i<s;i++)r[i]=0,a[i]=0;var l={width:e,height:t,items:r,status:a};this.levels.push(l),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t,n){this.currentStopValue=n;for(var o=0;o<this.levels.length;){var r=this.levels[o],a=e+t*r.width;r.index=a,e>>=1,t>>=1,o++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]=e.items[e.index]+1,e.items[e.index]>this.minValue&&(this.minValue=e.items[e.index])},nextLevel:function(){var e=this.currentLevel;if(--e<0)return!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]<this.minValue?t.items[t.index]=this.minValue:t.items[t.index]>this.minValue&&(this.minValue=t.items[t.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var e=this.currentLevel,t=this.levels[e];return t.items[t.index]>this.currentStopValue},isKnown:function(){var e=this.currentLevel,t=this.levels[e];return t.status[t.index]>0},setKnown:function(){var e=this.currentLevel,t=this.levels[e];t.status[t.index]=1}},e}(),v=function(){var e=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),t=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),n=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);function o(o,r,a,i,s){this.width=o,this.height=r,this.contextLabelTable="HH"===a?n:"HL"===a?t:e;var l=o*r;this.neighborsSignificance=new Uint8Array(l),this.coefficentsSign=new Uint8Array(l),this.coefficentsMagnitude=s>14?new Uint32Array(l):s>6?new Uint16Array(l):new Uint8Array(l),this.processingFlags=new Uint8Array(l);var c=new Uint8Array(l);if(0!==i)for(var u=0;u<l;u++)c[u]=i;this.bitsDecoded=c,this.reset()}return o.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[17]=92,this.contexts[18]=6},setNeighborsSignificance:function(e,t,n){var o,r=this.neighborsSignificance,a=this.width,i=this.height,s=t>0,l=t+1<a;e>0&&(o=n-a,s&&(r[o-1]+=16),l&&(r[o+1]+=16),r[o]+=4),e+1<i&&(o=n+a,s&&(r[o-1]+=16),l&&(r[o+1]+=16),r[o]+=4),s&&(r[n-1]+=1),l&&(r[n+1]+=1),r[n]|=128},runSignificancePropogationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,o=this.coefficentsMagnitude,r=this.coefficentsSign,a=this.neighborsSignificance,i=this.processingFlags,s=this.contexts,l=this.contextLabelTable,c=this.bitsDecoded,u=0;u<n;u+=4)for(var d=0;d<t;d++)for(var h=u*t+d,f=0;f<4;f++,h+=t){var m=u+f;if(m>=n)break;if(i[h]&=-2,!o[h]&&a[h]){var g=l[a[h]];if(e.readBit(s,g)){var p=this.decodeSignBit(m,d,h);r[h]=p,o[h]=1,this.setNeighborsSignificance(m,d,h),i[h]|=2}c[h]++,i[h]|=1}}},decodeSignBit:function(e,t,n){var o,r,a,i,s,l,c=this.width,u=this.height,d=this.coefficentsMagnitude,h=this.coefficentsSign;i=t>0&&0!==d[n-1],t+1<c&&0!==d[n+1]?(a=h[n+1],o=i?1-a-(r=h[n-1]):1-a-a):o=i?1-(r=h[n-1])-r:0;var f=3*o;return i=e>0&&0!==d[n-c],e+1<u&&0!==d[n+c]?(a=h[n+c],o=i?1-a-(r=h[n-c])+f:1-a-a+f):o=i?1-(r=h[n-c])-r+f:f,o>=0?(s=9+o,l=this.decoder.readBit(this.contexts,s)):(s=9-o,l=1^this.decoder.readBit(this.contexts,s)),l},runMagnitudeRefinementPass:function(){for(var e,t=this.decoder,n=this.width,o=this.height,r=this.coefficentsMagnitude,a=this.neighborsSignificance,i=this.contexts,s=this.bitsDecoded,l=this.processingFlags,c=n*o,u=4*n,d=0;d<c;d=e){e=Math.min(c,d+u);for(var h=0;h<n;h++)for(var f=d+h;f<e;f+=n)if(r[f]&&0==(1&l[f])){var m=16;if(0!=(2&l[f]))l[f]^=2,m=0===(127&a[f])?15:14;var g=t.readBit(i,m);r[f]=r[f]<<1|g,s[f]++,l[f]|=1}}},runCleanupPass:function(){for(var e,t=this.decoder,n=this.width,o=this.height,r=this.neighborsSignificance,a=this.coefficentsMagnitude,i=this.coefficentsSign,s=this.contexts,l=this.contextLabelTable,c=this.bitsDecoded,u=this.processingFlags,d=n,h=2*n,f=3*n,m=0;m<o;m=e){e=Math.min(m+4,o);for(var g=m*n,p=m+3<o,v=0;v<n;v++){var y,w=g+v,T=0,x=w,b=m;if(p&&0===u[w]&&0===u[w+d]&&0===u[w+h]&&0===u[w+f]&&0===r[w]&&0===r[w+d]&&0===r[w+h]&&0===r[w+f]){if(!t.readBit(s,18)){c[w]++,c[w+d]++,c[w+h]++,c[w+f]++;continue}0!==(T=t.readBit(s,17)<<1|t.readBit(s,17))&&(b=m+T,x+=T*n),y=this.decodeSignBit(b,v,x),i[x]=y,a[x]=1,this.setNeighborsSignificance(b,v,x),u[x]|=2,x=w;for(var C=m;C<=b;C++,x+=n)c[x]++;T++}for(b=m+T;b<e;b++,x+=n)if(!a[x]&&0==(1&u[x])){var P=l[r[x]];1===t.readBit(s,P)&&(y=this.decodeSignBit(b,v,x),i[x]=y,a[x]=1,this.setNeighborsSignificance(b,v,x),u[x]|=2),c[x]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,t=this.contexts;if(10!==(e.readBit(t,17)<<3|e.readBit(t,17)<<2|e.readBit(t,17)<<1|e.readBit(t,17)))throw new Error("JPX Error: Invalid segmentation symbol")}},o}(),y=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var o=e[0],r=1,a=e.length;r<a;r++)o=this.iterate(o,e[r],t,n);return o},e.prototype.extend=function(e,t,n){var o=t-1,r=t+1,a=t+n-2,i=t+n;e[o--]=e[r++],e[i++]=e[a--],e[o--]=e[r++],e[i++]=e[a--],e[o--]=e[r++],e[i++]=e[a--],e[o]=e[r],e[i]=e[a]},e.prototype.iterate=function(e,t,n,o){var r,a,i,s,l,c,u=e.width,d=e.height,h=e.items,f=t.width,m=t.height,g=t.items;for(i=0,r=0;r<d;r++)for(s=2*r*f,a=0;a<u;a++,i++,s+=2)g[s]=h[i];h=e.items=null;var p=new Float32Array(f+8);if(1===f){if(0!=(1&n))for(c=0,i=0;c<m;c++,i+=f)g[i]*=.5}else for(c=0,i=0;c<m;c++,i+=f)p.set(g.subarray(i,i+f),4),this.extend(p,4,f),this.filter(p,4,f),g.set(p.subarray(4,4+f),i);var v=16,y=[];for(r=0;r<v;r++)y.push(new Float32Array(m+8));var w,T=0;if(e=4+m,1===m){if(0!=(1&o))for(l=0;l<f;l++)g[l]*=.5}else for(l=0;l<f;l++){if(0===T){for(v=Math.min(f-l,v),i=l,s=4;s<e;i+=f,s++)for(w=0;w<v;w++)y[w][s]=g[i+w];T=v}var x=y[--T];if(this.extend(x,4,m),this.filter(x,4,m),0===T)for(i=l-v+1,s=4;s<e;i+=f,s++)for(w=0;w<v;w++)g[i+w]=y[w][s]}return{width:f,height:m,items:g}},e}(),w=function(){function e(){y.call(this)}return e.prototype=Object.create(y.prototype),e.prototype.filter=function(e,t,n){var o,r,a,i,s=n>>1,l=-1.586134342059924,c=-.052980118572961,u=.882911075530934,d=.443506852043971,h=1.230174104914001;for(o=(t|=0)-3,r=s+4;r--;o+=2)e[o]*=.8128930661159609;for(a=d*e[(o=t-2)-1],r=s+3;r--&&(i=d*e[o+1],e[o]=h*e[o]-a-i,r--);o+=2)a=d*e[(o+=2)+1],e[o]=h*e[o]-a-i;for(a=u*e[(o=t-1)-1],r=s+2;r--&&(i=u*e[o+1],e[o]-=a+i,r--);o+=2)a=u*e[(o+=2)+1],e[o]-=a+i;for(a=c*e[(o=t)-1],r=s+1;r--&&(i=c*e[o+1],e[o]-=a+i,r--);o+=2)a=c*e[(o+=2)+1],e[o]-=a+i;if(0!==s)for(a=l*e[(o=t+1)-1],r=s;r--&&(i=l*e[o+1],e[o]-=a+i,r--);o+=2)a=l*e[(o+=2)+1],e[o]-=a+i},e}(),T=function(){function e(){y.call(this)}return e.prototype=Object.create(y.prototype),e.prototype.filter=function(e,t,n){var o,r,a=n>>1;for(o=t|=0,r=a+1;r--;o+=2)e[o]-=e[o-1]+e[o+1]+2>>2;for(o=t+1,r=a;r--;o+=2)e[o]+=e[o-1]+e[o+1]>>1},e}();return t}(),ArithmeticDecoder=function(){var e=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];function t(e,t,n){this.data=e,this.bp=t,this.dataEnd=n,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}return t.prototype={byteIn:function(){var e=this.data,t=this.bp;255===e[t]?e[t+1]>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t):(t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t);this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(t,n){var o,r=t[n]>>1,a=1&t[n],i=e[r],s=i.qe,l=this.a-s;if(this.chigh<s)l<s?(l=s,o=a,r=i.nmps):(l=s,o=1^a,1===i.switchFlag&&(a=o),r=i.nlps);else{if(this.chigh-=s,0!=(32768&l))return this.a=l,a;l<s?(o=1^a,1===i.switchFlag&&(a=o),r=i.nlps):(o=a,r=i.nmps)}do{0===this.ct&&this.byteIn(),l<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--}while(0==(32768&l));return this.a=l,t[n]=r<<1|a,o}},t}(),globalScope="undefined"==typeof window?this:window,isWorker="undefined"==typeof window,FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},AnnotationType={WIDGET:1,TEXT:2,LINK:3},StreamType={UNKNOWN:0,FLATE:1,LZW:2,DCT:3,JPX:4,JBIG:5,A85:6,AHX:7,CCF:8,RL:9},FontType={UNKNOWN:0,TYPE1:1,TYPE1C:2,CIDFONTTYPE0:3,CIDFONTTYPE0C:4,TRUETYPE:5,CIDFONTTYPE2:6,TYPE3:7,OPENTYPE:8,TYPE0:9,MMTYPE1:10};globalScope.PDFJS||(globalScope.PDFJS={}),globalScope.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};var OPS=PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};function info(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+e)}function warn(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+e)}function error(e){if(arguments.length>1){var t=["Error:"];t.push.apply(t,arguments),console.log.apply(console,t),e=[].join.call(arguments," ")}else console.log("Error: "+e);throw console.log(backtrace()),UnsupportedManager.notify(UNSUPPORTED_FEATURES.unknown),new Error(e)}function backtrace(){try{throw new Error}catch(e){return e.stack?e.stack.split("\n").slice(2).join("\n"):""}}function assert(e,t){e||error(t)}var UNSUPPORTED_FEATURES=PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"},UnsupportedManager=PDFJS.UnsupportedManager=function(){var e=[];return{listen:function(t){e.push(t)},notify:function(t){warn('Unsupported feature "'+t+'"');for(var n=0,o=e.length;n<o;n++)e[n](t)}}}();function combineUrl(e,t){if(!t)return e;if(/^[a-z][a-z0-9+\-.]*:/i.test(t))return t;var n;if("/"===t.charAt(0))return n=e.indexOf("://"),"/"===t.charAt(1)?++n:n=e.indexOf("/",n+3),e.substring(0,n)+t;var o=e.length;o=(n=e.lastIndexOf("#"))>=0?n:o,o=(n=e.lastIndexOf("?",o))>=0?n:o;var r=e.lastIndexOf("/",o);return e.substring(0,r+1)+t}function isValidUrl(e,t){if(!e)return!1;var n=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(e);if(!n)return t;switch(n=n[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}}function shadow(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n}PDFJS.isValidUrl=isValidUrl,PDFJS.shadow=shadow;var PasswordResponses=PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},PasswordException=function(){function e(e,t){this.name="PasswordException",this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.PasswordException=PasswordException;var UnknownErrorException=function(){function e(e,t){this.name="UnknownErrorException",this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnknownErrorException=UnknownErrorException;var InvalidPDFException=function(){function e(e){this.name="InvalidPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.InvalidPDFException=InvalidPDFException;var MissingPDFException=function(){function e(e){this.name="MissingPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.MissingPDFException=MissingPDFException;var UnexpectedResponseException=function(){function e(e,t){this.name="UnexpectedResponseException",this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnexpectedResponseException=UnexpectedResponseException;var NotImplementedException=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name="NotImplementedException",e.constructor=e,e}(),MissingDataException=function(){function e(e,t){this.begin=e,this.end=t,this.message="Missing data ["+e+", "+t+")"}return e.prototype=new Error,e.prototype.name="MissingDataException",e.constructor=e,e}(),XRefParseException=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name="XRefParseException",e.constructor=e,e}();function bytesToString(e){assert(null!==e&&"object"==typeof e&&void 0!==e.length,"Invalid argument for bytesToString");var t=e.length;if(t<8192)return String.fromCharCode.apply(null,e);for(var n=[],o=0;o<t;o+=8192){var r=Math.min(o+8192,t),a=e.subarray(o,r);n.push(String.fromCharCode.apply(null,a))}return n.join("")}function stringToBytes(e){assert("string"==typeof e,"Invalid argument for stringToBytes");for(var t=e.length,n=new Uint8Array(t),o=0;o<t;++o)n[o]=255&e.charCodeAt(o);return n}function string32(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}function log2(e){for(var t=1,n=0;e>t;)t<<=1,n++;return n}function readInt8(e,t){return e[t]<<24>>24}function readUint16(e,t){return e[t]<<8|e[t+1]}function readUint32(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function isLittleEndian(){var e=new Uint8Array(2);return e[0]=1,1===new Uint16Array(e.buffer)[0]}function hasCanvasTypedArrays(){var e=document.createElement("canvas");return e.width=e.height=1,void 0!==e.getContext("2d").createImageData(1,1).data.buffer}Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return shadow(PDFJS,"isLittleEndian",isLittleEndian())}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return shadow(PDFJS,"hasCanvasTypedArrays",hasCanvasTypedArrays())}});var Uint32ArrayView=function(){function e(o,r){this.buffer=o,this.byteLength=o.length,this.length=void 0===r?this.byteLength>>2:r,function(o){for(;t<o;)Object.defineProperty(e.prototype,t,n(t)),t++}(this.length)}e.prototype=Object.create(null);var t=0;function n(e){return{get:function(){var t=this.buffer,n=e<<2;return(t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24)>>>0},set:function(t){var n=this.buffer,o=e<<2;n[o]=255&t,n[o+1]=t>>8&255,n[o+2]=t>>16&255,n[o+3]=t>>>24&255}}}return e}(),IDENTITY_MATRIX=[1,0,0,1,0,0],Util=PDFJS.Util=function(){function e(){}var t=["rgb(",0,",",0,",",0,")"];return e.makeCssRgb=function(e,n,o){return t[1]=e,t[3]=n,t[5]=o,t.join("")},e.transform=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.applyTransform=function(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]},e.applyInverseTransform=function(e,t){var n=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n]},e.getAxialAlignedBoundingBox=function(t,n){var o=e.applyTransform(t,n),r=e.applyTransform(t.slice(2,4),n),a=e.applyTransform([t[0],t[3]],n),i=e.applyTransform([t[2],t[1]],n);return[Math.min(o[0],r[0],a[0],i[0]),Math.min(o[1],r[1],a[1],i[1]),Math.max(o[0],r[0],a[0],i[0]),Math.max(o[1],r[1],a[1],i[1])]},e.inverseTransform=function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]},e.apply3dTransform=function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]},e.singularValueDecompose2dScale=function(e){var t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],o=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],i=(n+a)/2,s=Math.sqrt((n+a)*(n+a)-4*(n*a-r*o))/2,l=i+s||1,c=i-s||1;return[Math.sqrt(l),Math.sqrt(c)]},e.normalizeRect=function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t},e.intersect=function(t,n){function o(e,t){return e-t}var r=[t[0],t[2],n[0],n[2]].sort(o),a=[t[1],t[3],n[1],n[3]].sort(o),i=[];return t=e.normalizeRect(t),n=e.normalizeRect(n),(r[0]===t[0]&&r[1]===n[0]||r[0]===n[0]&&r[1]===t[0])&&(i[0]=r[1],i[2]=r[2],(a[0]===t[1]&&a[1]===n[1]||a[0]===n[1]&&a[1]===t[1])&&(i[1]=a[1],i[3]=a[2],i))},e.sign=function(e){return e<0?-1:1},e.appendToArray=function(e,t){Array.prototype.push.apply(e,t)},e.prependToArray=function(e,t){Array.prototype.unshift.apply(e,t)},e.extendObj=function(e,t){for(var n in t)e[n]=t[n]},e.getInheritableProperty=function(e,t){for(;e&&!e.has(t);)e=e.get("Parent");return e?e.get(t):null},e.inherit=function(e,t,n){for(var o in e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n)e.prototype[o]=n[o]},e.loadScript=function(e,t){var n=document.createElement("script"),o=!1;n.setAttribute("src",e),t&&(n.onload=function(){o||t(),o=!0}),document.getElementsByTagName("head")[0].appendChild(n)},e}(),PageViewport=PDFJS.PageViewport=function(){function e(e,t,n,o,r,a){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=o,this.offsetY=r;var i,s,l,c,u,d,h,f,m=(e[2]+e[0])/2,g=(e[3]+e[1])/2;switch(n=(n%=360)<0?n+360:n){case 180:i=-1,s=0,l=0,c=1;break;case 90:i=0,s=1,l=1,c=0;break;case 270:i=0,s=-1,l=-1,c=0;break;default:i=1,s=0,l=0,c=-1}a&&(l=-l,c=-c),0===i?(u=Math.abs(g-e[1])*t+o,d=Math.abs(m-e[0])*t+r,h=Math.abs(e[3]-e[1])*t,f=Math.abs(e[2]-e[0])*t):(u=Math.abs(m-e[0])*t+o,d=Math.abs(g-e[1])*t+r,h=Math.abs(e[2]-e[0])*t,f=Math.abs(e[3]-e[1])*t),this.transform=[i*t,s*t,l*t,c*t,u-i*t*m-l*t*g,d-s*t*m-c*t*g],this.width=h,this.height=f,this.fontScale=t}return e.prototype={clone:function(t){var n="scale"in(t=t||{})?t.scale:this.scale,o="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),n,o,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return Util.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=Util.applyTransform([e[0],e[1]],this.transform),n=Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]},convertToPdfPoint:function(e,t){return Util.applyInverseTransform([e,t],this.transform)}},e}(),PDFStringTranslateTable=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function stringToPDFString(e){var t,n=e.length,o=[];if("þ"===e[0]&&"ÿ"===e[1])for(t=2;t<n;t+=2)o.push(String.fromCharCode(e.charCodeAt(t)<<8|e.charCodeAt(t+1)));else for(t=0;t<n;++t){var r=PDFStringTranslateTable[e.charCodeAt(t)];o.push(r?String.fromCharCode(r):e.charAt(t))}return o.join("")}function stringToUTF8String(e){return decodeURIComponent(escape(e))}function isEmptyObj(e){for(var t in e)return!1;return!0}function isBool(e){return"boolean"==typeof e}function isInt(e){return"number"==typeof e&&(0|e)===e}function isNum(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isNull(e){return null===e}function isName(e){return e instanceof Name}function isCmd(e,t){return e instanceof Cmd&&(void 0===t||e.cmd===t)}function isDict(e,t){if(!(e instanceof Dict))return!1;if(!t)return!0;var n=e.get("Type");return isName(n)&&n.name===t}function isArray(e){return e instanceof Array}function isStream(e){return"object"==typeof e&&null!==e&&void 0!==e.getBytes}function isArrayBuffer(e){return"object"==typeof e&&null!==e&&void 0!==e.byteLength}function isRef(e){return e instanceof Ref}function createPromiseCapability(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}PDFJS.createPromiseCapability=createPromiseCapability,function(){if(globalScope.Promise)return"function"!=typeof globalScope.Promise.all&&(globalScope.Promise.all=function(e){var t,n,o=0,r=[],a=new globalScope.Promise(function(e,o){t=e,n=o});return e.forEach(function(e,a){o++,e.then(function(e){r[a]=e,0===--o&&t(r)},n)}),0===o&&t(r),a}),"function"!=typeof globalScope.Promise.resolve&&(globalScope.Promise.resolve=function(e){return new globalScope.Promise(function(t){t(e)})}),"function"!=typeof globalScope.Promise.reject&&(globalScope.Promise.reject=function(e){return new globalScope.Promise(function(t,n){n(e)})}),void("function"!=typeof globalScope.Promise.prototype.catch&&(globalScope.Promise.prototype.catch=function(e){return globalScope.Promise.prototype.then(void 0,e)}));var e=0,t=2,n={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(t){t._status!==e&&(this.handlers=this.handlers.concat(t._handlers),t._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var e=Date.now()+1;this.handlers.length>0;){var n=this.handlers.shift(),o=n.thisPromise._status,r=n.thisPromise._value;try{1===o?"function"==typeof n.onResolve&&(r=n.onResolve(r)):"function"==typeof n.onReject&&(r=n.onReject(r),o=1,n.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(n.thisPromise))}catch(e){o=t,r=e}if(n.nextPromise._updateStatus(o,r),Date.now()>=e)break}this.handlers.length>0?setTimeout(this.runHandlers.bind(this),0):this.running=!1},addUnhandledRejection:function(e){this.unhandledRejections.push({promise:e,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(e){e._unhandledRejection=!1;for(var t=0;t<this.unhandledRejections.length;t++)this.unhandledRejections[t].promise===e&&(this.unhandledRejections.splice(t),t--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var e=Date.now(),t=0;t<this.unhandledRejections.length;t++)if(e-this.unhandledRejections[t].time>500){var n=this.unhandledRejections[t].promise._value,o="Unhandled rejection: "+n;n.stack&&(o+="\n"+n.stack),warn(o),this.unhandledRejections.splice(t),t--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),500))}};function o(t){this._status=e,this._handlers=[];try{t.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(e){this._reject(e)}}o.all=function(e){var n,r,a=new o(function(e,t){n=e,r=t}),i=e.length,s=[];if(0===i)return n(s),a;function l(e){a._status!==t&&(s=[],r(e))}for(var c=0,u=e.length;c<u;++c){var d=e[c],h=function(e){return function(o){a._status!==t&&(s[e]=o,0===--i&&n(s))}}(c);o.isPromise(d)?d.then(h,l):h(d)}return a},o.isPromise=function(e){return e&&"function"==typeof e.then},o.resolve=function(e){return new o(function(t){t(e)})},o.reject=function(e){return new o(function(t,n){n(e)})},o.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(e,r){1!==this._status&&this._status!==t&&(1===e&&o.isPromise(r)?r.then(this._updateStatus.bind(this,1),this._updateStatus.bind(this,t)):(this._status=e,this._value=r,e===t&&0===this._handlers.length&&(this._unhandledRejection=!0,n.addUnhandledRejection(this)),n.scheduleHandlers(this)))},_resolve:function(e){this._updateStatus(1,e)},_reject:function(e){this._updateStatus(t,e)},then:function(e,t){var r=new o(function(e,t){this.resolve=e,this.reject=t});return this._handlers.push({thisPromise:this,onResolve:e,onReject:t,nextPromise:r}),n.scheduleHandlers(this),r},catch:function(e){return this.then(void 0,e)}},globalScope.Promise=o}();var StatTimer=function(){function e(e,t,n){for(;e.length<n;)e+=t;return e}function t(){this.started={},this.times=[],this.enabled=!0}return t.prototype={time:function(e){this.enabled&&(e in this.started&&warn("Timer is already running for "+e),this.started[e]=Date.now())},timeEnd:function(e){this.enabled&&(e in this.started||warn("Timer has not been started for "+e),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e])},toString:function(){var t,n,o=this.times,r="",a=0;for(t=0,n=o.length;t<n;++t){var i=o[t].name;i.length>a&&(a=i.length)}for(t=0,n=o.length;t<n;++t){var s=o[t],l=s.end-s.start;r+=e(s.name," ",a)+" "+l+"ms\n"}return r}},t}();function MessageHandler(e,t){this.name=e,this.comObj=t,this.callbackIndex=1,this.postMessageTransfers=!0;var n=this.callbacksCapabilities={},o=this.actionHandler={};o.console_log=[function(e){console.log.apply(console,e)}],o.console_error=[function(e){console.error.apply(console,e)}],o._unsupported_feature=[function(e){UnsupportedManager.notify(e)}],t.onmessage=function(e){var r=e.data;if(r.isReply){var a=r.callbackId;if(r.callbackId in n){var i=n[a];delete n[a],"error"in r?i.reject(r.error):i.resolve(r.data)}else error("Cannot resolve callback "+a)}else if(r.action in o){var s=o[r.action];r.callbackId?Promise.resolve().then(function(){return s[0].call(s[1],r.data)}).then(function(e){t.postMessage({isReply:!0,callbackId:r.callbackId,data:e})},function(e){t.postMessage({isReply:!0,callbackId:r.callbackId,error:e})}):s[0].call(s[1],r.data)}else error("Unknown action from worker: "+r.action)}}function loadJpegStream(e,t,n){var o=new Image;o.onload=function(){n.resolve(e,o)},o.onerror=function(){n.resolve(e,null),warn("Error during JPEG image loading")},o.src=t}PDFJS.createBlob=function(e,t){if("undefined"!=typeof Blob)return new Blob([e],{type:t});var n=new MozBlobBuilder;return n.append(e),n.getBlob(t)},PDFJS.createObjectURL=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(t,n){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var o=PDFJS.createBlob(t,n);return URL.createObjectURL(o)}for(var r="data:"+n+";base64,",a=0,i=t.length;a<i;a+=3){var s=255&t[a],l=255&t[a+1],c=255&t[a+2];r+=e[s>>2]+e[(3&s)<<4|l>>4]+e[a+1<i?(15&l)<<2|c>>6:64]+e[a+2<i?63&c:64]}return r}}(),MessageHandler.prototype={on:function(e,t,n){var o=this.actionHandler;o[e]&&error('There is already an actionName called "'+e+'"'),o[e]=[t,n]},send:function(e,t,n){var o={action:e,data:t};this.postMessage(o,n)},sendWithPromise:function(e,t,n){var o=this.callbackIndex++,r={action:e,data:t,callbackId:o},a=createPromiseCapability();this.callbacksCapabilities[o]=a;try{this.postMessage(r,n)}catch(e){a.reject(e)}return a.promise},postMessage:function(e,t){t&&this.postMessageTransfers?this.comObj.postMessage(e,t):this.comObj.postMessage(e)}};